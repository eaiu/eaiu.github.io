<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=icon type=image/ico href=https://blog.yzyy.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.yzyy.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.yzyy.de/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://blog.yzyy.de/android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://blog.yzyy.de/apple-touch-icon.png><meta name=description content="本文提供了一份详尽的域名管理指南，覆盖从域名托管至Cloudflare、配置DNS解析到申请SSL/TLS证书的全过程。文章重点对比了两种主流的HTTPS实现方案：一是利用Cloudflare内置的代理服务及其三种SSL/TLS加密模式（灵活、完全、完全(严格)）；二是通过acme.sh脚本结合Cloudflare DNS API自动申请和续签免费的Let's Encrypt泛域名证书，并附有详细的API令牌获取与命令行操作步骤。"><title>域名管理：Cloudflare DNS托管与SSL证书配置 | G-Hung的博客</title><link rel=canonical href=https://blog.yzyy.de/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E5%9F%9F%E5%90%8D%E7%9B%B8%E5%85%B3/><meta property="og:url" content="https://blog.yzyy.de/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E5%9F%9F%E5%90%8D%E7%9B%B8%E5%85%B3/"><meta property="og:site_name" content="G-Hung的博客"><meta property="og:title" content="域名管理：Cloudflare DNS托管与SSL证书配置"><meta property="og:description" content="本文提供了一份详尽的域名管理指南，覆盖从域名托管至Cloudflare、配置DNS解析到申请SSL/TLS证书的全过程。文章重点对比了两种主流的HTTPS实现方案：一是利用Cloudflare内置的代理服务及其三种SSL/TLS加密模式（灵活、完全、完全(严格)）；二是通过acme.sh脚本结合Cloudflare DNS API自动申请和续签免费的Let's Encrypt泛域名证书，并附有详细的API令牌获取与命令行操作步骤。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="explore"><meta property="article:published_time" content="2024-05-08T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-08T00:00:00+00:00"><meta property="article:tag" content="探索"><meta property="article:tag" content="服务器"><meta property="article:tag" content="域名"><link rel=stylesheet href=/assets/combined.min.5e139504908908255829461aa5380534c88b0d4f739385601750a2a381626824.css media=all><script async src="https://www.googletagmanager.com/gtag/js?id=G-88BLW4V0HZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-88BLW4V0HZ")}</script></head><body class=auto><div class=content><header><div class=header><h1 class=header-title><a href=https://blog.yzyy.de/>G-Hung的博客</a></h1><div class=header-menu><p class=small><a href=/>/home</a></p><p class=small><a href=/post>/日常</a></p><p class=small><a href=/explore>/探索记录</a></p><p class=small><a href=/tags>/tags</a></p></div></div></header><main class=main><div class=breadcrumbs><a href=/>Home</a><span class=breadcrumbs-separator>/</span><a href=/explore/>Explores</a><span class=breadcrumbs-separator>/</span>
<a href=/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E5%9F%9F%E5%90%8D%E7%9B%B8%E5%85%B3/>域名管理：Cloudflare DNS托管与SSL证书配置</a></div><div class=autonumber><article><header class=single-intro-container><h1 class=single-title>域名管理：Cloudflare DNS托管与SSL证书配置</h1><p class=single-summary>本篇记录了域名管理的关键流程，涵盖了使用Cloudflare进行DNS解析与托管，对比并介绍了通过Cloudflare服务与acme.sh脚本两种方式申请和自动化管理SSL/TLS证书的完整步骤。</p><div class=single-subsummary><img src=/avatar.jpg alt="Author Avatar"><div><p class=author>ghung</p><p class=single-date><time datetime=2024-05-08T00:00:00+00:00>2024 May 8</time>
&nbsp; · &nbsp;4 min read</p></div></div></header><div class=single-tags><span><a href=https://blog.yzyy.de/tags/%E6%8E%A2%E7%B4%A2/>#探索</a>
</span><span><a href=https://blog.yzyy.de/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/>#服务器</a>
</span><span><a href=https://blog.yzyy.de/tags/%E5%9F%9F%E5%90%8D/>#域名</a></span></div><aside class=toc><p><strong>Table of contents</strong></p><nav id=TableOfContents><ul><li><a href=#dns解析和将域名托管到cloudflare>DNS解析和将域名托管到cloudflare</a></li><li><a href=#申请tlsssl证书>申请TLS\SSL证书</a><ul><li><a href=#cloudflare的服务>cloudflare的服务</a></li><li><a href=#使用-acmesh-dns-验证的方式签发-letsencrypt-证书>使用 acme.sh DNS 验证的方式签发 Let&rsquo;sEncrypt 证书</a></li><li><a href=#两个服务的比较>两个服务的比较</a></li></ul></li></ul></nav></aside><div class=single-content><h1 class=heading id=域名相关>域名相关
<a class=anchor href=#%e5%9f%9f%e5%90%8d%e7%9b%b8%e5%85%b3>#</a></h1><p>本篇记录一下域名相关的操作吧，包括到cf托管，申请与安装SSL证书等。</p><h2 class=heading id=dns解析和将域名托管到cloudflare>DNS解析和将域名托管到cloudflare
<a class=anchor href=#dns%e8%a7%a3%e6%9e%90%e5%92%8c%e5%b0%86%e5%9f%9f%e5%90%8d%e6%89%98%e7%ae%a1%e5%88%b0cloudflare>#</a></h2><p>感谢<a href=https://sarakale.top/blog/posts/3a730d01/#%E5%9F%9F%E5%90%8D%E6%B3%A8%E5%86%8C>Namesilo/Cloudflare域名注册和解析设置教程 | SaraKale&rsquo;s blog</a></p><ol><li><p>到 <a href=https://www.cloudflare.com/>Cloudflare</a> 添加你的站点，选择 Free 免费计划。<figure><div class=img-container><img loading=lazy alt=Pasted%20image%2020250113153620 src=https://webp.050612.xyz/2025/02/Pasted%20image%2020250113153620.png></div></figure></p></li><li><p>在下一页上，您需要选择首选的 CDN 计划。选择 Free 计划。单击其图标和<strong>确认计划</strong>按钮继续：<figure><div class=img-container><img loading=lazy alt=Pasted%20image%2020250113153644 src=https://webp.050612.xyz/2025/02/Pasted%20image%2020250113153644.png></div></figure></p></li><li><p>如果之前已经做过解析就可以看到现有的DNS记录。<figure><div class=img-container><img loading=lazy alt=Pasted%20image%2020250113153828 src=https://webp.050612.xyz/2025/02/Pasted%20image%2020250113153828.png></div></figure></p></li><li><p>这里先不用管，继续下一步。<figure><div class=img-container><img loading=lazy alt=Pasted%20image%2020250113153859 src=https://webp.050612.xyz/2025/02/Pasted%20image%2020250113153859.png></div></figure></p></li><li><p>可以看到给了两个NS服务器，回到域名提供商后台更改NS服务器。<figure><div class=img-container><img loading=lazy alt=Pasted%20image%2020250113153945 src=https://webp.050612.xyz/2025/02/Pasted%20image%2020250113153945.png></div></figure></p></li><li><p>NameCheap更改ns服务器参考官方教程<a href=https://www.namecheap.com/support/knowledgebase/article.aspx/9607/2210/how-to-set-up-dns-records-for-your-domain-in-a-cloudflare-account/>Title Unavailable | Site Unreachable</a>，其他域名服务商大同小异。</p></li></ol><h2 class=heading id=申请tlsssl证书>申请TLS\SSL证书
<a class=anchor href=#%e7%94%b3%e8%af%b7tlsssl%e8%af%81%e4%b9%a6>#</a></h2><p>有两种方式，目前选择cloudflare开启代理的模式</p><ul><li>自动续签：</li><li>使用cloudflare的服务，开启小黄云，就可以使用一种泛域名证书，只能当做源站和cloudflare握手的凭证，其他的不认。</li></ul><h3 class=heading id=cloudflare的服务>cloudflare的服务
<a class=anchor href=#cloudflare%e7%9a%84%e6%9c%8d%e5%8a%a1>#</a></h3><p>下面采用cloudflare的服务，也是一份cloudflare的初步探索的记录</p><h4 class=heading id=dns管理>DNS管理
<a class=anchor href=#dns%e7%ae%a1%e7%90%86>#</a></h4><p>可以在DNS界面管理DNS解析，以及管理是否开启小黄云代理<figure><div class=img-container><img loading=lazy alt=e%2020250113163808 src=https://webp.050612.xyz/2025/02/Pasted%20image%2020250113163808.png></div></figure></p><h4 class=heading id=ssltls证书>SSL\TLS证书
<a class=anchor href=#ssltls%e8%af%81%e4%b9%a6>#</a></h4><p><figure><div class=img-container><img loading=lazy alt=Pasted%20image%2020250113164004 src=https://webp.050612.xyz/2025/02/Pasted%20image%2020250113164004.png></div></figure></p><ul><li>灵活：web浏览器和cloudflare之间采用443HTTPS，cloudflare和cloudflare之间采用80HTTP</li><li>完全：使用其他未公开认证的SSL证书时采用，源服务器必须配置 SSL 证书，但 Cloudflare <strong>不验证证书的有效性</strong>（例如，可以是自签名证书或过期证书）。</li><li>完全（严格）：客户端到 Cloudflare：HTTPS（使用 Cloudflare Universal SSL 证书）。 Cloudflare 到源服务器：<strong>HTTPS（加密）</strong>。源服务器必须配置有效的 SSL 证书，该证书必须由<strong>受信任的 CA 机构签发</strong>或为 <strong>Cloudflare Origin CA 证书</strong>，并且证书中的域名必须与请求的域名匹配。Cloudflare 会验证证书的有效性，包括有效期、颁发机构和域名。</li></ul><p>可以在源服务器页面申请 <strong>Cloudflare Origin CA 证书</strong>，并将该证书放到服务器上。源证书仅对Cloudflare与源服务器之间的加密有效。</p><p><figure><div class=img-container><img loading=lazy alt=Pasted%20image%2020250113164800 src=https://webp.050612.xyz/2025/02/Pasted%20image%2020250113164800.png></div></figure></p><h4 class=heading id=under-attack>Under Attack
<a class=anchor href=#under-attack>#</a></h4><ul><li>可以在安全性-设置里打开Under Attack模式，强制开启验证。<figure><div class=img-container><img loading=lazy alt=Pasted%20image%2020250113165205 src=https://webp.050612.xyz/2025/02/Pasted%20image%2020250113165205.png></div></figure></li></ul><hr><h3 class=heading id=使用-acmesh-dns-验证的方式签发-letsencrypt-证书>使用 acme.sh DNS 验证的方式签发 Let&rsquo;sEncrypt 证书
<a class=anchor href=#%e4%bd%bf%e7%94%a8-acmesh-dns-%e9%aa%8c%e8%af%81%e7%9a%84%e6%96%b9%e5%bc%8f%e7%ad%be%e5%8f%91-letsencrypt-%e8%af%81%e4%b9%a6>#</a></h3><p>参考：<a href=https://blog.uuphy.com/posts/%E9%85%8D%E7%BD%AE-acme.sh-%E5%85%8D%E8%B4%B9%E8%87%AA%E5%8A%A8%E7%AD%BE%E5%8F%91%E6%B3%9B%E5%9F%9F%E5%90%8D%E8%AF%81%E4%B9%A6/>使用 acme.sh DNS 验证的方式签发 Let&rsquo;sEncrypt 证书</a></p><p><a href=https://acme.sh/>acme.sh</a> 是一个用来自动获取和管理 SSL/TLS 证书的开源脚本，可以从 Let’s Encrypt 等多个 CA 获取免费的证书。结合使用 Cloudflare DNS 验证的模式申请泛域名证书，并自动续签。</p><h4 class=heading id=cloudflare-api>Cloudflare API
<a class=anchor href=#cloudflare-api>#</a></h4><p>使用 Cloudflare DNS 模式需要准备:</p><ul><li>Zone ID</li><li>Account ID</li><li>API Token</li></ul><h5 class=heading id=获取-zone-id-account-id>获取 Zone ID, Account ID
<a class=anchor href=#%e8%8e%b7%e5%8f%96-zone-id-account-id>#</a></h5><p>这两种 ID 直接在 Overview 页就能找到。</p><p><figure><div class=img-container><img loading=lazy alt=image src=https://webp.050612.xyz/2025/02/2edb816d28456e59ad4da2b02c3ff69450847554_2_690x370.png></div></figure></p><h5 class=heading id=获取-api-token>获取 API Token
<a class=anchor href=#%e8%8e%b7%e5%8f%96-api-token>#</a></h5><p>Overview 页点击 <code>获取您的 API 令牌</code> 进入 API Tokens 页。</p><p>点击 API Tokens 项旁边 <code>创建令牌</code> 按钮，接着选择 <code>编辑区域 DNS</code> 的模板，点击 <code>使用模板</code>。</p><p><figure><div class=img-container><img loading=lazy alt=image src=https://webp.050612.xyz/2025/02/e15d8a0a1de821faab5355e610b581016975b974_2_690x265.png></div></figure></p><p><figure><div class=img-container><img loading=lazy alt=image src=https://webp.050612.xyz/2025/02/42f87595d27a6fb3ed1fe329934517f5416920c6_2_690x210.png></div></figure></p><p><code>区域资源</code> 里选择需要签发的域名，</p><p>在 <code>客户端 IP 地址筛选</code> 里建议写下 acme.sh 所在的主机做为白名单，需要注意，如果服务器有 ipv6 地址，则也需要添加，因为有可能会 ipv6 优先访问。</p><p>击 <code>继续以显示摘要</code> , 确认没问题后最后点击 <code>创建令牌</code>。</p><p><figure><div class=img-container><img loading=lazy alt=image src=https://webp.050612.xyz/2025/02/e88966d6049c27c31c632f9471ec1b79be287b59_2_510x499.png></div></figure></p><p>此时就会出现一个 Token,，即 CF_Token，拷贝备用。</p><p><figure><div class=img-container><img loading=lazy alt=image src=https://webp.050612.xyz/2025/02/ca6093ea6bf83325809ea6179d4239ae2c9818cc_2_690x404.png></div></figure></p><h5 class=heading id=注意>注意
<a class=anchor href=#%e6%b3%a8%e6%84%8f>#</a></h5><ul><li><strong>注意新增域名时，需要更改API Token所包含的域名</strong></li><li><strong>注意有多台机器时，需要新增机器的IP到白名单</strong>。</li></ul><p><figure><div class=img-container><img loading=lazy alt=update_cf_api_token src=https://webp.050612.xyz/2025/02/update_cf_api_token.png></div></figure><figure><div class=img-container><img loading=lazy alt=cf-api-token-ip src=https://webp.050612.xyz/2025/02/cf-api-token-ip.png></div></figure></p><h4 class=heading id=一个完整的演示>一个完整的演示
<a class=anchor href=#%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%9a%84%e6%bc%94%e7%a4%ba>#</a></h4><p>感谢：<a href=https://atpx.com/blog/auto-update-ssl-with-acme/>使用 acme.sh 自动签发和更新证书 - atpX</a></p><p>为了使整个流程更加清晰（<del>方便自己操作</del>），这里贴一个自己平时使用 acme.sh 申请证书的完整流程。</p><ul><li>申请方式：DNS 认证（使用 Cloudflare API）</li><li>申请证书 CA：Let’s Encrypt</li><li>申请证书类型：RSA + ECC 两个通配符证书</li><li>**同一台主机多个域名的情况</li></ul><p>后续申请证书的命令，都是在 root 用户下执行的，请先使用 <code>su</code> 切换到 root 用户。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#888;font-style:italic># 进入root用户</span>
</span></span><span style=display:flex><span>su
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 安装 acme.sh</span>
</span></span><span style=display:flex><span>curl  https://get.acme.sh | sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 刷新 shell 变量配置</span>
</span></span><span style=display:flex><span><span style=font-weight:700;font-style:italic>source</span> ~/.bashrc
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 导入 Cloudflare API Token</span>
</span></span><span style=display:flex><span><span style=font-weight:700;font-style:italic>export</span> <span style=color:#666;font-weight:700;font-style:italic>CF_Token</span>=<span style=color:#666;font-style:italic>&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>
</span></span><span style=display:flex><span><span style=font-weight:700;font-style:italic>export</span> <span style=color:#666;font-weight:700;font-style:italic>CF_Account_ID</span>=<span style=color:#666;font-style:italic>&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>
</span></span><span style=display:flex><span><span style=font-weight:700;font-style:italic>export</span> <span style=color:#666;font-weight:700;font-style:italic>CF_Zone_ID</span>=<span style=color:#666;font-style:italic>&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 设置默认 CA 为 Let&#39;s Encrypt</span>
</span></span><span style=display:flex><span>acme.sh --set-default-ca --server letsencrypt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 签发 RSA 证书</span>
</span></span><span style=display:flex><span>acme.sh --issue --dns dns_cf -d xxx.xyz -d *.xxx.xyz --keylength 2048
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 目前采用手动移动证书和密钥，或许可以采用以下自动安装的命令</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 安装 RSA 证书到指定路径</span>
</span></span><span style=display:flex><span>acme.sh --install-cert -d domain.tld <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--key-file       /path/to/ssl/domain.tld_private.key  <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--fullchain-file /path/to/ssl/domain.tld_chain.pem <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--capath         /path/to/ssl/domain.tld_ca.pem  <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--reloadcmd      <span style=color:#666;font-style:italic>&#34;service nginx reload&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 签发 ECC 证书，若不需要，跳过即可</span>
</span></span><span style=display:flex><span>acme.sh --issue --dns dns_cf -d domain.tld -d *.domain.tld --keylength ec-256
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 安装 ECC 证书到指定路径</span>
</span></span><span style=display:flex><span>acme.sh --install-cert -d domain.tld --ecc <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--key-file       /path/to/ssl/ecc_domain.tld_private.key  <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--fullchain-file /path/to/ssl/ecc_domain.tld_chain.pem <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--capath         /path/to/ssl/ecc_domain.tld_ca.pem  <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--reloadcmd      <span style=color:#666;font-style:italic>&#34;service nginx reload&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>###############################第二个域名#####################################################################</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 取消环境变量</span>
</span></span><span style=display:flex><span><span style=font-weight:700;font-style:italic>unset</span> CF_Token
</span></span><span style=display:flex><span><span style=font-weight:700;font-style:italic>unset</span> CF_Account_ID
</span></span><span style=display:flex><span><span style=font-weight:700;font-style:italic>unset</span> CF_Zone_ID
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 至此证书安装完毕</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 下面是同一台主机申请第二个域名证书</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 导入另一个 Cloudflare API Token</span>
</span></span><span style=display:flex><span><span style=font-weight:700;font-style:italic>export</span> <span style=color:#666;font-weight:700;font-style:italic>CF_Token</span>=<span style=color:#666;font-style:italic>&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>
</span></span><span style=display:flex><span><span style=font-weight:700;font-style:italic>export</span> <span style=color:#666;font-weight:700;font-style:italic>CF_Account_ID</span>=<span style=color:#666;font-style:italic>&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>
</span></span><span style=display:flex><span><span style=font-weight:700;font-style:italic>export</span> <span style=color:#666;font-weight:700;font-style:italic>CF_Zone_ID</span>=<span style=color:#666;font-style:italic>&#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 新建一个文件夹作为 config home，默认会把所有文件存在这里</span>
</span></span><span style=display:flex><span>mkdir /root/.acme2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 设置默认 CA 为 Let&#39;s Encrypt</span>
</span></span><span style=display:flex><span>acme.sh --config-home /root/.acme2 --set-default-ca --server letsencrypt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 签发 RSA 证书</span>
</span></span><span style=display:flex><span>acme.sh --config-home /root/.acme2 --issue --dns dns_cf -d domain.tld -d *.domain.tld --keylength 2048
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 安装 RSA 证书到指定路径</span>
</span></span><span style=display:flex><span>acme.sh --config-home /root/.acme2 <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--install-cert -d domain.tld <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--key-file       /path/to/ssl/domain.tld_private.key  <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--fullchain-file /path/to/ssl/domain.tld_chain.pem <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--capath         /path/to/ssl/domain.tld_ca.pem  <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--reloadcmd      <span style=color:#666;font-style:italic>&#34;service nginx reload&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 第一次尝试自动安装</span>
</span></span><span style=display:flex><span>acme.sh --config-home /root/.acme_yzyy <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --install-cert -d yzyy.de <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --key-file       /etc/ssl/private/yzyy.de.key  <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --fullchain-file /etc/ssl/certs/yzyy.de.fullchain.pem <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --capath         /etc/ssl/certs/yzyy.de.ca.pem  <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --reloadcmd      <span style=color:#666;font-style:italic>&#34;nginx -s reload&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 签发 ECC 证书，若不需要，跳过即可</span>
</span></span><span style=display:flex><span>acme.sh --config-home /root/.acme2 --issue --dns dns_cf -d domain.tld -d *.domain.tld --keylength ec-256
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 安装 ECC 证书到指定路径</span>
</span></span><span style=display:flex><span>acme.sh --config-home /root/.acme2 <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--install-cert -d domain.tld --ecc <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--key-file       /path/to/ssl/ecc_domain.tld_private.key  <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--fullchain-file /path/to/ssl/ecc_domain.tld_chain.pem <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--capath         /path/to/ssl/ecc_domain.tld_ca.pem  <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>--reloadcmd      <span style=color:#666;font-style:italic>&#34;service nginx reload&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 手动添加另一个 cron 任务</span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># crontab -e</span>
</span></span><span style=display:flex><span>50 0 * * * <span style=color:#666;font-style:italic>&#34;/root/.acme.sh&#34;</span>/acme.sh --cron --home <span style=color:#666;font-style:italic>&#34;/root/.acme.sh&#34;</span>  --config-home <span style=color:#666;font-style:italic>&#34;/root/.acme2&#34;</span> &gt; /dev/null
</span></span></code></pre></div><h3 class=heading id=两个服务的比较>两个服务的比较
<a class=anchor href=#%e4%b8%a4%e4%b8%aa%e6%9c%8d%e5%8a%a1%e7%9a%84%e6%af%94%e8%be%83>#</a></h3><h4 class=heading id=优点>优点
<a class=anchor href=#%e4%bc%98%e7%82%b9>#</a></h4><ul><li>acme.sh` + Let&rsquo;s Encrypt + Cloudflare DNS<ol><li><strong>自动化</strong>：<code>acme.sh</code> 脚本可以自动完成证书的申请、验证和续期过程。</li><li><strong>无需开放 80/443 端口</strong>：使用 DNS 验证方式，无需在服务器上开放 80 或 443 端口，提高了安全性。</li><li><strong>不依赖 Cloudflare 代理</strong>：这种方式只使用 Cloudflare 的 DNS 服务，不依赖 Cloudflare 的代理服务</li></ol></li><li>Cloudflare<ol><li><strong>Universal SSL</strong>：Cloudflare 免费提供 Universal SSL 证书，可以快速启用 HTTPS。</li><li><strong>Origin CA 证书</strong>：Cloudflare 提供 Origin CA 证书，可以实现 Cloudflare 到源服务器的加密连接（严格模式）。</li></ol></li></ul><h4 class=heading id=缺点>缺点
<a class=anchor href=#%e7%bc%ba%e7%82%b9>#</a></h4><ul><li>acme.sh` + Let&rsquo;s Encrypt + Cloudflare DNS<ol><li><strong>配置相对复杂</strong>：相比于使用 Cloudflare 的一键 SSL 功能，这种方式需要手动配置 <code>acme.sh</code> 脚本和服务器。</li><li><strong>不提供 DDoS 防护和其他 Cloudflare 功能</strong>：这种方式只使用了 Cloudflare 的 DNS 服务，不提供 DDoS 防护、CDN 加速、WAF 等其他 Cloudflare 功能。</li></ol></li><li>Cloudflare<ol><li><strong>Origin CA 证书浏览器不信任</strong>：Cloudflare 的 Origin CA 证书不被浏览器信任，需要配合 Cloudflare 的代理服务使用。</li></ol></li></ul><h4 class=heading id=应用场景比较>应用场景比较
<a class=anchor href=#%e5%ba%94%e7%94%a8%e5%9c%ba%e6%99%af%e6%af%94%e8%be%83>#</a></h4><div class=table-outer><table><thead><tr><th>特性</th><th><code>acme.sh</code> + Let&rsquo;s Encrypt + Cloudflare DNS</th><th>Cloudflare 服务</th></tr></thead><tbody><tr><td><strong>适用场景</strong></td><td>- 不需要 Cloudflare 代理- 需要在其他服务上使用证书- 希望完全控制证书</td><td>- 需要 DDoS 防护- 需要 CDN 加速- 需要 WAF- 希望隐藏服务器 IP- 需要简单易用的 SSL 配置</td></tr><tr><td><strong>SSL 证书</strong></td><td>Let&rsquo;s Encrypt 免费证书</td><td>Cloudflare Universal SSL 或 Origin CA 证书</td></tr><tr><td><strong>泛域名证书</strong></td><td>支持</td><td>支持（Origin CA 证书需配合代理使用）</td></tr><tr><td><strong>服务器 IP</strong></td><td>暴露</td><td>隐藏</td></tr><tr><td><strong>DDoS 防护</strong></td><td>无</td><td>有</td></tr><tr><td><strong>CDN 加速</strong></td><td>无</td><td>有</td></tr><tr><td><strong>WAF</strong></td><td>无</td><td>有</td></tr><tr><td><strong>配置难度</strong></td><td>相对复杂</td><td>简单</td></tr><tr><td><strong>控制权</strong></td><td>完全控制</td><td>部分控制</td></tr><tr><td><strong>依赖性</strong></td><td>仅依赖 Cloudflare DNS 和 Let&rsquo;s Encrypt</td><td>依赖 Cloudflare 的所有服务</td></tr></tbody></table></div></div></article><div class=single-comments><script src=https://giscus.app/client.js data-repo=eaiu/eaiu.github.io data-repo-id=R_kgDOPMv-Yw data-category data-category-id=DIC_kwDOPMv-Y84CtAeO data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div><div class=single-pagination><hr><div class=flexnowrap><div class=single-pagination-prev><div class=single-pagination-container-prev><div class=single-pagination-text>←</div><div class=single-pagination-text><a href=/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B%E8%AE%B0%E5%BD%95/>服务器配置实战指南：从安全加固到Nginx反代部署</a></div></div></div><div class=single-pagination-next><div class=single-pagination-container-next><div class=single-pagination-text><a href=/explore/vaultwarden%E8%87%AA%E5%BB%BA%E5%AF%86%E7%A0%81%E5%BA%93/>自建Vaultwarden密码库：从部署到安全备份</a></div><div class=single-pagination-text>→</div></div></div></div><hr></div><div class=back-to-top><a href=#top>back to top</a></div></div></main></div><footer><p>All content licensed under <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a> unless otherwise stated. Copyright © 2025 ghung<br>Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/tomfran/typo>tomfran/typo</a></p></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></body><script src=/js/theme-switch.js></script><script defer src=/js/copy-code.js></script></html>