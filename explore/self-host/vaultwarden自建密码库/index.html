<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=icon type=image/ico href=https://blog.yzyy.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.yzyy.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.yzyy.de/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://blog.yzyy.de/android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://blog.yzyy.de/apple-touch-icon.png><meta name=description content="本文提供了一份从零开始自建Vaultwarden密码库的终极指南。内容详细记录了使用Docker Compose进行服务部署、配置Nginx反向代理（支持子路径和WebSocket）、开启移动端推送通知及SMTP邮件服务的全过程。此外，文章重点介绍了多项安全加固措施，包括设置随机访问路径、禁用注册、以及配置ttionya/vaultwarden-backup项目结合Rclone实现数据到多云存储的自动化、多策略（每日、每月）备份。是搭建个人专属、安全可靠密码管理器的完整实践记录。"><title>自建Vaultwarden密码库：从部署到安全备份 | G-Hung的博客</title><link rel=canonical href=https://blog.yzyy.de/explore/self-host/vaultwarden%E8%87%AA%E5%BB%BA%E5%AF%86%E7%A0%81%E5%BA%93/><meta property="og:url" content="https://blog.yzyy.de/explore/self-host/vaultwarden%E8%87%AA%E5%BB%BA%E5%AF%86%E7%A0%81%E5%BA%93/"><meta property="og:site_name" content="G-Hung的博客"><meta property="og:title" content="自建Vaultwarden密码库：从部署到安全备份"><meta property="og:description" content="本文提供了一份从零开始自建Vaultwarden密码库的终极指南。内容详细记录了使用Docker Compose进行服务部署、配置Nginx反向代理（支持子路径和WebSocket）、开启移动端推送通知及SMTP邮件服务的全过程。此外，文章重点介绍了多项安全加固措施，包括设置随机访问路径、禁用注册、以及配置ttionya/vaultwarden-backup项目结合Rclone实现数据到多云存储的自动化、多策略（每日、每月）备份。是搭建个人专属、安全可靠密码管理器的完整实践记录。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="explore"><meta property="article:published_time" content="2024-06-12T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-12T00:00:00+00:00"><meta property="article:tag" content="探索"><meta property="article:tag" content="自建"><link rel=stylesheet href=/assets/combined.min.be806a62e232b8aab7970cbeb5446714f1fa2b72839429784417fe16d18ba206.css media=all><script async src="https://www.googletagmanager.com/gtag/js?id=G-88BLW4V0HZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-88BLW4V0HZ")}</script></head><body class=auto><div class=content><header><div class=header><h1 class=header-title><a href=https://blog.yzyy.de/>G-Hung的博客</a></h1><div class=header-menu><p class=small><a href=/>/home</a></p><p class=small><a href=/post>/日常</a></p><p class=small><a href=/explore>/探索记录</a></p><p class=small><a href=/tags>/tags</a></p><a href=/index.xml target=_blank title=RSS class=rss-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></header><main class=main><div class=breadcrumbs><a href=/>Home</a><span class=breadcrumbs-separator>/</span><a href=/explore/>Explores</a><span class=breadcrumbs-separator>/</span>
<a href=/explore/self-host/vaultwarden%E8%87%AA%E5%BB%BA%E5%AF%86%E7%A0%81%E5%BA%93/>自建Vaultwarden密码库：从部署到安全备份</a></div><div class=autonumber><article><header class=single-intro-container><h1 class=single-title>自建Vaultwarden密码库：从部署到安全备份</h1><p class=single-summary>记录了如何使用Docker和Nginx自建Vaultwarden密码库，并涵盖了安全加固与多云端自动备份的完整流程。</p><div class=single-subsummary><img src=/avatar.jpg alt="Author Avatar"><div><p class=author>ghung</p><p class=single-date><time datetime=2024-06-12T00:00:00+00:00>2024 Jun 12</time>
&nbsp; · &nbsp;9 min read</p></div></div></header><div class=single-tags><span><a href=https://blog.yzyy.de/tags/%E6%8E%A2%E7%B4%A2/>#探索</a>
</span><span><a href=https://blog.yzyy.de/tags/%E8%87%AA%E5%BB%BA/>#自建</a></span></div><aside class=toc><p><strong>Table of contents</strong></p><nav id=TableOfContents><ul><li><a href=#搭建vaultwarden>搭建VaultWarden</a><ul><li><a href=#安装docker和docker-compose>安装docker和docker compose</a></li><li><a href=#部署vaultwarden>部署VaultWarden</a></li></ul></li><li><a href=#配置nginx>配置nginx</a></li><li><a href=#测试-websocket-连接>测试 WebSocket 连接</a></li><li><a href=#安全设置>安全设置</a><ul><li><a href=#cloudflare操作>cloudflare操作</a></li><li><a href=#vps操作>VPS操作</a></li><li><a href=#vaultwarden-自动备份配置>vaultwarden 自动备份配置</a></li></ul></li><li><a href=#客户端>客户端</a></li><li><a href=#使用技巧>使用技巧</a><ul><li><a href=#匹配模式>匹配模式</a></li></ul></li></ul></nav></aside><div class=single-content><h1 class=heading id=缘起>缘起
<a class=anchor href=#%e7%bc%98%e8%b5%b7>#</a></h1><p>在安全意识没有升高的时候，甚至想过记住一个可以应付各种网站要求的密码，一个包括特殊符号(如!.*&)、大小写字母、数字等集于一身的密码。这样我就可以所有账号可以使用一个通用的密码了😁。</p><p>后来不止一次感受到危机，各种账号好多使用了同一个密码，密码如果泄露，直接一锅端了。并且遇到过登录账号需要打开ios的记事本和密码app手动搜索和查找的尴尬时刻&mldr;</p><p>早已听过bitwarden的大名，这个软件可以满足我的所有需求：</p><ol><li>全平台：ios、web扩展、windows等等，可以在一端储存，多端访问。</li><li>数据安全：采用最先进的加密技术。确保密码和敏感信息在安全传输并存储在服务器上进行本地加密。</li><li>免费：最大的优点</li><li>生成强密码：集成生成强密码的工具</li></ol><p>由于Bitwarden官方部署机器最小的要求是2g，故选择社区版VaultWarden，可以私有部署，但比官方更轻量，使用 Rust 编写，改用 SQLite 数据库（现在也支持 MySQL 和 PostgreSQL），运行时只需要 10M 内存，可以说对硬件基本没有要求。</p><p>等有一天有了高性能机器可以尝试使用官方实例，参考教程<a href=https://linux.do/t/topic/261426>自建BitWarden</a></p><hr><h2 class=heading id=搭建vaultwarden>搭建VaultWarden
<a class=anchor href=#%e6%90%ad%e5%bb%bavaultwarden>#</a></h2><p>搭建部分参考<a href=https://linux.do/t/topic/261426>自建BitWarden-强大的跨平台密码管理系统#方案二：社区自建</a>，感谢。</p><h3 class=heading id=安装docker和docker-compose>安装docker和docker compose
<a class=anchor href=#%e5%ae%89%e8%a3%85docker%e5%92%8cdocker-compose>#</a></h3><p>参考本篇博客<a href=/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B%E8%AE%B0%E5%BD%95/#安装docker和dockercompose>服务器配置流程记录#安装 Docker</a></p><h3 class=heading id=部署vaultwarden>部署VaultWarden
<a class=anchor href=#%e9%83%a8%e7%bd%b2vaultwarden>#</a></h3><p>Vaultwarden 官方仓库：<a href=https://github.com/dani-garcia/vaultwarden>Vaultwarden</a>。</p><ol><li>创建数据存储路径（包含数据库和配置文件）</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p /vaultwarden/data	<span style=color:#888;font-style:italic># 创建数据目录，这里可以自行设置，之后的配置文件和数据库都会在这里。</span>
</span></span></code></pre></div><ol start=2><li>创建 docker-compose.yml
使用 docker compose 方式安装 vaultwarden</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=font-weight:700;font-style:italic>cd</span> vaultwarden	<span style=color:#888;font-style:italic># 进入你准备安装vaultwarden的目录，可自行修改</span>
</span></span><span style=display:flex><span>vim docker-compose.yml
</span></span></code></pre></div><p>以下是我经过调试的配置，开启了管理员页面和移动设备通知。修改下面的配置文件后粘贴到 docker-compose.yml 文件中。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  vaultwarden:
</span></span><span style=display:flex><span>    image: vaultwarden/server:latest
</span></span><span style=display:flex><span>    container_name: vaultwarden  <span style=color:#888;font-style:italic># 容器名称</span>
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    ports:
</span></span><span style=display:flex><span>      - <span style=color:#666;font-style:italic>&#34;80:80&#34;</span> <span style=color:#888;font-style:italic>#修改想要映射的端口</span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - ./data:/data    <span style=color:#888;font-style:italic># 配置数据存储路径。将./data修改为在第一步设置的数据存储路径</span>
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>ADMIN_TOKEN</span>=admin_tokens <span style=color:#888;font-style:italic># 管理员密钥，建议生成四十位以上</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#888;font-style:italic>#移动设备推送设置</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>PUSH_ENABLED</span>=<span style=font-weight:700;font-style:italic>true</span>       <span style=color:#888;font-style:italic># 这里的意思是打开推送功能（不开启的话移动设备无法接收通知）</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>PUSH_INSTALLATION_ID</span>=id <span style=color:#888;font-style:italic># 填入获取到的移动设备的推动通知的id</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>PUSH_INSTALLATION_KEY</span>=key     <span style=color:#888;font-style:italic># 填入key</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SIGNUPS_ALLOWED</span>=<span style=font-weight:700;font-style:italic>false</span>   <span style=color:#888;font-style:italic># 禁止新用户注册，可以在管理员页面邀请注册</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>DOMAIN</span>=https://域名/自定子路径/ <span style=color:#888;font-style:italic># 如果想要添加子路径，需要对应修改这里，一定要在nginx进行相应的分流</span>
</span></span><span style=display:flex><span>        <span style=color:#888;font-style:italic># SMTP 设置</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_HOST</span>=smtp.qq.com  <span style=color:#888;font-style:italic># SMTP 服务器地址，QQ 邮箱为 smtp.qq.com</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_FROM</span>=example@qq.com  <span style=color:#888;font-style:italic># 发件人邮箱地址，替换为你自己的 QQ 邮箱</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_FROM_NAME</span>=VaultwardenAdmin  <span style=color:#888;font-style:italic># 发件人名称，可以自定义</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_PORT</span>=465  <span style=color:#888;font-style:italic># SMTP 端口，QQ 邮箱使用 SSL 加密，端口为 465</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_SECURITY</span>=force_tls  <span style=color:#888;font-style:italic># SMTP 加密方式，QQ 邮箱使用 SSL 加密，设置为 force_tls</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_USERNAME</span>=example@qq.com  <span style=color:#888;font-style:italic># SMTP 用户名，通常为你的 QQ 邮箱地址</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_PASSWORD</span>=secret  <span style=color:#888;font-style:italic># SMTP 密码，此处填写 QQ 邮箱的 SMTP 授权码，不是邮箱登录密码</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_TIMEOUT</span>=15 <span style=color:#888;font-style:italic># 设置 SMTP 超时时间为 15 秒</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_EMBED_IMAGES</span>=<span style=font-weight:700;font-style:italic>true</span> <span style=color:#888;font-style:italic># 启用将图片嵌入邮件中</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  watchtower:
</span></span><span style=display:flex><span>    image: containrrr/watchtower
</span></span><span style=display:flex><span>    container_name: watchtower
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - /var/run/docker.sock:/var/run/docker.sock
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>TZ</span>=Asia/Shanghai
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>WATCHTOWER_CLEANUP</span>=<span style=font-weight:700;font-style:italic>true</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>WATCHTOWER_SCHEDULE</span>=0 0 4 * * * <span style=color:#888;font-style:italic># 每天凌晨4点检查并更新</span>
</span></span></code></pre></div><ol><li>密码生成网站：<a href=https://1password.com/zh-cn/password-generator>安全、强大的密码生成器 | 1Password</a></li><li>推送通知网站：<a href=https://bitwarden.com/host/>Requesting Hosting Installation ID & Key | Bitwarden</a></li><li>STMP服务：<a href=https://app.brevo.com/settings/keys/smtp>brevo</a>，最终没成功用上。</li></ol><p><strong>踩的坑</strong>：</p><ol><li><p>开启移动设备通知:
从Vaultwarden 1.29.0版本开始，可以启用移动客户端的推送通知，在移动应用程序、网页扩展程序和网页密码库之间自动同步您的个人密码库，而无需手动同步。</p><ul><li>访问 <a href=https://bitwarden.com/host/ title=https://bitwarden.com/host/>https://bitwarden.com/host/</a>，输入您的电子邮件地址，数据地区选择美国，然后您将获得一个INSTALLATION ID和KEY。</li><li>在你的docker-compose.yaml中添加以下环境变量</li></ul></li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>environment:
</span></span><span style=display:flex><span>- <span style=color:#666;font-weight:700;font-style:italic>PUSH_ENABLED</span>=<span style=font-weight:700;font-style:italic>true</span>
</span></span><span style=display:flex><span>- <span style=color:#666;font-weight:700;font-style:italic>PUSH_INSTALLATION_ID</span>=获得的id
</span></span><span style=display:flex><span>- <span style=color:#666;font-weight:700;font-style:italic>PUSH_INSTALLATION_KEY</span>=获得的key
</span></span></code></pre></div><p>如果在上一步中请求了 <code>bitwarden.eu（欧盟）</code>，还必须设置</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>- <span style=color:#666;font-weight:700;font-style:italic>PUSH_RELAY_URI</span>=https://push.bitwarden.eu
</span></span><span style=display:flex><span>- <span style=color:#666;font-weight:700;font-style:italic>PUSH_IDENTITY_URI</span>=https://identity.bitwarden.eu
</span></span></code></pre></div><ol start=2><li>自定子路径
一定要在nginx进行相应的分流设置</li></ol><p>第一次启动：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker compose up -d &amp;&amp; docker compose logs -f
</span></span></code></pre></div><p><code>docker compose logs -f</code> 是为了查看日志，如果报错的话可以查一查原因</p><p>如果更新 compose 文件之后的话用下面的命令启动：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker compose pull &amp;&amp; docker compose up -d &amp;&amp; docker compose logs -f
</span></span></code></pre></div><h2 class=heading id=配置nginx>配置nginx
<a class=anchor href=#%e9%85%8d%e7%bd%aenginx>#</a></h2><p>经过调试过后的nginx的配置文件</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen 80;
</span></span><span style=display:flex><span>    server_name example.com;
</span></span><span style=display:flex><span>    return 301 https://$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen 443 ssl;
</span></span><span style=display:flex><span>    server_name example.com;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ssl_certificate /etc/ssl/certs/example.com.pem;
</span></span><span style=display:flex><span>    ssl_certificate_key /etc/ssl/private/example.com.key;
</span></span><span style=display:flex><span>    ssl_protocols TLSv1.2 TLSv1.3; # 根据需要调整
</span></span><span style=display:flex><span>    ssl_ciphers HIGH:!aNULL:!MD5; # 根据需要调整
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    client_max_body_size 525M;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    location /子路径/ {
</span></span><span style=display:flex><span>        proxy_pass http://127.0.0.1:1256; # 注意修改端口
</span></span><span style=display:flex><span>        proxy_set_header Host $host;
</span></span><span style=display:flex><span>        proxy_set_header X-Real-IP $remote_addr;
</span></span><span style=display:flex><span>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        proxy_set_header X-Forwarded-Proto $scheme;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    location /子路径/notifications {
</span></span><span style=display:flex><span>         proxy_pass http://127.0.0.1:1256; # 注意修改端口
</span></span><span style=display:flex><span>         proxy_set_header Upgrade $http_upgrade;
</span></span><span style=display:flex><span>         proxy_set_header Connection &#34;upgrade&#34;;
</span></span><span style=display:flex><span>         proxy_http_version 1.1;
</span></span><span style=display:flex><span>         proxy_set_header Host $host;
</span></span><span style=display:flex><span>         proxy_set_header X-Real-IP $remote_addr;
</span></span><span style=display:flex><span>         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>         proxy_set_header X-Forwarded-Proto $scheme;
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    # 根路径返回 404 错误
</span></span><span style=display:flex><span>    location / {
</span></span><span style=display:flex><span>        return 404;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>踩的坑</strong>：</p><ol><li>子路径相匹配：<ul><li>一定要在docker-compose.yml加入相应的DOMAIN域的环境变量</li><li>admin管理页面可以不用配置</li></ul></li><li>新版vaultWarden可以不用手动进行websocket端口映射，在1.29版本之后共用一个80端口</li></ol><blockquote><p>自 Vaultwarden v1.29.0 起，WebSocket 默认启用。以前的版本需要反向代理，因为 WebSocket 运行在与默认的 HTTPS 端口不同的端口上。
自 Vaultwarden v1.29.0 版本起，旧的 <code>WEBSOCKET_ENABLED</code> 和 <code>WEBSOCKET_PORT</code> 已被弃用并将被忽略。在 v1.29.0 版本之后，您可以通过将 <code>ENABLE_WEBSOCKET</code> 设置为 <code>false</code> 值来禁用 Websocket 通知，这将减少 Vaultwarden 使用的资源（尽管不会太多）。</p></blockquote><ol start=3><li>需要为<code>/子路径/notifications</code>配置分流，不能仅为<code>/子路径/notifications/hub</code>配置分流会导致，使用移动设备准许登录不能生效</li></ol><h2 class=heading id=测试-websocket-连接>测试 WebSocket 连接
<a class=anchor href=#%e6%b5%8b%e8%af%95-websocket-%e8%bf%9e%e6%8e%a5>#</a></h2><p>有两种方式可以测试连接是否正常工作：</p><ol><li><p>打开浏览器的开发人员工具，转到网络选项卡然后筛选 <code>WS</code>/<code>WebSockets</code>。注销或刷新页面并再次登录，您应该会看到升级后的 WebSocket 连接的 101 响应。如果您单击该行，您应该能够看到消息。如果您没有在 <code>/notifications/hub</code> 上获得状态代码 101，则表示某些配置不正确。消息将显示在浏览器的控制台窗口中：<code>[2023-12-01T00:00:00.000Z] Information: WebSocket connected to wss://HOST_NAME/notifications/hub?access_token=eyJ0eX......</code></p></li><li><p>打开两个不同的浏览器或隐身/隐私窗口。在两个浏览器上登录您的帐户。创建一个新的条目，或者重命名一个条目，在另一个浏览器中应该会立即收到更改。</p></li><li><p>测试移动设备准许登录功能。</p></li></ol><h2 class=heading id=安全设置>安全设置
<a class=anchor href=#%e5%ae%89%e5%85%a8%e8%ae%be%e7%bd%ae>#</a></h2><h3 class=heading id=cloudflare操作>cloudflare操作
<a class=anchor href=#cloudflare%e6%93%8d%e4%bd%9c>#</a></h3><ul><li><code>SSL/TLS</code> <code>概述</code> 加密模式：完全（严格）</li></ul><h3 class=heading id=vps操作>VPS操作
<a class=anchor href=#vps%e6%93%8d%e4%bd%9c>#</a></h3><h4 class=heading id=设置随机子路径>设置随机子路径
<a class=anchor href=#%e8%ae%be%e7%bd%ae%e9%9a%8f%e6%9c%ba%e5%ad%90%e8%b7%af%e5%be%84>#</a></h4><ol><li>修改docker-compose.yml文件，environment变量加入DOMAIN域</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>environment:
</span></span><span style=display:flex><span>- DOMAIN=https://域名/自定子路径/ <span style=color:#888;font-style:italic># 如果想要添加子路径，需要对应修改这里，一定要在nginx进行相应的分流</span>
</span></span></code></pre></div><ol start=2><li>设置子路径分流</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>location</span> <span style=color:#666;font-style:italic>/子路径/</span> {
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>proxy_pass</span> <span style=color:#666;font-style:italic>http://127.0.0.1:1256</span>; <span style=color:#888;font-style:italic># 注意修改端口
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>        <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>Host</span> <span style=color:#666;font-weight:700;font-style:italic>$host</span>;
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Real-IP</span> <span style=color:#666;font-weight:700;font-style:italic>$remote_addr</span>;
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Forwarded-For</span> <span style=color:#666;font-weight:700;font-style:italic>$proxy_add_x_forwarded_for</span>;
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Forwarded-Proto</span> <span style=color:#666;font-weight:700;font-style:italic>$scheme</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=font-weight:700;text-decoration:underline>location</span> <span style=color:#666;font-style:italic>/子路径/notifications</span> {
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_pass</span> <span style=color:#666;font-style:italic>http://127.0.0.1:1256</span>; <span style=color:#888;font-style:italic># 注意修改端口
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>Upgrade</span> <span style=color:#666;font-weight:700;font-style:italic>$http_upgrade</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>Connection</span> <span style=color:#666;font-style:italic>&#34;upgrade&#34;</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_http_version</span> 1<span style=color:#666;font-style:italic>.1</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>Host</span> <span style=color:#666;font-weight:700;font-style:italic>$host</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Real-IP</span> <span style=color:#666;font-weight:700;font-style:italic>$remote_addr</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Forwarded-For</span> <span style=color:#666;font-weight:700;font-style:italic>$proxy_add_x_forwarded_for</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Forwarded-Proto</span> <span style=color:#666;font-weight:700;font-style:italic>$scheme</span>;
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#888;font-style:italic># 根路径返回 404 错误
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>    <span style=font-weight:700;text-decoration:underline>location</span> <span style=color:#666;font-style:italic>/</span> {
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>return</span> 404;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h4 class=heading id=关闭页面并禁用注册>关闭页面并禁用注册
<a class=anchor href=#%e5%85%b3%e9%97%ad%e9%a1%b5%e9%9d%a2%e5%b9%b6%e7%a6%81%e7%94%a8%e6%b3%a8%e5%86%8c>#</a></h4><p>查看网页端的密码重复泄露报告，然后关闭网页端</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>environment:
</span></span><span style=display:flex><span>- SIGNUPS_ALLOWED=false <span style=color:#888;font-style:italic>#关闭注册</span>
</span></span><span style=display:flex><span>- WEB_VAULT_ENABLED=false <span style=color:#888;font-style:italic>#关闭网页端</span>
</span></span></code></pre></div><h4 class=heading id=定时检查容器更新>定时检查容器更新
<a class=anchor href=#%e5%ae%9a%e6%97%b6%e6%a3%80%e6%9f%a5%e5%ae%b9%e5%99%a8%e6%9b%b4%e6%96%b0>#</a></h4><blockquote><p>2025年2月7日更新：watchtower的cron使用了SPRING语法</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  watchtower:
</span></span><span style=display:flex><span>    image: containrrr/watchtower
</span></span><span style=display:flex><span>    container_name: watchtower
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - /var/run/docker.sock:/var/run/docker.sock
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - TZ=Asia/Shanghai
</span></span><span style=display:flex><span>      - WATCHTOWER_CLEANUP=true
</span></span><span style=display:flex><span>      - WATCHTOWER_SCHEDULE=0 0 4 * * * <span style=color:#888;font-style:italic># 每天凌晨4点检查并更新</span>
</span></span></code></pre></div><h3 class=heading id=vaultwarden-自动备份配置>vaultwarden 自动备份配置
<a class=anchor href=#vaultwarden-%e8%87%aa%e5%8a%a8%e5%a4%87%e4%bb%bd%e9%85%8d%e7%bd%ae>#</a></h3><p>2025年5月16日更新</p><p>以下的自动备份配置为了达到良好的备份效果导致配置起来十分复杂与繁琐，经过长时间来看，我觉得没有必要额外备份。</p><p>之所以这么说的原因时bitwarden客户端的导出功能：我们一般会在多台设备上同时使用，PC、IOS\Android、Web浏览器等，不同客户端都会在本地储存一份数据。这些客户端天生形成了多份备份。</p><p>即使服务器宕机或者数据清空，直接使用客户端的导出功能即可备份。不过可能由于不同服务器间的同步延迟，与服务器数据有些许差异。但是一般更新密码的频率不是很高，所以可以忽略。</p><hr><p>异地定时备份。</p><p>使用项目<a href="https://github.com/ttionya/vaultwarden-backup?tab=readme-ov-file">GitHub - ttionya/vaultwarden-backup</a> 用于备份 <a href=https://github.com/dani-garcia/vaultwarden>vaultwarden</a> 数据，并通过 <a href=https://rclone.org/>Rclone</a> 同步到其他存储系统。</p><h4 class=heading id=使用步骤>使用步骤
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e6%ad%a5%e9%aa%a4>#</a></h4><h5 class=heading id=配置-rclone>配置 Rclone
<a class=anchor href=#%e9%85%8d%e7%bd%ae-rclone>#</a></h5><p><strong>重要提示：</strong> 备份前必须配置 Rclone，否则备份工具无法工作。还原备份则非必须配置 Rclone。</p><p><strong>配置步骤：</strong></p><ol><li><p><strong>运行 Rclone 配置容器：</strong></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --rm -it <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --mount <span style=color:#666;font-weight:700;font-style:italic>type</span>=volume,source=vaultwarden-rclone-data,target=/config/ <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  ttionya/vaultwarden-backup:latest <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  rclone config
</span></span></code></pre></div><ul><li><code>docker run --rm -it</code>：运行一个临时的、交互式的 Docker 容器。</li><li><code>--mount type=volume,source=vaultwarden-rclone-data,target=/config/</code>：将名为 <code>vaultwarden-rclone-data</code> 的 Docker 卷挂载到容器的 <code>/config</code> 目录，用于存储 Rclone 的配置文件。如果这个卷不存在，Docker 会自动创建它。</li><li><code>rclone config</code>：在容器中执行的命令，启动 Rclone 的交互式配置向导。</li></ul><p>此命令会启动 Rclone 的交互式配置向导，按照提示配置你的云存储服务。</p></li></ol><p>我准备同时备份到 Google Drive、Infini-cloud (WebDAV) 和 OneDrive 这三个网盘，并最终将它们合并到一个 <code>union</code> 远程中</p><p><strong>步骤：</strong>
这里十分复杂，但是跟着步骤一步步来不容易出错。</p><ol><li>配置 Google Drive 远程 （需要挂梯子才能收到回调）</li></ol><p>运行 Rclone 配置容器：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm -it <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --mount <span style=color:#666;font-weight:700;font-style:italic>type</span>=volume,source=vaultwarden-rclone-data,target=/config/ <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  ttionya/vaultwarden-backup:latest <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  rclone config
</span></span></code></pre></div><p>创建新远程 (New remote)：输入 n 并回车；命名远程：name> 后面输入 BitwardenBackup-GoogleDrive 并回车；选择存储类型：找到 Google Drive 对应的编号，通常是 20，输入 20 并回车；client_id：直接回车；client_secret：直接回车；选择权限范围 (scope)：输入 1 (选择 Full access all files, excluding Application Data folder.) 并回车；root_folder_id：直接回车；service_account_file：直接回车；编辑高级配置 (Edit advanced config)：输入 n 并回车；自动配置 (Use auto config)：输入 y 并回车；浏览器验证，复制授权码；粘贴授权码到 Enter verification code> 提示符后回车；是否是团队盘 (team drive)：根据需要输入 y 或直接回车；确认配置：输入 y 并回车。</p><ol start=2><li>配置 Infini-cloud (WebDAV) 远程</li></ol><p>运行 Rclone 配置容器；创建新远程 (New remote)：输入 n 并回车；命名远程：name> 后面输入 BitwardenBackup-InfiniCloud 并回车；选择存储类型：找到 WebDAV 对应的编号，通常是 56，输入 56 并回车；输入 url：url> 后面输入 Infini-cloud 提供的 WebDAV URL；输入 vendor：vendor> 后面输入 other 并回车；输入 user：user> 后面输入你的 Infini-cloud 用户名；输入 pass：pass> 后面输入 y 并回车，然后输入两次密码；输入 bearer_token：直接回车；编辑高级配置 (Edit advanced config)：输入 n 并回车；确认配置：输入 y 并回车。</p><ol start=3><li>配置 OneDrive 远程</li></ol><p>运行 Rclone 配置容器；创建新远程 (New remote)：输入 n 并回车；命名远程：name> 后面输入 BitwardenBackup-OneDrive 并回车；选择存储类型：找到 Microsoft OneDrive 对应的编号，通常是 36，输入 36 并回车；client_id：直接回车；client_secret：直接回车；选择地区 (region)：选择 global 对应的编号并回车；编辑高级配置 (Edit advanced config)：输入 n 并回车；自动配置 (Use auto config)：输入 y 并回车；浏览器验证，复制授权码；粘贴授权码到 Enter verification code> 提示符后回车；选择驱动器类型 (drive type)：根据你的 OneDrive 类型选择 personal、business 或 document library，输入对应的编号并回车; 选择驱动器 (drive id)：输入 0 并回车; 确认配置：输入 y 并回车。</p><ol start=4><li>配置 Union 远程</li></ol><p>运行 Rclone 配置容器；创建新远程 (New remote)：输入 n 并回车；命名远程：name> 后面输入 BitwardenBackup 并回车；选择存储类型：找到 Union 对应的编号，通常是 54，输入 54 并回车；输入 upstreams：upstreams> 后面输入你之前配置的三个远程的名称，用空格分隔：</p><p>BitwardenBackup-GoogleDrive: BitwardenBackup-InfiniCloud: BitwardenBackup-OneDrive:
输入 action_policy：输入 all 并回车；输入 create_policy：输入 all 并回车；输入 search_policy：输入 all 并回车；确认配置：输入 y 并回车。</p><ol start=5><li>配置完成后，运行以下命令检查配置是否正确：</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>    docker run --rm -it <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>      --mount <span style=color:#666;font-weight:700;font-style:italic>type</span>=volume,source=vaultwarden-rclone-data,target=/config/ <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>      ttionya/vaultwarden-backup:latest <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>      rclone config show
</span></span></code></pre></div><h5 class=heading id=修改-docker-composeyml-文件>修改 <code>docker-compose.yml</code> 文件
<a class=anchor href=#%e4%bf%ae%e6%94%b9-docker-composeyml-%e6%96%87%e4%bb%b6>#</a></h5><p>本方案采用每日备份，保留三十天，每月备份一次，保留十二个月的备份方式：开启两个backup服务-daily_backup和monthly_backup</p><p>将 <code>vaultwarden-backup</code> 服务的 <code>RCLONE_REMOTE_NAME</code> 环境变量设置为 <code>BitwardenBackup</code>。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  vaultwarden:
</span></span><span style=display:flex><span>    image: vaultwarden/server:latest
</span></span><span style=display:flex><span>    container_name: vaultwarden  
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    ports:
</span></span><span style=display:flex><span>      - <span style=color:#666;font-style:italic>&#34;1256:80&#34;</span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - ./data:/data    
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - ADMIN_TOKEN=gwQnrvr6sWcCiw6pYhUYFQVTTEPYWx4UR6uhTB73dsrPXDWEHhxC5Fs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#888;font-style:italic>#移动设备推送设置</span>
</span></span><span style=display:flex><span>      - PUSH_ENABLED=true       <span style=color:#888;font-style:italic># 这里的意思是打开推送功能（不开启的话移动设备无法接收通知）</span>
</span></span><span style=display:flex><span>      - PUSH_INSTALLATION_ID=eb1d824c-941d-4109-bb8d-b26a00cd0ba3
</span></span><span style=display:flex><span>      - PUSH_INSTALLATION_KEY=u1r438BxudgiOaURxOss     <span style=color:#888;font-style:italic># 填入key</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - SIGNUPS_ALLOWED=false   <span style=color:#888;font-style:italic># 禁止新用户注册，可以在管理员页面邀请注 册</span>
</span></span><span style=display:flex><span>      - DOMAIN=https://vtolove.me/psJm18PFVg8EkBnTA5Fi/
</span></span><span style=display:flex><span>         <span style=color:#888;font-style:italic># SMTP 设置</span>
</span></span><span style=display:flex><span>      - SMTP_HOST=smtp.qq.com  <span style=color:#888;font-style:italic># SMTP 服务器地址，QQ 邮箱为 smtp.qq.com</span>
</span></span><span style=display:flex><span>      - SMTP_FROM=849815996@qq.com  <span style=color:#888;font-style:italic># 发件人邮箱地址，替换为你自己的 QQ 邮箱</span>
</span></span><span style=display:flex><span>      - SMTP_FROM_NAME=VaultwardenAdmin  <span style=color:#888;font-style:italic># 发件人名称，可以自定义</span>
</span></span><span style=display:flex><span>      - SMTP_PORT=465  <span style=color:#888;font-style:italic># SMTP 端口，QQ 邮箱使用 SSL 加密，端口为 465</span>
</span></span><span style=display:flex><span>      - SMTP_SECURITY=force_tls  <span style=color:#888;font-style:italic># SMTP 加密方式，QQ 邮箱使用 SSL 加密，设置为 force_tls</span>
</span></span><span style=display:flex><span>      - SMTP_USERNAME=849815996@qq.com  <span style=color:#888;font-style:italic># SMTP 用户名，通常为你的 QQ 邮箱地址</span>
</span></span><span style=display:flex><span>      - SMTP_PASSWORD=lxpttclhjtcvbeja  <span style=color:#888;font-style:italic># SMTP 密码，此处填写 QQ 邮箱的 SMTP 授权码，不是邮箱登录密码</span>
</span></span><span style=display:flex><span>      - SMTP_TIMEOUT=15 <span style=color:#888;font-style:italic># 设置 SMTP 超时时间为 15 秒</span>
</span></span><span style=display:flex><span>      - SMTP_EMBED_IMAGES=true <span style=color:#888;font-style:italic># 启用将图片嵌入邮件中</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  daily_backup:
</span></span><span style=display:flex><span>    image: ttionya/vaultwarden-backup:latest
</span></span><span style=display:flex><span>    container_name: daily_vaultwarden_backup
</span></span><span style=display:flex><span>    restart: always
</span></span><span style=display:flex><span>    depends_on:
</span></span><span style=display:flex><span>      - vaultwarden
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - RCLONE_REMOTE_NAME=BitwardenBackup <span style=color:#888;font-style:italic># Rclone 远程名称，必须与 rclone 配置中的名称一致</span>
</span></span><span style=display:flex><span>      - RCLONE_REMOTE_DIR=/BitwardenBackup/daily/ <span style=color:#888;font-style:italic># 远程存储系统中存放备份文件的目录</span>
</span></span><span style=display:flex><span>      - BACKUP_KEEP_DAYS=30
</span></span><span style=display:flex><span>      - CRON= 3 4 * * *  <span style=color:#888;font-style:italic># 每日备份的 cron 表达式，设置为每天 04:00 执行</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># 通用备份设置</span>
</span></span><span style=display:flex><span>      - ZIP_PASSWORD=bDxhYG3ANhEqd1Ll0LCdUONmrs8hi4ERZfm   <span style=color:#888;font-style:italic>#备份文件的压缩密码，请替换为你自己的密码</span>
</span></span><span style=display:flex><span>      - BACKUP_FILE_SUFFIX=%Y%m%d <span style=color:#888;font-style:italic># 每日备份文件后缀，例如：20231027</span>
</span></span><span style=display:flex><span>      - TIMEZONE=Asia/Shanghai <span style=color:#888;font-style:italic># 设置时区为 Asia/Shanghai</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># 其他可选环境变量：</span>
</span></span><span style=display:flex><span>      - DATA_DIR=/data <span style=color:#888;font-style:italic># 指定存放 vaultwarden 数据的目录，默认为 /bitwarden/data，如果 vaultwarden 服务中配置了 volumes，这里通常不需要修改</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - BACKUP_FILE_DATE # 备份文件的时间前缀，默认为 %Y%m%d，通常不需要修改</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - BACKUP_FILE_DATE_SUFFIX # 备份文件的日期后缀，默认为 &#39;&#39;，通常不需要修改</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - DATA_DB # 指定 sqlite 数据库文件的路径，默认为 ${DATA_DIR}/db.sqlite3，通常不需要修改</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - DATA_RSAKEY # 指定 rsa_key 文件的路径，默认为 ${DATA_DIR}/rsa_key，通常不需要修改</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - DATA_ATTACHMENTS # 指定 attachments 文件夹路径，默认为 ${DATA_DIR}/attachments，通常不需要修改</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - DATA_SENDS # 指定 sends 文件夹路径，默认为 ${DATA_DIR}/sends，通常不需要修改</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># 通知设置 (可选，根据需要配置)</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - MAIL_SMTP_ENABLE=FALSE # 是否启用邮件通知，默认为 FALSE</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - MAIL_SMTP_VARIABLES= # 邮件发送参数，启用邮件通知时需要配置</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - MAIL_TO= # 接收邮件的地址，启用邮件通知时需要配置</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - MAIL_WHEN_SUCCESS=TRUE # 备份成功后发送邮件，默认为 TRUE</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - MAIL_WHEN_FAILURE=TRUE # 备份失败后发送邮件，默认为 TRUE</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL= # 备份完成后发送请求的地址 (无论成功或失败)</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_CURL_OPTIONS= # 与 PING_URL 搭配使用的 curl 选项</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_START= # 备份开始时发送请求的地址</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_START_CURL_OPTIONS= # 与 PING_URL_WHEN_START 搭配使用的 curl 选项</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_SUCCESS= # 备份成功后发送请求的地址</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_SUCCESS_CURL_OPTIONS= # 与 PING_URL_WHEN_SUCCESS 搭配使用的 curl 选项</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_FAILURE= # 备份失败后发送请求的地址</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_FAILURE_CURL_OPTIONS= # 与 PING_URL_WHEN_FAILURE 搭配使用的 curl 选项</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># RCLONE_GLOBAL_FLAG: &#39;&#39; # Rclone 全局参数，详见 rclone 文档，通常不需要修改</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - ./data:/data <span style=color:#888;font-style:italic># 挂载 vaultwarden 的数据目录</span>
</span></span><span style=display:flex><span>      - vaultwarden-rclone-data:/config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  monthly_backup:
</span></span><span style=display:flex><span>    image: ttionya/vaultwarden-backup:latest
</span></span><span style=display:flex><span>    container_name: monthly_valutwarden_backup
</span></span><span style=display:flex><span>    restart: always
</span></span><span style=display:flex><span>    depends_on:
</span></span><span style=display:flex><span>      - vaultwarden
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - RCLONE_REMOTE_NAME=BitwardenBackup
</span></span><span style=display:flex><span>      - RCLONE_REMOTE_DIR=/BitwardenBackup/monthly/
</span></span><span style=display:flex><span>      - ZIP_PASSWORD=bDxhYG3ANhEqd1Ll0LCdUONmrs8hi4ERZfm
</span></span><span style=display:flex><span>      - BACKUP_KEEP_DAYS=365
</span></span><span style=display:flex><span>      - CRON= 0 4 1 * *  <span style=color:#888;font-style:italic># 每月备份的 cron 表达式，设置为每月 1 号 00:00 执行</span>
</span></span><span style=display:flex><span>      - TIMEZONE=Asia/Shanghai
</span></span><span style=display:flex><span>      - DATA_DIR=/data
</span></span><span style=display:flex><span>      - BACKUP_FILE_SUFFIX=%Y%m <span style=color:#888;font-style:italic># 每月备份文件后缀，例如：202310</span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - ./data:/data
</span></span><span style=display:flex><span>      - vaultwarden-rclone-data:/config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  watchtower:
</span></span><span style=display:flex><span>    image: containrrr/watchtower
</span></span><span style=display:flex><span>    container_name: watchtower
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - /var/run/docker.sock:/var/run/docker.sock
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - TZ=Asia/Shanghai
</span></span><span style=display:flex><span>      - WATCHTOWER_CLEANUP=true
</span></span><span style=display:flex><span>      - WATCHTOWER_SCHEDULE=0 0 4 * * *
</span></span><span style=display:flex><span>    depends_on:
</span></span><span style=display:flex><span>      - vaultwarden
</span></span><span style=display:flex><span>      - daily_backup
</span></span><span style=display:flex><span>      - monthly_backup 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>volumes:
</span></span><span style=display:flex><span>  vaultwarden-rclone-data:
</span></span><span style=display:flex><span>    external: <span style=font-weight:700;text-decoration:underline>true</span>
</span></span><span style=display:flex><span>    name: vaultwarden-rclone-data
</span></span></code></pre></div><ul><li><strong><code>RCLONE_REMOTE_NAME=BitwardenBackup</code>：</strong> 将备份目标设置为 <code>union</code> 远程。</li><li><strong><code>RCLONE_REMOTE_DIR=/BitwardenBackup/daily</code>：</strong> 设置备份到 <code>union</code> 远程的 <code>/BitwardenBackup/daily/</code> 文件夹，每天4点左右进行备份</li><li><code>RCLONE_REMOTE_DIR=/BitwardenBackup/monthly:</code>设置备份到 <code>union</code> 远程的 <code>/BitwardenBackup/monthly/</code> 文件夹，每个月一号进行备份</li></ul><p>重启服务</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose up -d
</span></span></code></pre></div><ul><li>手动备份操作（可用来验证配置是否正确）</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker <span style=font-weight:700;font-style:italic>exec</span> daily_vaultwarden_backup bash /app/backup.sh
</span></span></code></pre></div><h5 class=heading id=还原备份还未验证步骤正确性>还原备份（还未验证步骤正确性）
<a class=anchor href=#%e8%bf%98%e5%8e%9f%e5%a4%87%e4%bb%bd%e8%bf%98%e6%9c%aa%e9%aa%8c%e8%af%81%e6%ad%a5%e9%aa%a4%e6%ad%a3%e7%a1%ae%e6%80%a7>#</a></h5><p><strong>重要提示：</strong> 还原备份会覆盖已存在的文件。操作前请务必停止 vaultwarden 容器。</p><p><strong>步骤：</strong></p><ol><li><p><strong>下载备份文件到本地计算机。</strong></p></li><li><p><strong>进入备份文件所在目录。</strong></p></li><li><p><strong>根据你的部署方式选择以下命令之一运行还原容器：</strong></p><p><strong>a. 使用 <code>docker-compose.yml</code> 部署的：</strong></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --rm -it <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --mount <span style=color:#666;font-weight:700;font-style:italic>type</span>=volume,source=vaultwarden-data,target=/bitwarden/data/ <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --mount <span style=color:#666;font-weight:700;font-style:italic>type</span>=bind,source=<span style=font-weight:700;text-decoration:underline>$(</span><span style=font-weight:700;font-style:italic>pwd</span><span style=font-weight:700;text-decoration:underline>)</span>,target=/bitwarden/restore/ <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  ttionya/vaultwarden-backup:latest restore <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  [OPTIONS]
</span></span></code></pre></div><ul><li><code>docker run --rm -it</code>：运行一个临时的、交互式的 Docker 容器。</li><li><code>--mount type=volume,source=vaultwarden-data,target=/bitwarden/data/</code> 或 <code>--mount type=bind,source="本地目录的绝对路径",target=/data/</code> 或 <code>--mount type=volume,source="Docker 卷名称",target=/data/</code>：将 vaultwarden 的数据目录挂载到容器的 <code>/bitwarden/data</code> 或 <code>/data</code> 目录。</li><li><code>--mount type=bind,source=$(pwd),target=/bitwarden/restore/</code>：将当前目录（备份文件所在目录）挂载到容器的 <code>/bitwarden/restore</code> 目录。</li><li><code>-e DATA_DIR="/data"</code>：指定 vaultwarden 的数据目录（如果使用“自动备份”方式部署）。</li><li><code>ttionya/vaultwarden-backup:latest restore</code>：指定要运行的 Docker 镜像，并执行 <code>restore</code> 命令。</li><li><code>[OPTIONS]</code>：可选参数，见下文“还原选项”。</li></ul></li></ol><h5 class=heading id=可用的环境变量>可用的环境变量
<a class=anchor href=#%e5%8f%af%e7%94%a8%e7%9a%84%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f>#</a></h5><p>所有环境变量都有默认值，可以在不设置任何环境变量的情况下使用 Docker 镜像。</p><h6 class=heading id=核心配置>核心配置
<a class=anchor href=#%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae>#</a></h6><ul><li><strong><code>RCLONE_REMOTE_NAME</code></strong> (默认：<code>BitwardenBackup</code>)：Rclone 远程名称，必须与 <code>rclone config</code> 中设置的远程名称一致。</li><li><strong><code>RCLONE_REMOTE_DIR</code></strong> (默认：<code>/BitwardenBackup/</code>)：远程存储系统中存放备份文件的文件夹路径。</li><li><strong><code>RCLONE_GLOBAL_FLAG</code></strong> (默认：<code>''</code>)：Rclone 全局参数，详见 <a href=https://rclone.org/flags/>Rclone 文档</a>。<strong>不要添加会改变输出的全局参数，比如 <code>-P</code>，它会影响删除过期备份文件的操作。</strong></li><li><strong><code>CRON</code></strong> (默认：<code>5 * * * *</code>)：<code>crond</code> 的规则，基于 <a href=https://github.com/aptible/supercronic><code>supercronic</code></a>。可以在 <a href=https://crontab.guru/#5_*_*_*_*>这里</a> 进行测试。解释：默认每小时的 05 分自动备份。</li><li><strong><code>ZIP_ENABLE</code></strong> (默认：<code>TRUE</code>)：是否将所有备份文件打包为压缩文件。设置为 <code>'FALSE'</code> 时，会单独上传每个备份文件。</li><li><strong><code>ZIP_PASSWORD</code></strong> (默认：<code>WHEREISMYPASSWORD?</code>)：压缩文件的密码。</li><li><strong><code>ZIP_TYPE</code></strong> (默认：<code>zip</code>)：压缩文件格式，支持 <code>zip</code> 和 <code>7z</code>。</li><li><strong><code>BACKUP_KEEP_DAYS</code></strong> (默认：<code>0</code>)：在远程存储系统中保留最近 X 天的备份文件。设置为 <code>0</code> 会保留所有备份文件。</li><li><strong><code>BACKUP_FILE_SUFFIX</code></strong> (默认：<code>%Y%m%d</code>)：备份文件后缀，控制备份文件的命名格式。可以在 <a href=https://man7.org/linux/man-pages/man1/date.1.html>这里</a> 查看时间格式化说明。</li><li><strong><code>TIMEZONE</code></strong> (默认：<code>UTC</code>)：设置时区名称，例如北京时区设置为 <code>Asia/Shanghai</code>。可以在 <a href=https://en.wikipedia.org/wiki/List_of_tz_database_time_zones>维基百科</a> 查看所有时区名称。</li><li><strong><code>DATA_DIR</code></strong> (默认：<code>/bitwarden/data</code>)：指定存放 vaultwarden 数据的目录。使用 <code>Docker Compose</code> 时通常不需要修改，使用自动备份时通常需要修改为 <code>/data</code>。</li></ul><h6 class=heading id=通知>通知
<a class=anchor href=#%e9%80%9a%e7%9f%a5>#</a></h6><ol><li>Mail</li></ol><ul><li><strong><code>MAIL_SMTP_ENABLE</code></strong> (默认：<code>FALSE</code>)：启用邮件发送功能。</li><li><strong><code>MAIL_SMTP_VARIABLES</code></strong> (默认：无)：邮件发送参数，需要自行配置，详见下方示例。</li><li><strong><code>MAIL_TO</code></strong> (默认：无)：接收邮件的地址。</li><li><strong><code>MAIL_WHEN_SUCCESS</code></strong> (默认：<code>TRUE</code>)：备份成功后发送邮件。</li><li><strong><code>MAIL_WHEN_FAILURE</code></strong> (默认：<code>TRUE</code>)：备份失败后发送邮件。</li></ul><p><strong><code>MAIL_SMTP_VARIABLES</code> 示例 (以 Zoho 为例)：</strong></p><pre tabindex=0><code>-S smtp-use-starttls \
-S smtp=smtp://smtp.zoho.com:587 \
-S smtp-auth=login \
-S smtp-auth-user=&lt;your-email-address&gt; \
-S smtp-auth-password=&lt;your-email-password&gt; \
-S from=&lt;your-email-address&gt;
</code></pre><p><strong>邮件发送测试：</strong></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --rm -it -e <span style=color:#666;font-weight:700;font-style:italic>MAIL_SMTP_VARIABLES</span>=<span style=color:#666;font-style:italic>&#39;&lt;your smtp variables&gt;&#39;</span> ttionya/vaultwarden-backup:latest mail &lt;mail send to&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 或</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker run --rm -it -e <span style=color:#666;font-weight:700;font-style:italic>MAIL_SMTP_VARIABLES</span>=<span style=color:#666;font-style:italic>&#39;&lt;your smtp variables&gt;&#39;</span> -e <span style=color:#666;font-weight:700;font-style:italic>MAIL_TO</span>=<span style=color:#666;font-style:italic>&#39;&lt;mail send to&gt;&#39;</span> ttionya/vaultwarden-backup:latest mail
</span></span></code></pre></div><ol start=2><li>Ping</li></ol><ul><li><strong><code>PING_URL</code></strong>：备份完成后发送请求的地址 (无论成功或失败)。</li><li><strong><code>PING_URL_CURL_OPTIONS</code></strong>：与 <code>PING_URL</code> 搭配使用的 curl 选项。</li><li><strong><code>PING_URL_WHEN_START</code></strong>：备份开始时发送请求的地址。</li><li><strong><code>PING_URL_WHEN_START_CURL_OPTIONS</code></strong>：与 <code>PING_URL_WHEN_START</code> 搭配使用的 curl 选项。</li><li><strong><code>PING_URL_WHEN_SUCCESS</code></strong>：备份成功后发送请求的地址。</li><li><strong><code>PING_URL_WHEN_SUCCESS_CURL_OPTIONS</code></strong>：与 <code>PING_URL_WHEN_SUCCESS</code> 搭配使用的 curl 选项。</li><li><strong><code>PING_URL_WHEN_FAILURE</code></strong>：备份失败后发送请求的地址。</li><li><strong><code>PING_URL_WHEN_FAILURE_CURL_OPTIONS</code></strong>：与 <code>PING_URL_WHEN_FAILURE</code> 搭配使用的 curl 选项。</li></ul><p><strong>占位符：</strong></p><ul><li><code>%{subject}</code>：替换为实际的标题。</li><li><code>%{content}</code>：替换为实际的内容。</li></ul><p><strong>Ping 发送测试：</strong></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --rm -it <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL</span>=<span style=color:#666;font-style:italic>&#39;&lt;your ping url&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_CURL_OPTIONS</span>=<span style=color:#666;font-style:italic>&#39;&lt;your curl options for PING_URL&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_START</span>=<span style=color:#666;font-style:italic>&#39;&lt;your ping url&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_START_CURL_OPTIONS</span>=<span style=color:#666;font-style:italic>&#39;&lt;your curl options for PING_URL_WHEN_START&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_SUCCESS</span>=<span style=color:#666;font-style:italic>&#39;&lt;your ping url&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_SUCCESS_CURL_OPTIONS</span>=<span style=color:#666;font-style:italic>&#39;&lt;your curl options for PING_URL_WHEN_SUCCESS&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_FAILURE</span>=<span style=color:#666;font-style:italic>&#39;&lt;your ping url&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_FAILURE_CURL_OPTIONS</span>=<span style=color:#666;font-style:italic>&#39;&lt;your curl options for PING_URL_WHEN_FAILURE&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  ttionya/vaultwarden-backup:latest ping &lt;<span style=font-weight:700;font-style:italic>test</span> identifier&gt;
</span></span></code></pre></div><p><strong>解释：</strong></p><ul><li><code>&lt;test identifier></code> 可以是 <code>completion</code>、<code>start</code>、<code>success</code> 或 <code>failure</code>，决定使用哪一组环境变量。</li></ul><h6 class=heading id=其他环境变量-通常无需修改>其他环境变量 (通常无需修改)
<a class=anchor href=#%e5%85%b6%e4%bb%96%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f-%e9%80%9a%e5%b8%b8%e6%97%a0%e9%9c%80%e4%bf%ae%e6%94%b9>#</a></h6><ul><li><strong><code>BACKUP_FILE_DATE</code></strong> (默认：<code>%Y%m%d</code>)：备份文件的时间前缀，建议使用 <code>BACKUP_FILE_SUFFIX</code> 替代。</li><li><strong><code>BACKUP_FILE_DATE_SUFFIX</code></strong> (默认：<code>''</code>)：备份文件的日期后缀，建议使用 <code>BACKUP_FILE_SUFFIX</code> 替代。</li><li><strong><code>DATA_DB</code></strong> (默认：<code>${DATA_DIR}/db.sqlite3</code>)：指定 sqlite 数据库文件的路径。</li><li><strong><code>DATA_RSAKEY</code></strong> (默认：<code>${DATA_DIR}/rsa_key</code>)：指定 rsa_key 文件的路径。</li><li><strong><code>DATA_ATTACHMENTS</code></strong> (默认：<code>${DATA_DIR}/attachments</code>)：指定 attachments 文件夹路径。</li><li><strong><code>DATA_SENDS</code></strong> (默认：<code>${DATA_DIR}/sends</code>)：指定 sends 文件夹路径。</li></ul><h2 class=heading id=客户端>客户端
<a class=anchor href=#%e5%ae%a2%e6%88%b7%e7%ab%af>#</a></h2><p>Bitwarden 提供了全平台的客户端软件，以下是常用的一些平台客户端，附上了链接，可以直接下载</p><ul><li><a href=https://chrome.google.com/webstore/detail/bitwarden-free-password-m/nngceckbapebfimnlniiiahkandclblb title=Chrome>Chrome</a></li><li><a href=https://addons.mozilla.org/firefox/addon/bitwarden-password-manager/ title=FireFox>FireFox</a></li><li><a href=https://itunes.apple.com/app/bitwarden/id1352778147 title=Safari>Safari</a></li><li><a href="https://vault.bitwarden.com/download/?app=desktop&amp;platform=windows" title=Windows>Windows</a></li><li><a href=https://itunes.apple.com/app/bitwarden/id1352778147 title=MacOS>MacOS</a></li><li><a href="https://vault.bitwarden.com/download/?app=desktop&amp;platform=linux" title=Linux>Linux</a></li><li>iOS：App Store 搜索 BitWarden</li><li>Android： Google Play 搜索 BitWarden</li></ul><p>未在此列的平台，可前往官网进行下载：<a href=https://bitwarden.com/download>Download the Bitwarden Password Manager App for iPhone, Android, Chrome, Safari, and More | Bitwarden</a></p><h2 class=heading id=使用技巧>使用技巧
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e6%8a%80%e5%b7%a7>#</a></h2><h3 class=heading id=匹配模式>匹配模式
<a class=anchor href=#%e5%8c%b9%e9%85%8d%e6%a8%a1%e5%bc%8f>#</a></h3><p>bitwarden匹配模式十分重要，它决定了你的账号密码<strong>何时自动填充</strong>到网页中，默认是<code>基础域</code>模式，可以根据自己需求适当调整。各个匹配模式<a href=https://help.ppgg.in/auto-fill/using-uris#match-detection-options>摘录</a>如下：</p><h4 class=heading id=基础域>基础域
<a class=anchor href=#%e5%9f%ba%e7%a1%80%e5%9f%9f>#</a></h4><p>选择基础域，当登录项目的 URI 值的顶级域名和第二级名与检测到的资源相匹配时，Bitwarden 将弹出提示以提供自动填充。<br>例如，URI 的值为<code>https://google.com</code>，使用基础域匹配检测：</p><div class=table-outer><table><thead><tr><th>URL</th><th>自动填充？</th></tr></thead><tbody><tr><td><a href=http://google.com/>http://google.com</a></td><td>✔︎</td></tr><tr><td><a href=https://accounts.google.com/>https://accounts.google.com</a></td><td>✔︎</td></tr><tr><td><a href=https://google.net/>https://google.net</a></td><td>✘</td></tr><tr><td><a href=http://yahoo.com/>http://yahoo.com</a></td><td>✘</td></tr></tbody></table></div><h4 class=heading id=主机>主机
<a class=anchor href=#%e4%b8%bb%e6%9c%ba>#</a></h4><p>选择主机，当登录项目的 URI 值的主机名和端口（若指定了）与检测到的资源相匹配时，Bitwarden 将弹出提示以提供自动填充。<br>例如，URI 的值为<code>https://sub.domain.com:4000</code>，使用主机匹配检测：</p><div class=table-outer><table><thead><tr><th>URL</th><th>自动填充？</th></tr></thead><tbody><tr><td><a href=http://sub.domain.com:4000/>http://sub.domain.com:4000</a></td><td>✔︎</td></tr><tr><td><a href=https://sub.domain.com:4000/page.html>https://sub.domain.com:4000/page.html</a></td><td>✔︎</td></tr><tr><td><a href=https://domain.com/>https://domain.com</a></td><td>✘</td></tr><tr><td><a href=https://sub.domain.com/>https://sub.domain.com</a></td><td>✘</td></tr><tr><td><a href=https://sub2.sub.domain.com:4000/>https://sub2.sub.domain.com:4000</a></td><td>✘</td></tr><tr><td><a href=https://sub.domain.com:5000/>https://sub.domain.com:5000</a></td><td>✘</td></tr></tbody></table></div><h4 class=heading id=开始于>开始于
<a class=anchor href=#%e5%bc%80%e5%a7%8b%e4%ba%8e>#</a></h4><p>选择开始于，当检测到的资源以登录项目的 URI 值开头（无论后面跟什么）时，Bitwarden 将弹出提示以提供自动填充。<br>例如，URI 的值为<code>https://sub.domain.com/path/</code>，使用开始于匹配检测：</p><div class=table-outer><table><thead><tr><th>URL</th><th>自动填充？</th></tr></thead><tbody><tr><td><a href=https://sub.domain.com/path/>https://sub.domain.com/path/</a></td><td>✔︎</td></tr><tr><td><a href=https://sub.domain.com/path/page.html>https://sub.domain.com/path/page.html</a></td><td>✔︎</td></tr><tr><td><a href=https://sub.domain.com/>https://sub.domain.com</a></td><td>✘</td></tr><tr><td><a href=https://sub.domain.com:4000/path/page.html%EF%BC%88%E8%A2%AB%E7%AB%AF%E5%8F%A3%E9%98%BB%E6%96%AD%E4%BA%86%EF%BC%89>https://sub.domain.com:4000/path/page.html（被端口阻断了）</a></td><td>✘</td></tr><tr><td><a href=https://sub.domain.com/path%EF%BC%88%E7%BC%BA%E5%B0%91%E6%96%9C%E6%9D%A0%EF%BC%89>https://sub.domain.com/path（缺少斜杠）</a></td><td>✘</td></tr></tbody></table></div><h4 class=heading id=正则表达式>正则表达式
<a class=anchor href=#%e6%ad%a3%e5%88%99%e8%a1%a8%e8%be%be%e5%bc%8f>#</a></h4><p>选择正则表达式，当检测到的资源与一个指定的正则表达式相匹配时，Bitwarden 将弹出提示以提供自动填充。正则表达式始终不区分大小写。</p><h5 class=heading id=不安全示例>不安全示例
<a class=anchor href=#%e4%b8%8d%e5%ae%89%e5%85%a8%e7%a4%ba%e4%be%8b>#</a></h5><p>URI 的值为<code>^https://.*google\.com$</code>，使用正则表达式匹配检测：</p><div class=table-outer><table><thead><tr><th>URL</th><th>自动填充？</th></tr></thead><tbody><tr><td><a href=https://google.com/>https://google.com</a></td><td>✔︎</td></tr><tr><td><a href=https://sub.google.com/>https://sub.google.com</a></td><td>✔︎</td></tr><tr><td><a href="https://malicious-site.com/?q=google.com">https://malicious-site.com?q=google.com</a></td><td>✔︎</td></tr><tr><td><a href=http://google.com/>http://google.com</a></td><td>✘</td></tr><tr><td><a href=https://yahoo.com/>https://yahoo.com</a></td><td>✘</td></tr></tbody></table></div><p>这可能比预期的要匹配得更多。</p><h5 class=heading id=安全示例>安全示例
<a class=anchor href=#%e5%ae%89%e5%85%a8%e7%a4%ba%e4%be%8b>#</a></h5><p>URI 的值为<code>^https://[a-z]+\.wikipedia\.org/w/index\.php</code>，使用正则表达式匹配检测：</p><div class=table-outer><table><thead><tr><th>URL</th><th>自动填充？</th></tr></thead><tbody><tr><td><a href="https://en.wikipedia.org/w/index.php?title=Special:UserLogin&amp;returnto=Bitwarden">https://en.wikipedia.org/w/index.php?title=Special:UserLogin&amp;returnto=Bitwarden</a></td><td>✔︎</td></tr><tr><td><a href="https://pl.wikipedia.org/w/index.php?title=Specjalna:Zaloguj&amp;returnto=Bitwarden">https://pl.wikipedia.org/w/index.php?title=Specjalna:Zaloguj&amp;returnto=Bitwarden</a></td><td>✔︎</td></tr><tr><td><a href=https://en.wikipedia.org/w/index.php>https://en.wikipedia.org/w/index.php</a></td><td>✔︎</td></tr><tr><td><a href=https://malicious-site.com/>https://malicious-site.com</a></td><td>✘</td></tr><tr><td><a href=https://en.wikipedia.org/wiki/Bitwarden>https://en.wikipedia.org/wiki/Bitwarden</a></td><td>✘</td></tr></tbody></table></div><h4 class=heading id=精确>精确
<a class=anchor href=#%e7%b2%be%e7%a1%ae>#</a></h4><p>选择精确，当登录项目的 URI 值与检测到的资源精确匹配时，Bitwarden 将弹出提示以提供自动填充。<br>例如，URI 的值为<code>https://www.google.com/page.html</code>，使用精确匹配检测：</p><div class=table-outer><table><thead><tr><th>URL</th><th>自动填充？</th></tr></thead><tbody><tr><td><a href=https://www.google.com/page.html>https://www.google.com/page.html</a></td><td>✔︎</td></tr><tr><td><a href=http://www.google.com/page.html>http://www.google.com/page.html</a></td><td>✘</td></tr><tr><td><a href="https://www.google.com/page.html?query=123">https://www.google.com/page.html?query=123</a></td><td>✘</td></tr><tr><td><a href=https://www.google.com/>https://www.google.com</a></td><td>✘</td></tr></tbody></table></div><h4 class=heading id=从不>从不
<a class=anchor href=#%e4%bb%8e%e4%b8%8d>#</a></h4><p>选择从不，Bitwarden 将<strong>从不</strong>为登录项目弹出以提供自动填充。</p><hr><p>帮助文档:</p><ul><li><a href=https://rs.ppgg.in/>关于 | Vaultwarden Wiki 中文版</a></li><li><a href=https://help.ppgg.in/>关于 | Bitwarden 帮助中心中文版</a></li></ul></div></article><div class=single-comments><script src=https://giscus.app/client.js data-repo=eaiu/eaiu.github.io data-repo-id=R_kgDOPMv-Yw data-category data-category-id=DIC_kwDOPMv-Y84CtAeO data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div><div class=single-pagination><hr><div class=flexnowrap><div class=single-pagination-prev><div class=single-pagination-container-prev><div class=single-pagination-text>←</div><div class=single-pagination-text><a href=/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E5%9F%9F%E5%90%8D%E7%9B%B8%E5%85%B3/>域名管理：Cloudflare DNS托管与SSL证书配置</a></div></div></div><div class=single-pagination-next><div class=single-pagination-container-next><div class=single-pagination-text><a href=/explore/self-host/syncclipboard%E6%9B%BF%E4%BB%A3%E5%BE%AE%E4%BF%A1%E8%BE%93%E5%85%A5%E6%B3%95%E5%90%8C%E6%AD%A5%E5%8A%9F%E8%83%BD%E7%9A%84%E6%9C%80%E4%BD%B3%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/>SyncClipboard：替代微信输入法同步功能的最佳解决方案</a></div><div class=single-pagination-text>→</div></div></div></div><hr></div><div class=back-to-top><a href=#top>back to top</a></div></div></main></div><footer><p>All content licensed under <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a> unless otherwise stated. Copyright © 2025 ghung<br>Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/tomfran/typo>tomfran/typo</a></p></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></body><script src=/js/theme-switch.js></script><script defer src=/js/copy-code.js></script></html>