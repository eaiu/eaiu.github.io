<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=icon type=image/ico href=https://blog.yzyy.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.yzyy.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.yzyy.de/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://blog.yzyy.de/android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://blog.yzyy.de/apple-touch-icon.png><meta name=description content=" 本笔记详细记录了服务器的完整配置流程。内容包括基础安全措施、Docker和Docker Compose的安装与配置、使用Nginx设置反向代理并配置SSL证书，以及如何创建和管理Swap交换空间，是面向开发者和系统管理员的实用服务器初始化指南。"><title>服务器配置实战指南：从安全加固到Nginx反代部署 | G-Hung的博客</title><link rel=canonical href=https://blog.yzyy.de/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B%E8%AE%B0%E5%BD%95/><meta property="og:url" content="https://blog.yzyy.de/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B%E8%AE%B0%E5%BD%95/"><meta property="og:site_name" content="G-Hung的博客"><meta property="og:title" content="服务器配置实战指南：从安全加固到Nginx反代部署"><meta property="og:description" content="本笔记详细记录了服务器的完整配置流程。内容包括基础安全措施、Docker和Docker Compose的安装与配置、使用Nginx设置反向代理并配置SSL证书，以及如何创建和管理Swap交换空间，是面向开发者和系统管理员的实用服务器初始化指南。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="explore"><meta property="article:published_time" content="2024-04-12T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-12T00:00:00+00:00"><meta property="article:tag" content="探索"><meta property="article:tag" content="服务器"><link rel=stylesheet href=/assets/combined.min.b72766531fc58b8c9eb741223d816b1c10ab962791e1d50d5f6fcb81345cde80.css media=all><script async src="https://www.googletagmanager.com/gtag/js?id=G-88BLW4V0HZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-88BLW4V0HZ")}</script></head><body class=auto><div class=content><header><div class=header><h1 class=header-title><a href=https://blog.yzyy.de/>G-Hung的博客</a></h1><div class=header-menu><p class=small><a href=/>/home</a></p><p class=small><a href=/post>/日常</a></p><p class=small><a href=/explore>/探索记录</a></p><p class=small><a href=/tags>/tags</a></p><a href=/index.xml target=_blank title=RSS class=rss-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></header><main class=main><div class=breadcrumbs><a href=/>Home</a><span class=breadcrumbs-separator>/</span><a href=/explore/>Explores</a><span class=breadcrumbs-separator>/</span>
<a href=/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B%E8%AE%B0%E5%BD%95/>服务器配置实战指南：从安全加固到Nginx反代部署</a></div><div class=autonumber><article><header class=single-intro-container><h1 class=single-title>服务器配置实战指南：从安全加固到Nginx反代部署</h1><p class=single-summary>服务器配置流程记录，涵盖了从安全设置、Docker安装、Nginx反向代理及SSL证书配置，到Swap空间管理的完整步骤。</p><div class=single-subsummary><img src=/avatar.jpg alt="Author Avatar"><div><p class=author>ghung</p><p class=single-date><time datetime=2024-04-12T00:00:00+00:00>2024 Apr 12</time>
&nbsp; · &nbsp;3 min read</p></div></div></header><div class=single-tags><span><a href=https://blog.yzyy.de/tags/%E6%8E%A2%E7%B4%A2/>#探索</a>
</span><span><a href=https://blog.yzyy.de/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/>#服务器</a></span></div><aside class=toc><p><strong>Table of contents</strong></p><nav id=TableOfContents><ul><li><a href=#安全性>安全性</a></li><li><a href=#安装docker和dockercompose>安装docker和dockercompose</a><ul><li><a href=#安装-docker>安装 Docker</a></li><li><a href=#安装-docker-composev2-可跳过>安装 Docker Compose<strong>V2</strong> (可跳过)</a></li><li><a href=#添加用户到-docker-用户组>添加用户到 Docker 用户组</a></li></ul></li><li><a href=#配置证书和反代>配置证书和反代</a><ul><li><a href=#下载证书和私钥>下载证书和私钥</a></li><li><a href=#安装-nginx>安装 nginx</a></li><li><a href=#上传证书和私钥到服务器>上传证书和私钥到服务器</a></li></ul></li><li><a href=#配置nginx>配置nginx</a></li><li><a href=#swap-空间配置>Swap 空间配置</a><ul><li><a href=#创建swap空间>创建swap空间</a></li><li><a href=#停用swap空间>停用swap空间</a></li></ul></li></ul></nav></aside><div class=single-content><h2 class=heading id=安全性>安全性
<a class=anchor href=#%e5%ae%89%e5%85%a8%e6%80%a7>#</a></h2><p>参考<a href=/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/vps%E5%9F%BA%E6%9C%AC%E5%AE%89%E5%85%A8%E6%8E%AA%E6%96%BD/>VPS基础安全配置实践指南</a>进行配置</p><hr><h2 class=heading id=安装docker和dockercompose>安装docker和dockercompose
<a class=anchor href=#%e5%ae%89%e8%a3%85docker%e5%92%8cdockercompose>#</a></h2><h3 class=heading id=安装-docker>安装 Docker
<a class=anchor href=#%e5%ae%89%e8%a3%85-docker>#</a></h3><h4 class=heading id=更新软件包列表>更新软件包列表
<a class=anchor href=#%e6%9b%b4%e6%96%b0%e8%bd%af%e4%bb%b6%e5%8c%85%e5%88%97%e8%a1%a8>#</a></h4><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span></code></pre></div><h4 class=heading id=安装必要的软件包>安装必要的软件包
<a class=anchor href=#%e5%ae%89%e8%a3%85%e5%bf%85%e8%a6%81%e7%9a%84%e8%bd%af%e4%bb%b6%e5%8c%85>#</a></h4><p>安装一些必要的软件包，这些软件包允许 <code>apt</code> 通过 HTTPS 使用仓库。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install apt-transport-https ca-certificates curl software-properties-common
</span></span></code></pre></div><h4 class=heading id=添加-docker-的官方-gpg-密钥>添加 Docker 的官方 GPG 密钥
<a class=anchor href=#%e6%b7%bb%e5%8a%a0-docker-%e7%9a%84%e5%ae%98%e6%96%b9-gpg-%e5%af%86%e9%92%a5>#</a></h4><p>添加 Docker 的官方 GPG 密钥，以便验证下载的软件包。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
</span></span></code></pre></div><h4 class=heading id=添加-docker-仓库>添加 Docker 仓库
<a class=anchor href=#%e6%b7%bb%e5%8a%a0-docker-%e4%bb%93%e5%ba%93>#</a></h4><p>将 Docker 的官方仓库添加到你的 <code>apt</code> 软件源列表中。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=font-weight:700;font-style:italic>echo</span> <span style=color:#666;font-style:italic>&#34;deb [arch=</span><span style=font-weight:700;text-decoration:underline>$(</span>dpkg --print-architecture<span style=font-weight:700;text-decoration:underline>)</span><span style=color:#666;font-style:italic> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu </span><span style=font-weight:700;text-decoration:underline>$(</span>lsb_release -cs<span style=font-weight:700;text-decoration:underline>)</span><span style=color:#666;font-style:italic> stable&#34;</span> | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</span></span></code></pre></div><p>再次更新软件包列表，以包含新添加的 Docker 仓库。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt update
</span></span></code></pre></div><h4 class=heading id=安装-docker-engine>安装 Docker Engine
<a class=anchor href=#%e5%ae%89%e8%a3%85-docker-engine>#</a></h4><p>安装<code>Docker Engine、Docker CLI</code>和<code> Containerd</code>。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install docker-ce docker-ce-cli containerd.io
</span></span></code></pre></div><h4 class=heading id=验证-docker-安装>验证 Docker 安装
<a class=anchor href=#%e9%aa%8c%e8%af%81-docker-%e5%ae%89%e8%a3%85>#</a></h4><p>验证 Docker 是否成功安装，并检查 Docker 服务是否正在运行。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl status docker
</span></span></code></pre></div><p>如果 Docker 服务正在运行，应该看到类似 <code>active (running)</code> 的输出。</p><p>也可以运行一个简单的 Docker 镜像来验证 Docker 是否可以正常工作。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo docker run hello-world
</span></span></code></pre></div><p>应该看到一条欢迎消息，表明 Docker 安装成功。</p><h3 class=heading id=安装-docker-composev2-可跳过>安装 Docker Compose<strong>V2</strong> (可跳过)
<a class=anchor href=#%e5%ae%89%e8%a3%85-docker-composev2-%e5%8f%af%e8%b7%b3%e8%bf%87>#</a></h3><p>Docker 官方为了简化开发者的安装和使用流程，已经将 Docker Compose V2 作为一个核心插件，并将其包含在标准的 Docker Engine (<code>docker-ce</code>) 安装包的<strong>依赖</strong>或<strong>推荐</strong>列表中。</p><p>这意味着，当上面步骤中使用 <code>apt</code> 安装 <code>docker-ce</code> 时，<code>apt</code> 会自动解析这些依赖关系，并将 <code>docker-compose-plugin</code> 一并安装。</p><p>到这一步直接使用<code>docker compose version</code>验证是否安装成功。</p><h4 class=heading id=下载-docker-compose-插件>下载 Docker Compose 插件
<a class=anchor href=#%e4%b8%8b%e8%bd%bd-docker-compose-%e6%8f%92%e4%bb%b6>#</a></h4><p>从 GitHub Releases 下载 Docker Compose 插件。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install docker-compose-plugin
</span></span></code></pre></div><h4 class=heading id=验证-docker-compose-安装>验证 Docker Compose 安装
<a class=anchor href=#%e9%aa%8c%e8%af%81-docker-compose-%e5%ae%89%e8%a3%85>#</a></h4><p>验证 Docker Compose 是否成功安装。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose version
</span></span></code></pre></div><p>如果 Docker Compose 成功安装，应该看到 Docker Compose 的版本信息。</p><h3 class=heading id=添加用户到-docker-用户组>添加用户到 Docker 用户组
<a class=anchor href=#%e6%b7%bb%e5%8a%a0%e7%94%a8%e6%88%b7%e5%88%b0-docker-%e7%94%a8%e6%88%b7%e7%bb%84>#</a></h3><p>默认情况下，只有 <code>root</code> 用户或具有 <code>sudo</code> 权限的用户才能运行 Docker 命令。为了让普通用户也能运行 Docker 命令，你需要将用户添加到 <code>docker</code> 用户组。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo usermod -aG docker <span style=color:#666;font-weight:700;font-style:italic>$USER</span>
</span></span></code></pre></div><p>运行以下命令来应用用户组更改。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>newgrp docker
</span></span></code></pre></div><p>这样就可以在不使用 <code>sudo</code> 的情况下运行 Docker 命令了。</p><hr><h2 class=heading id=配置证书和反代>配置证书和反代
<a class=anchor href=#%e9%85%8d%e7%bd%ae%e8%af%81%e4%b9%a6%e5%92%8c%e5%8f%8d%e4%bb%a3>#</a></h2><h3 class=heading id=下载证书和私钥>下载证书和私钥
<a class=anchor href=#%e4%b8%8b%e8%bd%bd%e8%af%81%e4%b9%a6%e5%92%8c%e7%a7%81%e9%92%a5>#</a></h3><p>将在cf中生成的源证书的cert和key复制到.pem和.key文件中</p><p><figure><div class=img-container><img loading=lazy alt=Pasted%20image%2020250113173115 src=https://webp.050612.xyz/2025/02/Pasted%20image%2020250113173115.png></div></figure></p><h3 class=heading id=安装-nginx>安装 nginx
<a class=anchor href=#%e5%ae%89%e8%a3%85-nginx>#</a></h3><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install nginx
</span></span></code></pre></div><h3 class=heading id=上传证书和私钥到服务器>上传证书和私钥到服务器
<a class=anchor href=#%e4%b8%8a%e4%bc%a0%e8%af%81%e4%b9%a6%e5%92%8c%e7%a7%81%e9%92%a5%e5%88%b0%e6%9c%8d%e5%8a%a1%e5%99%a8>#</a></h3><p>以下操作建议提权为root进行操作和检查</p><ol><li>使用su，输入root密码提权</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>su
</span></span></code></pre></div><ol start=2><li>检查 <code>/etc/ssl/certs</code>和<code>/etc/ssl/private</code>目录是否存在，并将.pem和.key文件分别传到这两个目录里</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mv xxx.com.pem /etc/ssl/certs/
</span></span><span style=display:flex><span>sudo mv xxx.com.key /etc/ssl/private/
</span></span></code></pre></div><ol start=3><li>设置权限</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span> sudo chmod 600 /etc/ssl/private/api.xxx.com.key
</span></span></code></pre></div><h2 class=heading id=配置nginx>配置nginx
<a class=anchor href=#%e9%85%8d%e7%bd%aenginx>#</a></h2><ol><li><strong>创建 Nginx 配置文件</strong></li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/nginx/sites-available/api.xxx.com
</span></span></code></pre></div><ol start=2><li><strong>添加以下配置</strong></li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen 80;
</span></span><span style=display:flex><span>    server_name api.xxx.com;
</span></span><span style=display:flex><span>    return 301 https://$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen 443 ssl;
</span></span><span style=display:flex><span>    server_name api.xxx.com;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ssl_certificate /etc/ssl/certs/api.xxx.com.pem;
</span></span><span style=display:flex><span>    ssl_certificate_key /etc/ssl/private/api.xxx.com.key;
</span></span><span style=display:flex><span>    ssl_protocols TLSv1.2 TLSv1.3; # 根据需要调整
</span></span><span style=display:flex><span>    ssl_ciphers HIGH:!aNULL:!MD5; # 根据需要调整
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    client_max_body_size 100m;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    location / {
</span></span><span style=display:flex><span>        proxy_pass http://127.0.0.1:5005; # 替换为你的 chat2api 服务监听的地址和端口
</span></span><span style=display:flex><span>        proxy_set_header Host $host;
</span></span><span style=display:flex><span>        proxy_set_header X-Real-IP $remote_addr;
</span></span><span style=display:flex><span>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        proxy_set_header X-Forwarded-Proto $scheme;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>注意：</strong></p><ul><li><code>server_name</code>：设置为 <code>api.xxx.com</code>。</li><li><code>ssl_certificate</code>：指向<code>.pem</code>证书文件的路径。</li><li><code>ssl_certificate_key</code>：指向<code>.key</code>私钥文件的路径。</li><li><code>proxy_pass</code>：设置为`服务监听的地址和端口</li><li>第一个 <code>server</code> 块用于将 HTTP 请求重定向到 HTTPS</li></ul><ol start=3><li><strong>启用 Nginx 配置</strong></li></ol><ul><li>创建软链接到 <code>sites-enabled</code> 目录：</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ln -s /etc/nginx/sites-available/api.vtofun.me /etc/nginx/sites-enabled/api.vtofun.me
</span></span></code></pre></div><ul><li><p>移除默认的 Nginx 配置：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash></code></pre></div></li></ul><p>sudo rm /etc/nginx/sites-enabled/default
```</p><ul><li>测试 Nginx 配置：</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nginx -t
</span></span></code></pre></div><ul><li>重启 Nginx 服务：</li></ul><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart nginx
</span></span></code></pre></div><hr><h2 class=heading id=swap-空间配置>Swap 空间配置
<a class=anchor href=#swap-%e7%a9%ba%e9%97%b4%e9%85%8d%e7%bd%ae>#</a></h2><h3 class=heading id=创建swap空间>创建swap空间
<a class=anchor href=#%e5%88%9b%e5%bb%baswap%e7%a9%ba%e9%97%b4>#</a></h3><ol><li>检查 Swap 空间：
首先，检查系统当前是否已经配置了 Swap 空间：</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>free -h
</span></span></code></pre></div><ol start=2><li>创建 Swap 文件：
使用 <code>fallocate</code> 命令创建一个 Swap 文件。例如，创建一个 2GB 的 Swap 文件：</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo fallocate -l 2G /swapfile
</span></span></code></pre></div><p>或者，你也可以使用 <code>dd</code> 命令创建 Swap 文件：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo dd <span style=font-weight:700;text-decoration:underline>if</span>=/dev/zero <span style=color:#666;font-weight:700;font-style:italic>of</span>=/swapfile <span style=color:#666;font-weight:700;font-style:italic>bs</span>=1M <span style=color:#666;font-weight:700;font-style:italic>count</span>=2048
</span></span></code></pre></div><p>这将创建一个名为 <code>/swapfile</code>，大小为 2GB 的文件。可以根据需要调整 <code>count</code> 的值来改变 Swap 文件的大小。
3. 设置 Swap 文件权限：</p><p>为了安全起见，设置 Swap 文件的权限，只允许 root 用户读写：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo chmod 600 /swapfile
</span></span></code></pre></div><ol start=4><li>格式化为 Swap 空间：
使用 <code>mkswap</code> 命令将文件格式化为 Swap 空间：</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkswap /swapfile
</span></span></code></pre></div><ol start=5><li>启用 Swap 空间：
使用 <code>swapon</code> 命令启用 Swap 空间：</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo swapon /swapfile
</span></span></code></pre></div><ol start=6><li>验证 Swap 空间：
再次使用 <code>free -h</code> 命令验证 Swap 空间是否已启用：</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>free -h
</span></span></code></pre></div><p>应该能看到 <code>Swap</code> 那一行显示了你刚刚配置的 Swap 空间大小。</p><ol start=7><li>设置开机自动挂载 Swap 空间：</li></ol><p>为了使 Swap 空间在系统重启后仍然有效，需要将其添加到 <code>/etc/fstab</code> 文件中。使用文本编辑器打开该文件：</p><pre tabindex=0><code>sudo vim /etc/fstab
</code></pre><p>在文件末尾添加以下一行：</p><pre tabindex=0><code>/swapfile swap swap defaults 0 0
</code></pre><ol start=8><li>调整 Swappiness 值（可选）：
<code>swappiness</code> 参数控制内核使用 Swap 空间的积极程度。默认值通常是 60。对于服务器，你可能希望降低这个值，以便系统更倾向于使用物理内存，只有在必要时才使用 Swap 空间。</li></ol><p>查看当前的 <code>swappiness</code> 值：</p><pre tabindex=0><code>cat /proc/sys/vm/swappiness
</code></pre><p>临时修改 <code>swappiness</code> 值（例如设置为 10）：</p><pre tabindex=0><code>sudo sysctl vm.swappiness=10
</code></pre><p>永久修改 <code>swappiness</code> 值，编辑 <code>/etc/sysctl.conf</code> 文件：</p><pre tabindex=0><code>sudo nano /etc/sysctl.conf
</code></pre><p>在文件末尾添加或修改以下行：</p><pre tabindex=0><code>vm.swappiness=10
</code></pre><h3 class=heading id=停用swap空间>停用swap空间
<a class=anchor href=#%e5%81%9c%e7%94%a8swap%e7%a9%ba%e9%97%b4>#</a></h3><ol><li>关闭 Swap 空间：
使用 <code>swapoff</code> 命令关闭指定的 Swap 空间。如果你的 Swap 空间是基于文件的（如前面示例中的 <code>/swapfile</code>），可以使用以下命令：</li></ol><pre tabindex=0><code>sudo swapoff /swapfile
</code></pre><p>不确定 Swap 分区的路径，可以使用 <code>swapon --show</code> 或 <code>free -h</code> 命令查看。</p><ol start=2><li>删除 Swap 文件（可选）：</li></ol><pre tabindex=0><code>sudo rm /swapfile
</code></pre><ol start=3><li>编辑 <code>/etc/fstab</code> 文件：</li></ol><p>为了防止系统在重启后自动挂载 Swap 空间，需要从 <code>/etc/fstab</code> 文件中删除或注释掉相关的条目。</p><pre tabindex=0><code>sudo vim /etc/fstab
</code></pre><p>找到包含 <code>/swapfile</code> 的那一行：</p><pre tabindex=0><code>/swapfile swap swap defaults 0 0
</code></pre><p>删除这一行，或者在行首添加 <code>#</code> 将其注释掉：</p><pre tabindex=0><code>#/swapfile swap swap defaults 0 0
</code></pre><ol start=4><li>验证 Swap 空间是否已停用：</li></ol><p>使用 <code>free -h</code> 命令验证 Swap 空间是否已停用：</p><pre tabindex=0><code>free -h
</code></pre></div></article><div class=single-comments><script src=https://giscus.app/client.js data-repo=eaiu/eaiu.github.io data-repo-id=R_kgDOPMv-Yw data-category data-category-id=DIC_kwDOPMv-Y84CtAeO data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div><div class=single-pagination><hr><div class=flexnowrap><div class=single-pagination-prev><div class=single-pagination-container-prev><div class=single-pagination-text>←</div><div class=single-pagination-text><a href=/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/vps%E5%9F%BA%E6%9C%AC%E5%AE%89%E5%85%A8%E6%8E%AA%E6%96%BD/>VPS基础安全配置实践指南</a></div></div></div><div class=single-pagination-next><div class=single-pagination-container-next><div class=single-pagination-text><a href=/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E5%9F%9F%E5%90%8D%E7%9B%B8%E5%85%B3/>域名管理：Cloudflare DNS托管与SSL证书配置</a></div><div class=single-pagination-text>→</div></div></div></div><hr></div><div class=back-to-top><a href=#top>back to top</a></div></div></main></div><footer><p>All content licensed under <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a> unless otherwise stated. Copyright © 2025 ghung<br>Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/tomfran/typo>tomfran/typo</a></p></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></body><script src=/js/theme-switch.js></script><script defer src=/js/copy-code.js></script></html>