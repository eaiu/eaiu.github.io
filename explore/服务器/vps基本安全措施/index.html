<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=icon type=image/ico href=https://blog.yzyy.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.yzyy.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.yzyy.de/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://blog.yzyy.de/android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://blog.yzyy.de/apple-touch-icon.png><meta name=description content="本文提供了一份详尽的VPS（虚拟专用服务器）安全加固清单与操作指南，内容涵盖用户与权限管理、SSH端口修改与密钥登录、防火墙（如UFW）配置、禁用root登录等核心安全实践，帮助用户从零开始构建一个更安全的服务器环境。"><title>VPS基础安全配置实践指南 | G-Hung的博客</title><link rel=canonical href=https://blog.yzyy.de/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/vps%E5%9F%BA%E6%9C%AC%E5%AE%89%E5%85%A8%E6%8E%AA%E6%96%BD/><meta property="og:url" content="https://blog.yzyy.de/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/vps%E5%9F%BA%E6%9C%AC%E5%AE%89%E5%85%A8%E6%8E%AA%E6%96%BD/"><meta property="og:site_name" content="G-Hung的博客"><meta property="og:title" content="VPS基础安全配置实践指南"><meta property="og:description" content="本文提供了一份详尽的VPS（虚拟专用服务器）安全加固清单与操作指南，内容涵盖用户与权限管理、SSH端口修改与密钥登录、防火墙（如UFW）配置、禁用root登录等核心安全实践，帮助用户从零开始构建一个更安全的服务器环境。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="explore"><meta property="article:published_time" content="2024-04-10T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-10T00:00:00+00:00"><meta property="article:tag" content="探索"><meta property="article:tag" content="服务器"><link rel=stylesheet href=/assets/combined.min.737dab787e0dfa3088180adf040304574c336cd3805516c938598d23fd96b675.css media=all><script async src="https://www.googletagmanager.com/gtag/js?id=G-88BLW4V0HZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-88BLW4V0HZ")}</script></head><body class=auto><div class=content><header><div class=header><h1 class=header-title><a href=https://blog.yzyy.de/>G-Hung的博客</a></h1><div class=header-menu><p class=small><a href=/>/home</a></p><p class=small><a href=/post>/日常</a></p><p class=small><a href=/explore>/探索记录</a></p><p class=small><a href=/tags>/tags</a></p><a href=/index.xml target=_blank title=RSS class=rss-icon><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></div></div></header><main class=main><div class=breadcrumbs><a href=/>Home</a><span class=breadcrumbs-separator>/</span><a href=/explore/>Explores</a><span class=breadcrumbs-separator>/</span>
<a href=/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/vps%E5%9F%BA%E6%9C%AC%E5%AE%89%E5%85%A8%E6%8E%AA%E6%96%BD/>VPS基础安全配置实践指南</a></div><div class=autonumber><article><header class=single-intro-container><h1 class=single-title>VPS基础安全配置实践指南</h1><p class=single-summary>记录了新购VPS后必须进行的一系列基础安全设置，旨在提升服务器的防御能力，防止常见攻击。</p><div class=single-subsummary><img src=/avatar.jpg alt="Author Avatar"><div><p class=author>ghung</p><p class=single-date><time datetime=2024-04-10T00:00:00+00:00>2024 Apr 10</time>
&nbsp; · &nbsp;4 min read</p></div></div></header><div class=single-tags><span><a href=https://blog.yzyy.de/tags/%E6%8E%A2%E7%B4%A2/>#探索</a>
</span><span><a href=https://blog.yzyy.de/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/>#服务器</a></span></div><aside class=toc><p><strong>Table of contents</strong></p><nav id=TableOfContents><ul><li><a href=#安全管理系统>安全管理系统</a><ul><li><a href=#创建非-root-账户>创建非 root 账户</a></li><li><a href=#禁用-root-ssh-密码登陆>禁用 root SSH 密码登陆</a></li><li><a href=#修改-ssh-端口号>修改 SSH 端口号</a></li><li><a href=#fail2ban-防暴力破解-ssh-配置ssh-ip白名单>Fail2ban 防暴力破解 SSH 配置SSH ip白名单</a></li><li><a href=#使用密钥登录>使用密钥登录</a></li><li><a href=#启用-ufw-防火墙>启用 UFW 防火墙</a></li></ul></li><li><a href=#更改时区>更改时区</a></li><li><a href=#保证软件更新>保证软件更新</a><ul><li><a href=#日常更新系统>日常更新系统</a></li></ul></li></ul></nav></aside><div class=single-content><p>本文基于 <code>@Raven95676</code> 的原帖，并结合我的个人使用习惯进行了定制化整理，作为自己的操作备忘录。</p><p>原帖地址：<a href=https://linux.do/t/topic/267502>VPS基本安全措施</a></p><h1 class=heading id=前言>前言
<a class=anchor href=#%e5%89%8d%e8%a8%80>#</a></h1><p>随着逐渐看到一些「Self Host」的服务，拥有一台属于自己的服务器的想法越来越强烈。终于，在24年的一次促销中，买到了第一台具有公网IP的小机器，1c1g。</p><p>拿到了机器，开机之后意味着暴露在了互联网中。在互联网中，每时每刻都有无数的恶意流量发出。我们需要做什么呢？</p><p>如果选择将网站 / 服务放在知名厂商虚拟主机上，虚拟主机的厂商会负责基本的服务器安全措施。但如果放在 VPS 上，那么你就是服务器的安全负责人了。更多的权限代表着更多的义务，VPS 在具有更高的自由度的情况下自然有更高的风险。<strong>而我们要做到的不是绝对安全，而是比大多数人安全。</strong> 只要做到没那么容易被攻破那就是胜利。</p><h2 class=heading id=安全管理系统>安全管理系统
<a class=anchor href=#%e5%ae%89%e5%85%a8%e7%ae%a1%e7%90%86%e7%b3%bb%e7%bb%9f>#</a></h2><p>有些 VPS 厂商默认提供的是 root 账户。众所周知，root 账户拥有整个系统最高的权限，这么高的权限自然是不安全的。正确的做法是创建一个非 root 账户，在必须使用 root 权限时使用 sudo 提权。</p><h3 class=heading id=创建非-root-账户>创建非 root 账户
<a class=anchor href=#%e5%88%9b%e5%bb%ba%e9%9d%9e-root-%e8%b4%a6%e6%88%b7>#</a></h3><p>使用以下命令创建一个具有提权能力的账户：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>useradd -m -G sudo -s /bin/bash 用户名
</span></span></code></pre></div><ul><li><strong><code>useradd</code>:</strong> 这是一个用于创建新用户的命令。</li><li><strong><code>-m</code>:</strong> 此选项会在 <code>/home</code> 目录下为新用户创建主目录。</li><li><strong><code>-G sudo</code>:</strong> 此选项将新用户添加到 <code>sudo</code> 组，允许其使用 <code>sudo</code> 命令执行管理员操作。</li><li><strong><code>-s /bin/bash</code>:</strong> 此选项指定新用户的默认 shell 为 <code>/bin/bash</code>（常用 shell）。</li><li><strong><code>用户名</code>:</strong> 这是你要创建的新用户的用户名。</li></ul><p>然后我们给这个用户设置一个至少为 16 位的随机大小写字母 + 数字的密码：</p><pre tabindex=0><code class=language-undefined data-lang=undefined>passwd 用户名
</code></pre><blockquote><p>建议把 root 用户的密码也改掉，云服务器的默认密码强度还是差点，而且有些服务商会通过邮件来发送默认密码，不太安全。</p></blockquote><h3 class=heading id=禁用-root-ssh-密码登陆>禁用 root SSH 密码登陆
<a class=anchor href=#%e7%a6%81%e7%94%a8-root-ssh-%e5%af%86%e7%a0%81%e7%99%bb%e9%99%86>#</a></h3><p>先不提 root 登录本身就是危险的行为，root 账户的用户名固定为”root”，如果允许其通过密码登录，攻击者只需进行密码穷举即可尝试攻破系统。之前我们已经创建了非 root 账户，在这里我们只需要禁用非 root 账户的 SSH 登录即可。</p><p>执行以下命令编辑 SSH 配置文件：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/ssh/sshd_config
</span></span></code></pre></div><p>进行如下设置：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#888;font-style:italic># 禁止 Root 用户通过密码远程登录 </span>
</span></span><span style=display:flex><span>PermitRootLogin prohibit-password
</span></span></code></pre></div><p>查看<code>/etc/ssh/sshd_config.d/</code>目录下有无其他配置文件，防止不生效。有些厂商的初始镜像内已经有了一些配置会覆盖掉我们编写的。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ls /etc/ssh/sshd_config.d/
</span></span></code></pre></div><p>之后重启 SSH 服务生效：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart ssh
</span></span></code></pre></div><p>为什么不设置成 no：</p><p>庄 sir:</p><blockquote><p>另，直接禁掉 root 登录 <code>PermitRootLogin no</code> 我也不常用，更习惯和其他 sudoer 一样配密钥然后禁止密码登录仅允许密钥登录。我是一般能操做线下集群的机子才会这么配，不然出个故障没 root 用不了了，比如存储满了远程 ssh session 都建立不了。</p></blockquote><p>Oganneson:</p><blockquote><p>理论上 PermitRootLogin 是好的，但在服务器寄掉需要救援时就会变麻烦，我其实更推荐只关闭远程密码登录，保留本地密码登录，出问题时可以通过 vnc 或者 ipmi 本地登录 root 进行救援。</p></blockquote><h3 class=heading id=修改-ssh-端口号>修改 SSH 端口号
<a class=anchor href=#%e4%bf%ae%e6%94%b9-ssh-%e7%ab%af%e5%8f%a3%e5%8f%b7>#</a></h3><blockquote><p>登上去第一件事就是改 SSHD 的 端口并修改防火墙，22 全是猜密码的请求。<br>有个小技巧，就是改端口并重启 sshd 后当前的连接并没有断，新建一个终端使用新端口发请求，能连上就是修改正确，要是不能建立新连接，还可以改回来，或查下防火墙的配置。</p></blockquote><p>正常情况下，直接通过 <code>sudo vim /etc/ssh/sshd_config</code> 修改 SSH 端口，然后再使用 <code>sudo systemctl restart ssh.service</code> 重启 SSH 服务应用更改是可行的：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#888;font-style:italic># 设置 SSH端口 Port 自拟</span>
</span></span><span style=display:flex><span>Port 20251
</span></span></code></pre></div><p>但是在 <strong>Ubuntu 22.10 或更高版本</strong>中各位可能发现这是<strong>无效</strong>的，各位会发现 SSH 服务在重启后依然监听原端口。</p><p>因为在 Ubuntu 22.10 或更高版本中，ssh 默认通过套接字激活。</p><p>在 Ubuntu 22.10、Ubuntu 23.04 和 Ubuntu 23.10 中进行修改的方法是：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo mkdir -p /etc/systemd/system/ssh.socket.d
</span></span><span style=display:flex><span>sudo vim /etc/systemd/system/ssh.socket.d/listen.conf
</span></span><span style=display:flex><span>sudo systemctl daemon-reload
</span></span><span style=display:flex><span>sudo systemctl restart ssh.socket
</span></span><span style=display:flex><span>sudo systemctl restart ssh.service
</span></span></code></pre></div><p>listen.conf 的参考配置为：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>[Socket]</span>
</span></span><span style=display:flex><span>ListenStream=
</span></span><span style=display:flex><span>ListenStream=<span style=color:#666;font-style:italic>2233</span>
</span></span></code></pre></div><p>在 Ubuntu 24.04 中进行修改的方法是：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/ssh/sshd_config
</span></span><span style=display:flex><span>sudo systemctl daemon-reload
</span></span><span style=display:flex><span>sudo systemctl restart ssh.service
</span></span></code></pre></div><p>如果不在乎通过套接字激活节省的内存，可以通过以下命令恢复到非套接字激活：</p><p><strong>警告：</strong> 务必确认配置文件正常。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl disable --now ssh.socket
</span></span><span style=display:flex><span>sudo systemctl <span style=font-weight:700;font-style:italic>enable</span> --now ssh.service
</span></span></code></pre></div><p>如有配置迁移（Ubuntu 22.10 及以上，Ubuntu 24.04 以下）：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl disable --now ssh.socket
</span></span><span style=display:flex><span>rm -f /etc/systemd/system/ssh.service.d/00-socket.conf
</span></span><span style=display:flex><span>rm -f /etc/systemd/system/ssh.socket.d/addresses.conf
</span></span><span style=display:flex><span>sudo systemctl daemon-reload
</span></span><span style=display:flex><span>sudo systemctl <span style=font-weight:700;font-style:italic>enable</span> --now ssh.service
</span></span></code></pre></div><h3 class=heading id=fail2ban-防暴力破解-ssh-配置ssh-ip白名单>Fail2ban 防暴力破解 SSH 配置SSH ip白名单
<a class=anchor href=#fail2ban-%e9%98%b2%e6%9a%b4%e5%8a%9b%e7%a0%b4%e8%a7%a3-ssh-%e9%85%8d%e7%bd%aessh-ip%e7%99%bd%e5%90%8d%e5%8d%95>#</a></h3><p>执行以下命令安装 Fail2ban：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo apt install fail2ban
</span></span></code></pre></div><p>安装完成后 Fail2ban会自动运行，可以检查一下服务状态</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl status fail2ban
</span></span></code></pre></div><p>如果为dead，注意开启fail2ban服务</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl start fail2ban
</span></span></code></pre></div><p>官方推荐的做法是利用 jail.local 来进行自定义设置：
这样做的好处是，在升级 Fail2ban 时，你的自定义配置不会丢失。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/fail2ban/jail.local
</span></span></code></pre></div><p>可以参照以下配置文件来进行自己的配置（记得删注释）：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ini data-lang=ini><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>[sshd]</span>
</span></span><span style=display:flex><span>ignoreip = <span style=color:#666;font-style:italic>127.0.0.1/8 # 白名单，知道自己的固定公网ip网段可以配置</span>
</span></span><span style=display:flex><span>enabled = <span style=color:#666;font-style:italic>true</span>
</span></span><span style=display:flex><span>filter = <span style=color:#666;font-style:italic>sshd</span>
</span></span><span style=display:flex><span>port = <span style=color:#666;font-style:italic>22 # 端口，改了的话这里也要改</span>
</span></span><span style=display:flex><span>maxretry = <span style=color:#666;font-style:italic>5 # 最大尝试次数</span>
</span></span><span style=display:flex><span>findtime = <span style=color:#666;font-style:italic>300 # 多少秒以内最大尝试次数规则生效</span>
</span></span><span style=display:flex><span>bantime = <span style=color:#666;font-style:italic>600 # 封禁多少秒，-1是永久封禁（不建议永久封禁）</span>
</span></span><span style=display:flex><span>action = <span style=color:#666;font-style:italic>%(action_)s[port=&#34;%(port)s&#34;, protocol=&#34;%(protocol)s&#34;, logpath=&#34;%(logpath)s&#34;, chain=&#34;%(chain)s&#34;] # 不需要发邮件通知就这样设置</span>
</span></span><span style=display:flex><span>banaction = <span style=color:#666;font-style:italic>iptables-multiport # 禁用方式</span>
</span></span><span style=display:flex><span>logpath = <span style=color:#666;font-style:italic>/var/log/auth.log # SSH 登陆日志位置</span>
</span></span></code></pre></div><p>直接复制版本：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>[sshd]
</span></span><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>ignoreip</span> = 127.0.0.1/8
</span></span><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>enabled</span> = <span style=font-weight:700;font-style:italic>true</span>
</span></span><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>filter</span> = sshd
</span></span><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>port</span> = 20253
</span></span><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>maxretry</span> = 5 
</span></span><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>findtime</span> = 300 
</span></span><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>bantime</span> = 600
</span></span><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>action</span> = %(action_)s[<span style=color:#666;font-weight:700;font-style:italic>port</span>=<span style=color:#666;font-style:italic>&#34;%(port)s&#34;</span>, <span style=color:#666;font-weight:700;font-style:italic>protocol</span>=<span style=color:#666;font-style:italic>&#34;%(protocol)s&#34;</span>, <span style=color:#666;font-weight:700;font-style:italic>logpath</span>=<span style=color:#666;font-style:italic>&#34;%(logpath)s&#34;</span>, <span style=color:#666;font-weight:700;font-style:italic>chain</span>=<span style=color:#666;font-style:italic>&#34;%(chain)s&#34;</span>]
</span></span><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>banaction</span> = iptables-multiport
</span></span><span style=display:flex><span><span style=color:#666;font-weight:700;font-style:italic>logpath</span> = /var/log/auth.log
</span></span></code></pre></div><p>设置fail2ban开机自动启动：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl <span style=font-weight:700;font-style:italic>enable</span> fail2ban
</span></span></code></pre></div><h3 class=heading id=使用密钥登录>使用密钥登录
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e5%af%86%e9%92%a5%e7%99%bb%e5%bd%95>#</a></h3><blockquote><p>如果 VPS 厂商提供了 SSH 密钥绑定功能，可以忽略本节内容并按照 VPS 厂商提供的方法绑定。</p></blockquote><p>在本地 powershell 中运行：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t ed25519
</span></span></code></pre></div><p>或者</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ssh-keygen -t rsa -b 4096
</span></span></code></pre></div><p>二者加密算法不同:</p><ul><li><p><code>-b 4096</code> 指定生成的 RSA 密钥的长度为 4096 位</p></li><li><p>Ed25519 的密钥长度固定，约为 256 位，无需指定密钥长度。</p></li></ul><p>直接使用默认的密钥路径即可。密码可以留空，也可以设置。</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>Generating <span style=font-weight:700;text-decoration:underline>public</span>/<span style=font-weight:700;text-decoration:underline>private</span> ed25519 key pair.
</span></span><span style=display:flex><span>Enter file in which to save the key (C:\Users\&lt;user&gt;/.ssh/id_ed25519): <span style=color:#888;font-style:italic># 直接回车
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>Enter passphrase (<span style=font-weight:700;text-decoration:underline>empty</span> <span style=font-weight:700;text-decoration:underline>for</span> no passphrase): <span style=color:#888;font-style:italic># 可以留空，也可以设置
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>Enter same passphrase again: <span style=color:#888;font-style:italic># 和上一个一样
</span></span></span></code></pre></div><p>然后我们在 VPS 上编辑 SSH 授权密钥文件，注意需要在root用户和非root用户下都需要添加：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vim ~/.ssh/authorized_keys
</span></span></code></pre></div><hr><p>如果目标用户的家目录下还没有 <code>.ssh</code> 目录， 确保目录的权限是 <code>700</code>：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>mkdir -p ~/.ssh
</span></span><span style=display:flex><span>chmod 700 ~/.ssh
</span></span></code></pre></div><p>创建<code>authorized_keys</code>文件并赋予相应权限</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>touch ~/.ssh/authorized_keys
</span></span><span style=display:flex><span>chmod 600 ~/.ssh/authorized_keys
</span></span></code></pre></div><p>之后打开 <code>C:\\\Users&lt;user\>/.ssh/id\_ed25519.pub</code>，复制其内容并粘贴过去。</p><hr><p>执行以下命令编辑 SSH 配置文件：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo vim /etc/ssh/sshd_config
</span></span></code></pre></div><p>进行如下设置：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>PubkeyAuthentication yes
</span></span><span style=display:flex><span>AuthorizedKeysFile .ssh/authorized_keys
</span></span><span style=display:flex><span>PasswordAuthentication no
</span></span></code></pre></div><p>如果发现没有生效：
检查 <code>/etc/ssh/sshd_config.d</code>下的文件</p><p>之后重启 SSH 服务生效：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo systemctl restart ssh
</span></span></code></pre></div><h3 class=heading id=启用-ufw-防火墙>启用 UFW 防火墙
<a class=anchor href=#%e5%90%af%e7%94%a8-ufw-%e9%98%b2%e7%81%ab%e5%a2%99>#</a></h3><blockquote><p>如果 VPS 厂商提供了防火墙功能，且没有复杂的需求，可以忽略本节内容并使用 VPS 厂商提供的防火墙。</p></blockquote><p>在正式启用 UFW 之前，我们需要先设置规则。我们首先来设置 UFW 的默认行为：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ufw default allow outgoing <span style=color:#888;font-style:italic># 默认允许所有数据出站</span>
</span></span><span style=display:flex><span>sudo ufw default deny incoming <span style=color:#888;font-style:italic># 默认禁止所有数据入站</span>
</span></span></code></pre></div><p>我们可以通过以下命令查看 UFW 当前生效的规则：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ufw status
</span></span><span style=display:flex><span>sudo ufw status numbered  <span style=color:#888;font-style:italic># 加上数字编号</span>
</span></span></code></pre></div><p>我们可以通过以下命令允许或拒绝某端口的传入 / 传出流量（部分以 22、80、443 端口为例）：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#888;font-style:italic># 允许22端口的proto协议的流量入站</span>
</span></span><span style=display:flex><span>sudo ufw allow in 22/proto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>#允许22端口的proto协议的流量出站</span>
</span></span><span style=display:flex><span>sudo ufw allow out 22/proto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 在未指定in/out的情况下，默认为in</span>
</span></span><span style=display:flex><span>sudo ufw allow 22/proto
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 在未指定proto的情况下，默认为tcp和udp</span>
</span></span><span style=display:flex><span>sudo ufw allow 22
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 拒绝的话就把allow改成deny</span>
</span></span><span style=display:flex><span>sudo ufw deny 22
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 允许从start_port到end_port的端口</span>
</span></span><span style=display:flex><span>sudo ufw allow start_port:end_port
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 允许复数个端口，以英文逗号分隔</span>
</span></span><span style=display:flex><span>sudo ufw allow port1,port2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 允许来自于特定ip或cidr段的流量</span>
</span></span><span style=display:flex><span>sudo ufw allow from ip/cidr
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 允许来自于特定ip或cidr段端口22的流量</span>
</span></span><span style=display:flex><span>sudo ufw allow from ip/cidr to any port 22
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 允许来自于特定ip或cidr段端口22的tcp协议的流量</span>
</span></span><span style=display:flex><span>sudo ufw allow from ip/cidr to any proto tcp port 22
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># 如果指定复数个端口，则必须指定协议</span>
</span></span><span style=display:flex><span>sudo ufw allow from ip to any proto tcp port 80,443
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># comment用于注释</span>
</span></span><span style=display:flex><span>sudo ufw allow from ip to any proto tcp port 80,443 comment <span style=color:#666;font-style:italic>&#34;hello&#34;</span>
</span></span></code></pre></div><p>我们可以通过以下命令删除生效的规则：</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ufw delete allow 22 <span style=color:#888;font-style:italic># 在规则前面加个delete</span>
</span></span><span style=display:flex><span>sudo ufw delete 1 <span style=color:#888;font-style:italic># 按照numbered的编号删除也行</span>
</span></span></code></pre></div><p>在确定所有规则均成功设置后，通过以下命令启动 \ 关闭 \ 重启 UFW</p><blockquote><p>启动防火墙前务必保证 22 端口（或者其他 SSH 端口）被放行。</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ufw enable|disable|reload
</span></span></code></pre></div><p>如果需要重置规则，请使用：</p><blockquote><p>重置规则前务必保证 UFW 处于关闭状态。</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo ufw reset
</span></span></code></pre></div><p>本人建议仅放行正在使用的端口，比如 22、80、443。</p><p>默认情况下，UFW 仅记录不符合规则的被拒绝的数据包。如果需要记录与该服务相关的每个详细信息，可以在 allow 后加上 log 以进行记录。</p><pre tabindex=0><code># 成功连接 ssh 的也记一下日志备查比较好 ufw allow log 22/tcp
</code></pre><h2 class=heading id=更改时区>更改时区
<a class=anchor href=#%e6%9b%b4%e6%94%b9%e6%97%b6%e5%8c%ba>#</a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo timedatectl set-timezone Asia/Shanghai
</span></span></code></pre></div><h2 class=heading id=保证软件更新>保证软件更新
<a class=anchor href=#%e4%bf%9d%e8%af%81%e8%bd%af%e4%bb%b6%e6%9b%b4%e6%96%b0>#</a></h2><h3 class=heading id=日常更新系统>日常更新系统
<a class=anchor href=#%e6%97%a5%e5%b8%b8%e6%9b%b4%e6%96%b0%e7%b3%bb%e7%bb%9f>#</a></h3><p>个人建议定期登录 VPS 运行 <code>sudo apt update && sudo apt upgrade</code> 来保证 VPS 内所有软件包均为最新。</p><p>不过 Ubuntu 默认会每天自动安装系统的安全更新，所以说这个频率没必要太勤。</p></div></article><div class=single-comments><script src=https://giscus.app/client.js data-repo=eaiu/eaiu.github.io data-repo-id=R_kgDOPMv-Yw data-category data-category-id=DIC_kwDOPMv-Y84CtAeO data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div><div class=single-pagination><hr><div class=flexnowrap><div class=single-pagination-prev><div class=single-pagination-container-prev><div class=single-pagination-text>←</div><div class=single-pagination-text><a href=/explore/%E5%9B%BE%E5%BA%8A%E6%90%AD%E5%BB%BA/>图床搭建(Cloudflare R2 + WebP Cloud + PicList)</a></div></div></div><div class=single-pagination-next><div class=single-pagination-container-next><div class=single-pagination-text><a href=/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B%E8%AE%B0%E5%BD%95/>新到手的Linux VPS, 我这样设置：从安全加固到Nginx反代部署</a></div><div class=single-pagination-text>→</div></div></div></div><hr></div><div class=back-to-top><a href=#top>back to top</a></div></div></main></div><footer><p>All content licensed under <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a> unless otherwise stated. Copyright © 2025 ghung<br>Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/tomfran/typo>tomfran/typo</a></p></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></body><script src=/js/theme-switch.js></script><script defer src=/js/copy-code.js></script></html>