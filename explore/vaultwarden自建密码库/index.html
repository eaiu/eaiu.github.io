<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=icon type=image/ico href=https://blog.yzyy.de/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://blog.yzyy.de/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://blog.yzyy.de/favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://blog.yzyy.de/android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://blog.yzyy.de/apple-touch-icon.png><meta name=description content="An LSM Tree overview and Java implementation."><title>Log-Structured Merge Tree | G-Hungçš„åšå®¢</title><link rel=canonical href=https://blog.yzyy.de/explore/vaultwarden%E8%87%AA%E5%BB%BA%E5%AF%86%E7%A0%81%E5%BA%93/><meta property="og:url" content="https://blog.yzyy.de/explore/vaultwarden%E8%87%AA%E5%BB%BA%E5%AF%86%E7%A0%81%E5%BA%93/"><meta property="og:site_name" content="G-Hungçš„åšå®¢"><meta property="og:title" content="Log-Structured Merge Tree"><meta property="og:description" content="An LSM Tree overview and Java implementation."><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="explore"><meta property="article:published_time" content="2024-06-12T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-12T00:00:00+00:00"><meta property="article:tag" content="Database"><meta property="article:tag" content="Java"><link rel=stylesheet href=/assets/combined.min.5e139504908908255829461aa5380534c88b0d4f739385601750a2a381626824.css media=all><script async src="https://www.googletagmanager.com/gtag/js?id=G-88BLW4V0HZ"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-88BLW4V0HZ")}</script></head><body class=auto><div class=content><header><div class=header><h1 class=header-title><a href=https://blog.yzyy.de/>G-Hungçš„åšå®¢</a></h1><div class=header-menu><p class=small><a href=/>/home</a></p><p class=small><a href=/post>/æ—¥å¸¸</a></p><p class=small><a href=/explore>/æ¢ç´¢è®°å½•</a></p><p class=small><a href=/tags>/tags</a></p></div></div></header><main class=main><div class=breadcrumbs><a href=/>Home</a><span class=breadcrumbs-separator>/</span><a href=/explore/>Explores</a><span class=breadcrumbs-separator>/</span>
<a href=/explore/vaultwarden%E8%87%AA%E5%BB%BA%E5%AF%86%E7%A0%81%E5%BA%93/>Log-Structured Merge Tree</a></div><div class=autonumber><article><header class=single-intro-container><h1 class=single-title>Log-Structured Merge Tree</h1><p class=single-summary>An LSM Tree overview and Java implementation.</p><div class=single-subsummary><img src=/avatar.jpg alt="Author Avatar"><div><p class=author>ghung</p><p class=single-date><time datetime=2024-06-12T00:00:00+00:00>2024 Jun 12</time>
&nbsp; Â· &nbsp;9 min read</p></div></div></header><div class=single-tags><span><a href=https://blog.yzyy.de/tags/database/>#Database</a>
</span><span><a href=https://blog.yzyy.de/tags/java/>#Java</a></span></div><aside class=toc><p><strong>Table of contents</strong></p><nav id=TableOfContents><ul><li><a href=#21å®‰è£…docker>2.1å®‰è£…docker</a></li></ul><ul><li><a href=#ç»è¿‡è°ƒè¯•è¿‡åçš„nginxçš„é…ç½®æ–‡ä»¶>ç»è¿‡è°ƒè¯•è¿‡åçš„nginxçš„é…ç½®æ–‡ä»¶ï¼š</a></li><li><a href=#æµ‹è¯•-websocket-è¿æ¥>æµ‹è¯• WebSocket è¿æ¥</a></li></ul><ul><li><a href=#41cloudflareæ“ä½œ>4.1cloudflareæ“ä½œï¼š</a></li><li><a href=#42-vpsæ“ä½œ>4.2 VPSæ“ä½œ</a><ul><li><a href=#è®¾ç½®éšæœºå­è·¯å¾„>è®¾ç½®éšæœºå­è·¯å¾„</a></li><li><a href=#å…³é—­é¡µé¢å¹¶ç¦ç”¨æ³¨å†Œ>å…³é—­é¡µé¢å¹¶ç¦ç”¨æ³¨å†Œ</a></li><li><a href=#å®šæ—¶æ£€æŸ¥å®¹å™¨æ›´æ–°>å®šæ—¶æ£€æŸ¥å®¹å™¨æ›´æ–°</a></li></ul></li><li><a href=#43vaultwarden-è‡ªåŠ¨å¤‡ä»½é…ç½®>4.3vaultwarden è‡ªåŠ¨å¤‡ä»½é…ç½®</a><ul><li><a href=#ä½¿ç”¨æ­¥éª¤>ä½¿ç”¨æ­¥éª¤</a></li></ul></li></ul><ul><li><a href=#åŒ¹é…æ¨¡å¼>åŒ¹é…æ¨¡å¼</a><ul><li></li></ul></li></ul></nav></aside><div class=single-content><h1 class=heading id=ä¸€ç¼˜èµ·>ä¸€ã€ç¼˜èµ·
<a class=anchor href=#%e4%b8%80%e7%bc%98%e8%b5%b7>#</a></h1><p>åœ¨å®‰å…¨æ„è¯†æ²¡æœ‰å‡é«˜çš„æ—¶å€™ï¼Œç”šè‡³æƒ³è¿‡è®°ä½ä¸€ä¸ªå¯ä»¥åº”ä»˜å„ç§ç½‘ç«™è¦æ±‚çš„å¯†ç ï¼Œä¸€ä¸ªåŒ…æ‹¬ç‰¹æ®Šç¬¦å·(å¦‚!.*&)ã€å¤§å°å†™å­—æ¯ã€æ•°å­—ç­‰é›†äºä¸€èº«çš„å¯†ç ã€‚è¿™æ ·æˆ‘å°±å¯ä»¥æ‰€æœ‰è´¦å·å¯ä»¥ä½¿ç”¨ä¸€ä¸ªé€šç”¨çš„å¯†ç äº†ğŸ˜ã€‚</p><p>åæ¥ä¸æ­¢ä¸€æ¬¡æ„Ÿå—åˆ°å±æœºï¼Œå„ç§è´¦å·å¥½å¤šä½¿ç”¨äº†åŒä¸€ä¸ªå¯†ç ï¼Œå¯†ç å¦‚æœæ³„éœ²ï¼Œç›´æ¥ä¸€é”…ç«¯äº†ã€‚å¹¶ä¸”é‡åˆ°è¿‡ç™»å½•è´¦å·éœ€è¦æ‰“å¼€iosçš„è®°äº‹æœ¬å’Œå¯†ç appæ‰‹åŠ¨æœç´¢å’ŒæŸ¥æ‰¾çš„å°´å°¬æ—¶åˆ»&mldr;</p><p>æ—©å·²å¬è¿‡bitwardençš„å¤§åï¼Œè¿™ä¸ªè½¯ä»¶å¯ä»¥æ»¡è¶³æˆ‘çš„æ‰€æœ‰éœ€æ±‚ï¼š</p><ol><li>å…¨å¹³å°ï¼šiosã€webæ‰©å±•ã€windowsç­‰ç­‰ï¼Œå¯ä»¥åœ¨ä¸€ç«¯å‚¨å­˜ï¼Œå¤šç«¯è®¿é—®ã€‚</li><li>æ•°æ®å®‰å…¨ï¼šé‡‡ç”¨æœ€å…ˆè¿›çš„åŠ å¯†æŠ€æœ¯ã€‚ç¡®ä¿å¯†ç å’Œæ•æ„Ÿä¿¡æ¯åœ¨å®‰å…¨ä¼ è¾“å¹¶å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šè¿›è¡Œæœ¬åœ°åŠ å¯†ã€‚</li><li>å…è´¹ï¼šå˜»å˜»</li><li>ç”Ÿæˆå¼ºå¯†ç ï¼šé›†æˆç”Ÿæˆå¼ºå¯†ç çš„å·¥å…·</li></ol><p>ç”±äºBitwardenå®˜æ–¹éƒ¨ç½²æœºå™¨æœ€å°çš„è¦æ±‚æ˜¯2gï¼Œæ•…é€‰æ‹©ç¤¾åŒºç‰ˆVaultWardenï¼Œå¯ä»¥ç§æœ‰éƒ¨ç½²ï¼Œä½†æ¯”å®˜æ–¹æ›´è½»é‡ï¼Œä½¿ç”¨ Rust ç¼–å†™ï¼Œæ”¹ç”¨ SQLite æ•°æ®åº“ï¼ˆç°åœ¨ä¹Ÿæ”¯æŒ MySQL å’Œ PostgreSQLï¼‰ï¼Œè¿è¡Œæ—¶åªéœ€è¦ 10M å†…å­˜ï¼Œå¯ä»¥è¯´å¯¹ç¡¬ä»¶åŸºæœ¬æ²¡æœ‰è¦æ±‚ã€‚</p><p>ç­‰æœ‰ä¸€å¤©æœ‰äº†é«˜æ€§èƒ½æœºå™¨å¯ä»¥å°è¯•ä½¿ç”¨å®˜æ–¹å®ä¾‹ï¼Œå‚è€ƒæ•™ç¨‹<a href=https://linux.do/t/topic/261426>è‡ªå»ºBitWarden</a></p><h1 class=heading id=äºŒæ­å»ºvaultwarden>äºŒã€æ­å»ºVaultWarden
<a class=anchor href=#%e4%ba%8c%e6%90%ad%e5%bb%bavaultwarden>#</a></h1><p>æ­å»ºéƒ¨åˆ†å‚è€ƒæ•™ç¨‹[[è‡ªå»ºBitWarden-å¼ºå¤§çš„è·¨å¹³å°å¯†ç ç®¡ç†ç³»ç»Ÿ#æ–¹æ¡ˆäºŒï¼šç¤¾åŒºè‡ªå»º]]</p><h2 class=heading id=21å®‰è£…docker>2.1å®‰è£…docker
<a class=anchor href=#21%e5%ae%89%e8%a3%85docker>#</a></h2><p>å‚è€ƒæ•™ç¨‹<a href="/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE%E6%B5%81%E7%A8%8B%E8%AE%B0%E5%BD%95/#å®‰è£… Docker">æœåŠ¡å™¨é…ç½®æµç¨‹è®°å½•#1. å®‰è£… Docker</a></p><h1 class=heading id=22-éƒ¨ç½²vaultwarden>2.2 éƒ¨ç½²VaultWarden
<a class=anchor href=#22-%e9%83%a8%e7%bd%b2vaultwarden>#</a></h1><p>Vaultwarden å®˜æ–¹ä»“åº“ï¼š<a href=https://github.com/dani-garcia/vaultwarden>Vaultwarden: Unofficial Bitwarden compatible server written in Rust, formerly known as bitwarden_rs</a>ã€‚</p><ol><li>åˆ›å»ºæ•°æ®å­˜å‚¨è·¯å¾„ï¼ˆåŒ…å«æ•°æ®åº“å’Œé…ç½®æ–‡ä»¶ï¼‰</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>mkdir -p /vaultwarden/data	<span style=color:#888;font-style:italic># åˆ›å»ºæ•°æ®ç›®å½•ï¼Œè¿™é‡Œå¯ä»¥è‡ªè¡Œè®¾ç½®ï¼Œä¹‹åçš„é…ç½®æ–‡ä»¶å’Œæ•°æ®åº“éƒ½ä¼šåœ¨è¿™é‡Œã€‚</span>
</span></span></code></pre></div><ol start=2><li>åˆ›å»º docker-compose.yml
ä½¿ç”¨ docker compose æ–¹å¼å®‰è£… vaultwarden</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=font-weight:700;font-style:italic>cd</span> vaultwarden	<span style=color:#888;font-style:italic># è¿›å…¥ä½ å‡†å¤‡å®‰è£…vaultwardençš„ç›®å½•ï¼Œå¯è‡ªè¡Œä¿®æ”¹</span>
</span></span><span style=display:flex><span>vim docker-compose.yml
</span></span></code></pre></div><p>ä»¥ä¸‹æ˜¯æˆ‘ç»è¿‡è°ƒè¯•çš„é…ç½®ï¼Œå¼€å¯äº†ç®¡ç†å‘˜é¡µé¢å’Œç§»åŠ¨è®¾å¤‡é€šçŸ¥ã€‚ä¿®æ”¹ä¸‹é¢çš„é…ç½®æ–‡ä»¶åç²˜è´´åˆ° docker-compose.yml æ–‡ä»¶ä¸­ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  vaultwarden:
</span></span><span style=display:flex><span>    image: vaultwarden/server:latest
</span></span><span style=display:flex><span>    container_name: vaultwarden  <span style=color:#888;font-style:italic># å®¹å™¨åç§°</span>
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    ports:
</span></span><span style=display:flex><span>      - <span style=color:#666;font-style:italic>&#34;80:80&#34;</span> <span style=color:#888;font-style:italic>#ä¿®æ”¹æƒ³è¦æ˜ å°„çš„ç«¯å£</span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - ./data:/data    <span style=color:#888;font-style:italic># é…ç½®æ•°æ®å­˜å‚¨è·¯å¾„ã€‚å°†./dataä¿®æ”¹ä¸ºåœ¨ç¬¬ä¸€æ­¥è®¾ç½®çš„æ•°æ®å­˜å‚¨è·¯å¾„</span>
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>ADMIN_TOKEN</span>=admin_tokens <span style=color:#888;font-style:italic># ç®¡ç†å‘˜å¯†é’¥ï¼Œå»ºè®®ç”Ÿæˆå››åä½ä»¥ä¸Š</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#888;font-style:italic>#ç§»åŠ¨è®¾å¤‡æ¨é€è®¾ç½®</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>PUSH_ENABLED</span>=<span style=font-weight:700;font-style:italic>true</span>       <span style=color:#888;font-style:italic># è¿™é‡Œçš„æ„æ€æ˜¯æ‰“å¼€æ¨é€åŠŸèƒ½ï¼ˆä¸å¼€å¯çš„è¯ç§»åŠ¨è®¾å¤‡æ— æ³•æ¥æ”¶é€šçŸ¥ï¼‰</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>PUSH_INSTALLATION_ID</span>=id <span style=color:#888;font-style:italic># å¡«å…¥è·å–åˆ°çš„ç§»åŠ¨è®¾å¤‡çš„æ¨åŠ¨é€šçŸ¥çš„id</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>PUSH_INSTALLATION_KEY</span>=key     <span style=color:#888;font-style:italic># å¡«å…¥key</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SIGNUPS_ALLOWED</span>=<span style=font-weight:700;font-style:italic>false</span>   <span style=color:#888;font-style:italic># ç¦æ­¢æ–°ç”¨æˆ·æ³¨å†Œï¼Œå¯ä»¥åœ¨ç®¡ç†å‘˜é¡µé¢é‚€è¯·æ³¨å†Œ</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>DOMAIN</span>=https://åŸŸå/è‡ªå®šå­è·¯å¾„/ <span style=color:#888;font-style:italic># å¦‚æœæƒ³è¦æ·»åŠ å­è·¯å¾„ï¼Œéœ€è¦å¯¹åº”ä¿®æ”¹è¿™é‡Œï¼Œä¸€å®šè¦åœ¨nginxè¿›è¡Œç›¸åº”çš„åˆ†æµ</span>
</span></span><span style=display:flex><span>        <span style=color:#888;font-style:italic># SMTP è®¾ç½®</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_HOST</span>=smtp.qq.com  <span style=color:#888;font-style:italic># SMTP æœåŠ¡å™¨åœ°å€ï¼ŒQQ é‚®ç®±ä¸º smtp.qq.com</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_FROM</span>=example@qq.com  <span style=color:#888;font-style:italic># å‘ä»¶äººé‚®ç®±åœ°å€ï¼Œæ›¿æ¢ä¸ºä½ è‡ªå·±çš„ QQ é‚®ç®±</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_FROM_NAME</span>=VaultwardenAdmin  <span style=color:#888;font-style:italic># å‘ä»¶äººåç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_PORT</span>=465  <span style=color:#888;font-style:italic># SMTP ç«¯å£ï¼ŒQQ é‚®ç®±ä½¿ç”¨ SSL åŠ å¯†ï¼Œç«¯å£ä¸º 465</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_SECURITY</span>=force_tls  <span style=color:#888;font-style:italic># SMTP åŠ å¯†æ–¹å¼ï¼ŒQQ é‚®ç®±ä½¿ç”¨ SSL åŠ å¯†ï¼Œè®¾ç½®ä¸º force_tls</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_USERNAME</span>=example@qq.com  <span style=color:#888;font-style:italic># SMTP ç”¨æˆ·åï¼Œé€šå¸¸ä¸ºä½ çš„ QQ é‚®ç®±åœ°å€</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_PASSWORD</span>=secret  <span style=color:#888;font-style:italic># SMTP å¯†ç ï¼Œæ­¤å¤„å¡«å†™ QQ é‚®ç®±çš„ SMTP æˆæƒç ï¼Œä¸æ˜¯é‚®ç®±ç™»å½•å¯†ç </span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_TIMEOUT</span>=15 <span style=color:#888;font-style:italic># è®¾ç½® SMTP è¶…æ—¶æ—¶é—´ä¸º 15 ç§’</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>SMTP_EMBED_IMAGES</span>=<span style=font-weight:700;font-style:italic>true</span> <span style=color:#888;font-style:italic># å¯ç”¨å°†å›¾ç‰‡åµŒå…¥é‚®ä»¶ä¸­</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  watchtower:
</span></span><span style=display:flex><span>    image: containrrr/watchtower
</span></span><span style=display:flex><span>    container_name: watchtower
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - /var/run/docker.sock:/var/run/docker.sock
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>TZ</span>=Asia/Shanghai
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>WATCHTOWER_CLEANUP</span>=<span style=font-weight:700;font-style:italic>true</span>
</span></span><span style=display:flex><span>      - <span style=color:#666;font-weight:700;font-style:italic>WATCHTOWER_SCHEDULE</span>=0 0 4 * * * <span style=color:#888;font-style:italic># æ¯å¤©å‡Œæ™¨4ç‚¹æ£€æŸ¥å¹¶æ›´æ–°</span>
</span></span></code></pre></div><ol><li>å¯†ç ç”Ÿæˆç½‘ç«™ï¼š<a href=https://1password.com/zh-cn/password-generator>å®‰å…¨ã€å¼ºå¤§çš„å¯†ç ç”Ÿæˆå™¨ | 1Password</a></li><li>æ¨é€é€šçŸ¥ç½‘ç«™ï¼š<a href=https://bitwarden.com/host/>Requesting Hosting Installation ID & Key | Bitwarden</a></li><li>STMPæœåŠ¡ï¼š<a href=https://app.brevo.com/settings/keys/smtp>Title Unavailable | Site Unreachable</a>
<strong>è¸©çš„å‘</strong>ï¼š</li><li>å¼€å¯ç§»åŠ¨è®¾å¤‡é€šçŸ¥ï¼Œ
ä»Vaultwarden 1.29.0ç‰ˆæœ¬å¼€å§‹ï¼Œå¯ä»¥å¯ç”¨ç§»åŠ¨å®¢æˆ·ç«¯çš„æ¨é€é€šçŸ¥ï¼Œåœ¨ç§»åŠ¨åº”ç”¨ç¨‹åºã€ç½‘é¡µæ‰©å±•ç¨‹åºå’Œç½‘é¡µå¯†ç åº“ä¹‹é—´è‡ªåŠ¨åŒæ­¥æ‚¨çš„ä¸ªäººå¯†ç åº“ï¼Œè€Œæ— éœ€æ‰‹åŠ¨åŒæ­¥ã€‚<ul><li>è®¿é—® <a href=https://bitwarden.com/host/ title=https://bitwarden.com/host/>https://bitwarden.com/host/</a>ï¼Œè¾“å…¥æ‚¨çš„ç”µå­é‚®ä»¶åœ°å€ï¼Œæ•°æ®åœ°åŒºé€‰æ‹©ç¾å›½ï¼Œç„¶åæ‚¨å°†è·å¾—ä¸€ä¸ªINSTALLATION IDå’ŒKEYã€‚</li><li>åœ¨ä½ çš„docker-compose.yamlä¸­æ·»åŠ ä»¥ä¸‹ç¯å¢ƒå˜é‡</li></ul></li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>environment:
</span></span><span style=display:flex><span>- <span style=color:#666;font-weight:700;font-style:italic>PUSH_ENABLED</span>=<span style=font-weight:700;font-style:italic>true</span>
</span></span><span style=display:flex><span>- <span style=color:#666;font-weight:700;font-style:italic>PUSH_INSTALLATION_ID</span>=è·å¾—çš„id
</span></span><span style=display:flex><span>- <span style=color:#666;font-weight:700;font-style:italic>PUSH_INSTALLATION_KEY</span>=è·å¾—çš„key
</span></span></code></pre></div><pre><code>å¦‚æœåœ¨ä¸Šä¸€æ­¥ä¸­è¯·æ±‚äº† `bitwarden.euï¼ˆæ¬§ç›Ÿï¼‰`ï¼Œè¿˜å¿…é¡»è®¾ç½®
</code></pre><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>- <span style=color:#666;font-weight:700;font-style:italic>PUSH_RELAY_URI</span>=https://push.bitwarden.eu
</span></span><span style=display:flex><span>- <span style=color:#666;font-weight:700;font-style:italic>PUSH_IDENTITY_URI</span>=https://identity.bitwarden.eu
</span></span></code></pre></div><ol start=2><li>è‡ªå®šå­è·¯å¾„
ä¸€å®šè¦åœ¨nginxè¿›è¡Œç›¸åº”çš„åˆ†æµè®¾ç½®</li></ol><p>ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker compose up -d &amp;&amp; docker compose logs -f
</span></span></code></pre></div><p><code>docker compose logs -f</code> æ˜¯ä¸ºäº†æŸ¥çœ‹æ—¥å¿—ï¼Œå¦‚æœæŠ¥é”™çš„è¯å¯ä»¥æŸ¥ä¸€æŸ¥åŸå› </p><p>å¦‚æœæ›´æ–° compose æ–‡ä»¶ä¹‹åçš„è¯ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker compose pull &amp;&amp; docker compose up -d &amp;&amp; docker compose logs -f
</span></span></code></pre></div><h1 class=heading id=ä¸‰é…ç½®nginx>ä¸‰ã€é…ç½®nginx
<a class=anchor href=#%e4%b8%89%e9%85%8d%e7%bd%aenginx>#</a></h1><h2 class=heading id=ç»è¿‡è°ƒè¯•è¿‡åçš„nginxçš„é…ç½®æ–‡ä»¶>ç»è¿‡è°ƒè¯•è¿‡åçš„nginxçš„é…ç½®æ–‡ä»¶ï¼š
<a class=anchor href=#%e7%bb%8f%e8%bf%87%e8%b0%83%e8%af%95%e8%bf%87%e5%90%8e%e7%9a%84nginx%e7%9a%84%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6>#</a></h2><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen 80;
</span></span><span style=display:flex><span>    server_name example.com;
</span></span><span style=display:flex><span>    return 301 https://$host$request_uri;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server {
</span></span><span style=display:flex><span>    listen 443 ssl;
</span></span><span style=display:flex><span>    server_name example.com;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ssl_certificate /etc/ssl/certs/example.com.pem;
</span></span><span style=display:flex><span>    ssl_certificate_key /etc/ssl/private/example.com.key;
</span></span><span style=display:flex><span>    ssl_protocols TLSv1.2 TLSv1.3; # æ ¹æ®éœ€è¦è°ƒæ•´
</span></span><span style=display:flex><span>    ssl_ciphers HIGH:!aNULL:!MD5; # æ ¹æ®éœ€è¦è°ƒæ•´
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    client_max_body_size 525M;
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    location /å­è·¯å¾„/ {
</span></span><span style=display:flex><span>        proxy_pass http://127.0.0.1:1256; # æ³¨æ„ä¿®æ”¹ç«¯å£
</span></span><span style=display:flex><span>        proxy_set_header Host $host;
</span></span><span style=display:flex><span>        proxy_set_header X-Real-IP $remote_addr;
</span></span><span style=display:flex><span>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>        proxy_set_header X-Forwarded-Proto $scheme;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    location /å­è·¯å¾„/notifications {
</span></span><span style=display:flex><span>         proxy_pass http://127.0.0.1:1256; # æ³¨æ„ä¿®æ”¹ç«¯å£
</span></span><span style=display:flex><span>         proxy_set_header Upgrade $http_upgrade;
</span></span><span style=display:flex><span>         proxy_set_header Connection &#34;upgrade&#34;;
</span></span><span style=display:flex><span>         proxy_http_version 1.1;
</span></span><span style=display:flex><span>         proxy_set_header Host $host;
</span></span><span style=display:flex><span>         proxy_set_header X-Real-IP $remote_addr;
</span></span><span style=display:flex><span>         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
</span></span><span style=display:flex><span>         proxy_set_header X-Forwarded-Proto $scheme;
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    # æ ¹è·¯å¾„è¿”å› 404 é”™è¯¯
</span></span><span style=display:flex><span>    location / {
</span></span><span style=display:flex><span>        return 404;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>è¸©çš„å‘</strong>ï¼š</p><ol><li>å­è·¯å¾„ç›¸åŒ¹é…ï¼š<ul><li>ä¸€å®šè¦åœ¨docker-compose.ymlåŠ å…¥ç›¸åº”çš„DOMAINåŸŸçš„ç¯å¢ƒå˜é‡</li><li>adminç®¡ç†é¡µé¢å¯ä»¥ä¸ç”¨é…ç½®</li></ul></li><li>æ–°ç‰ˆvaultWardenå¯ä»¥ä¸ç”¨æ‰‹åŠ¨è¿›è¡Œwebsocketç«¯å£æ˜ å°„ï¼Œåœ¨1.29ç‰ˆæœ¬ä¹‹åå…±ç”¨ä¸€ä¸ª80ç«¯å£</li></ol><blockquote><p>è‡ª Vaultwarden v1.29.0 èµ·ï¼ŒWebSocket é»˜è®¤å¯ç”¨ã€‚ä»¥å‰çš„ç‰ˆæœ¬éœ€è¦åå‘ä»£ç†ï¼Œå› ä¸º WebSocket è¿è¡Œåœ¨ä¸é»˜è®¤çš„ HTTPS ç«¯å£ä¸åŒçš„ç«¯å£ä¸Šã€‚
è‡ª Vaultwarden v1.29.0 ç‰ˆæœ¬èµ·ï¼Œæ—§çš„ <code>WEBSOCKET_ENABLED</code> å’Œ <code>WEBSOCKET_PORT</code> å·²è¢«å¼ƒç”¨å¹¶å°†è¢«å¿½ç•¥ã€‚åœ¨ v1.29.0 ç‰ˆæœ¬ä¹‹åï¼Œæ‚¨å¯ä»¥é€šè¿‡å°† <code>ENABLE_WEBSOCKET</code> è®¾ç½®ä¸º <code>false</code> å€¼æ¥ç¦ç”¨ Websocket é€šçŸ¥ï¼Œè¿™å°†å‡å°‘ Vaultwarden ä½¿ç”¨çš„èµ„æºï¼ˆå°½ç®¡ä¸ä¼šå¤ªå¤šï¼‰ã€‚</p></blockquote><ol start=3><li>éœ€è¦ä¸º<code>/å­è·¯å¾„/notifications</code>é…ç½®åˆ†æµï¼Œä¸èƒ½ä»…ä¸º<code>/å­è·¯å¾„/notifications/hub</code>é…ç½®åˆ†æµä¼šå¯¼è‡´ï¼Œä½¿ç”¨ç§»åŠ¨è®¾å¤‡å‡†è®¸ç™»å½•ä¸èƒ½ç”Ÿæ•ˆ</li></ol><h2 class=heading id=æµ‹è¯•-websocket-è¿æ¥>æµ‹è¯• WebSocket è¿æ¥
<a class=anchor href=#%e6%b5%8b%e8%af%95-websocket-%e8%bf%9e%e6%8e%a5>#</a></h2><p>æœ‰ä¸¤ç§æ–¹å¼å¯ä»¥æµ‹è¯•è¿æ¥æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š</p><ol><li><p>æ‰“å¼€æµè§ˆå™¨çš„å¼€å‘äººå‘˜å·¥å…·ï¼Œè½¬åˆ°ç½‘ç»œé€‰é¡¹å¡ç„¶åç­›é€‰ <code>WS</code>/<code>WebSockets</code>ã€‚æ³¨é”€æˆ–åˆ·æ–°é¡µé¢å¹¶å†æ¬¡ç™»å½•ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°å‡çº§åçš„ WebSocket è¿æ¥çš„ 101 å“åº”ã€‚å¦‚æœæ‚¨å•å‡»è¯¥è¡Œï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿçœ‹åˆ°æ¶ˆæ¯ã€‚å¦‚æœæ‚¨æ²¡æœ‰åœ¨ <code>/notifications/hub</code> ä¸Šè·å¾—çŠ¶æ€ä»£ç  101ï¼Œåˆ™è¡¨ç¤ºæŸäº›é…ç½®ä¸æ­£ç¡®ã€‚æ¶ˆæ¯å°†æ˜¾ç¤ºåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°çª—å£ä¸­ï¼š<code>[2023-12-01T00:00:00.000Z] Information: WebSocket connected to wss://HOST_NAME/notifications/hub?access_token=eyJ0eX......</code></p></li><li><p>æ‰“å¼€ä¸¤ä¸ªä¸åŒçš„æµè§ˆå™¨æˆ–éšèº«/éšç§çª—å£ã€‚åœ¨ä¸¤ä¸ªæµè§ˆå™¨ä¸Šç™»å½•æ‚¨çš„å¸æˆ·ã€‚åˆ›å»ºä¸€ä¸ªæ–°çš„æ¡ç›®ï¼Œæˆ–è€…é‡å‘½åä¸€ä¸ªæ¡ç›®ï¼Œåœ¨å¦ä¸€ä¸ªæµè§ˆå™¨ä¸­åº”è¯¥ä¼šç«‹å³æ”¶åˆ°æ›´æ”¹ã€‚</p></li><li><p>æµ‹è¯•ç§»åŠ¨è®¾å¤‡å‡†è®¸ç™»å½•åŠŸèƒ½ã€‚</p></li></ol><h1 class=heading id=å››å®‰å…¨è®¾ç½®>å››ã€å®‰å…¨è®¾ç½®
<a class=anchor href=#%e5%9b%9b%e5%ae%89%e5%85%a8%e8%ae%be%e7%bd%ae>#</a></h1><h2 class=heading id=41cloudflareæ“ä½œ>4.1cloudflareæ“ä½œï¼š
<a class=anchor href=#41cloudflare%e6%93%8d%e4%bd%9c>#</a></h2><ul><li><code>SSL/TLS</code> <code>æ¦‚è¿°</code> åŠ å¯†æ¨¡å¼ï¼šå®Œå…¨ï¼ˆä¸¥æ ¼ï¼‰</li></ul><h2 class=heading id=42-vpsæ“ä½œ>4.2 VPSæ“ä½œ
<a class=anchor href=#42-vps%e6%93%8d%e4%bd%9c>#</a></h2><h3 class=heading id=è®¾ç½®éšæœºå­è·¯å¾„>è®¾ç½®éšæœºå­è·¯å¾„
<a class=anchor href=#%e8%ae%be%e7%bd%ae%e9%9a%8f%e6%9c%ba%e5%ad%90%e8%b7%af%e5%be%84>#</a></h3><ol><li>ä¿®æ”¹docker-compose.ymlæ–‡ä»¶ï¼Œenvironmentå˜é‡åŠ å…¥DOMAINåŸŸ</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>environment:
</span></span><span style=display:flex><span>- DOMAIN=https://åŸŸå/è‡ªå®šå­è·¯å¾„/ <span style=color:#888;font-style:italic># å¦‚æœæƒ³è¦æ·»åŠ å­è·¯å¾„ï¼Œéœ€è¦å¯¹åº”ä¿®æ”¹è¿™é‡Œï¼Œä¸€å®šè¦åœ¨nginxè¿›è¡Œç›¸åº”çš„åˆ†æµ</span>
</span></span></code></pre></div><ol start=2><li>è®¾ç½®å­è·¯å¾„åˆ†æµ</li></ol><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>location</span> <span style=color:#666;font-style:italic>/å­è·¯å¾„/</span> {
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>proxy_pass</span> <span style=color:#666;font-style:italic>http://127.0.0.1:1256</span>; <span style=color:#888;font-style:italic># æ³¨æ„ä¿®æ”¹ç«¯å£
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>        <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>Host</span> <span style=color:#666;font-weight:700;font-style:italic>$host</span>;
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Real-IP</span> <span style=color:#666;font-weight:700;font-style:italic>$remote_addr</span>;
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Forwarded-For</span> <span style=color:#666;font-weight:700;font-style:italic>$proxy_add_x_forwarded_for</span>;
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Forwarded-Proto</span> <span style=color:#666;font-weight:700;font-style:italic>$scheme</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=font-weight:700;text-decoration:underline>location</span> <span style=color:#666;font-style:italic>/å­è·¯å¾„/notifications</span> {
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_pass</span> <span style=color:#666;font-style:italic>http://127.0.0.1:1256</span>; <span style=color:#888;font-style:italic># æ³¨æ„ä¿®æ”¹ç«¯å£
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>Upgrade</span> <span style=color:#666;font-weight:700;font-style:italic>$http_upgrade</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>Connection</span> <span style=color:#666;font-style:italic>&#34;upgrade&#34;</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_http_version</span> 1<span style=color:#666;font-style:italic>.1</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>Host</span> <span style=color:#666;font-weight:700;font-style:italic>$host</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Real-IP</span> <span style=color:#666;font-weight:700;font-style:italic>$remote_addr</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Forwarded-For</span> <span style=color:#666;font-weight:700;font-style:italic>$proxy_add_x_forwarded_for</span>;
</span></span><span style=display:flex><span>         <span style=font-weight:700;text-decoration:underline>proxy_set_header</span> <span style=color:#666;font-style:italic>X-Forwarded-Proto</span> <span style=color:#666;font-weight:700;font-style:italic>$scheme</span>;
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#888;font-style:italic># æ ¹è·¯å¾„è¿”å› 404 é”™è¯¯
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>    <span style=font-weight:700;text-decoration:underline>location</span> <span style=color:#666;font-style:italic>/</span> {
</span></span><span style=display:flex><span>        <span style=font-weight:700;text-decoration:underline>return</span> 404;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><h3 class=heading id=å…³é—­é¡µé¢å¹¶ç¦ç”¨æ³¨å†Œ>å…³é—­é¡µé¢å¹¶ç¦ç”¨æ³¨å†Œ
<a class=anchor href=#%e5%85%b3%e9%97%ad%e9%a1%b5%e9%9d%a2%e5%b9%b6%e7%a6%81%e7%94%a8%e6%b3%a8%e5%86%8c>#</a></h3><p>æŸ¥çœ‹ç½‘é¡µç«¯çš„å¯†ç é‡å¤æ³„éœ²æŠ¥å‘Šï¼Œç„¶åå…³é—­ç½‘é¡µç«¯</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>environment:
</span></span><span style=display:flex><span>- SIGNUPS_ALLOWED=false <span style=color:#888;font-style:italic>#å…³é—­æ³¨å†Œ</span>
</span></span><span style=display:flex><span>- WEB_VAULT_ENABLED=false <span style=color:#888;font-style:italic>#å…³é—­ç½‘é¡µç«¯</span>
</span></span></code></pre></div><h3 class=heading id=å®šæ—¶æ£€æŸ¥å®¹å™¨æ›´æ–°>å®šæ—¶æ£€æŸ¥å®¹å™¨æ›´æ–°
<a class=anchor href=#%e5%ae%9a%e6%97%b6%e6%a3%80%e6%9f%a5%e5%ae%b9%e5%99%a8%e6%9b%b4%e6%96%b0>#</a></h3><blockquote><p>2025å¹´2æœˆ7æ—¥æ›´æ–°ï¼šwatchtowerçš„cronä½¿ç”¨äº†SPRINGè¯­æ³•</p></blockquote><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  watchtower:
</span></span><span style=display:flex><span>    image: containrrr/watchtower
</span></span><span style=display:flex><span>    container_name: watchtower
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - /var/run/docker.sock:/var/run/docker.sock
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - TZ=Asia/Shanghai
</span></span><span style=display:flex><span>      - WATCHTOWER_CLEANUP=true
</span></span><span style=display:flex><span>      - WATCHTOWER_SCHEDULE=0 0 4 * * * <span style=color:#888;font-style:italic># æ¯å¤©å‡Œæ™¨4ç‚¹æ£€æŸ¥å¹¶æ›´æ–°</span>
</span></span></code></pre></div><h2 class=heading id=43vaultwarden-è‡ªåŠ¨å¤‡ä»½é…ç½®>4.3vaultwarden è‡ªåŠ¨å¤‡ä»½é…ç½®
<a class=anchor href=#43vaultwarden-%e8%87%aa%e5%8a%a8%e5%a4%87%e4%bb%bd%e9%85%8d%e7%bd%ae>#</a></h2><p>å¼‚åœ°å¤‡ä»½ï¼Œå¯†ç ä¸è¦å‚¨å­˜åœ¨vaulté‡Œ
ä½¿ç”¨é¡¹ç›®<a href="https://github.com/ttionya/vaultwarden-backup?tab=readme-ov-file">GitHub - ttionya/vaultwarden-backup</a> ç”¨äºå¤‡ä»½ <a href=https://github.com/dani-garcia/vaultwarden>vaultwarden</a> æ•°æ®ï¼Œå¹¶é€šè¿‡ <a href=https://rclone.org/>Rclone</a> åŒæ­¥åˆ°å…¶ä»–å­˜å‚¨ç³»ç»Ÿã€‚</p><h3 class=heading id=ä½¿ç”¨æ­¥éª¤>ä½¿ç”¨æ­¥éª¤
<a class=anchor href=#%e4%bd%bf%e7%94%a8%e6%ad%a5%e9%aa%a4>#</a></h3><h4 class=heading id=ä¸€é…ç½®-rclone>ä¸€ã€é…ç½® Rclone
<a class=anchor href=#%e4%b8%80%e9%85%8d%e7%bd%ae-rclone>#</a></h4><p><strong>é‡è¦æç¤ºï¼š</strong> å¤‡ä»½å‰å¿…é¡»é…ç½® Rcloneï¼Œå¦åˆ™å¤‡ä»½å·¥å…·æ— æ³•å·¥ä½œã€‚è¿˜åŸå¤‡ä»½åˆ™éå¿…é¡»é…ç½® Rcloneã€‚
<strong>é…ç½®æ­¥éª¤ï¼š</strong></p><ol><li><p><strong>è¿è¡Œ Rclone é…ç½®å®¹å™¨ï¼š</strong></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --rm -it <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --mount <span style=color:#666;font-weight:700;font-style:italic>type</span>=volume,source=vaultwarden-rclone-data,target=/config/ <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  ttionya/vaultwarden-backup:latest <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  rclone config
</span></span></code></pre></div><ul><li><code>docker run --rm -it</code>ï¼šè¿è¡Œä¸€ä¸ªä¸´æ—¶çš„ã€äº¤äº’å¼çš„ Docker å®¹å™¨ã€‚</li><li><code>--mount type=volume,source=vaultwarden-rclone-data,target=/config/</code>ï¼šå°†åä¸º <code>vaultwarden-rclone-data</code> çš„ Docker å·æŒ‚è½½åˆ°å®¹å™¨çš„ <code>/config</code> ç›®å½•ï¼Œç”¨äºå­˜å‚¨ Rclone çš„é…ç½®æ–‡ä»¶ã€‚å¦‚æœè¿™ä¸ªå·ä¸å­˜åœ¨ï¼ŒDocker ä¼šè‡ªåŠ¨åˆ›å»ºå®ƒã€‚</li><li><code>rclone config</code>ï¼šåœ¨å®¹å™¨ä¸­æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯åŠ¨ Rclone çš„äº¤äº’å¼é…ç½®å‘å¯¼ã€‚</li></ul><p>æ­¤å‘½ä»¤ä¼šå¯åŠ¨ Rclone çš„äº¤äº’å¼é…ç½®å‘å¯¼ï¼ŒæŒ‰ç…§æç¤ºé…ç½®ä½ çš„äº‘å­˜å‚¨æœåŠ¡ã€‚</p></li></ol><p>æˆ‘å‡†å¤‡åŒæ—¶å¤‡ä»½åˆ° Google Driveã€Infini-cloud (WebDAV) å’Œ OneDrive è¿™ä¸‰ä¸ªç½‘ç›˜ï¼Œå¹¶æœ€ç»ˆå°†å®ƒä»¬åˆå¹¶åˆ°ä¸€ä¸ª <code>union</code> è¿œç¨‹ä¸­</p><p><strong>æ­¥éª¤ï¼š</strong></p><p>ä¸€ã€é…ç½® Google Drive è¿œç¨‹ ï¼ˆéœ€è¦æŒ‚æ¢¯å­æ‰èƒ½æ”¶åˆ°å›è°ƒï¼‰</p><p>è¿è¡Œ Rclone é…ç½®å®¹å™¨ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run --rm -it <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --mount <span style=color:#666;font-weight:700;font-style:italic>type</span>=volume,source=vaultwarden-rclone-data,target=/config/ <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  ttionya/vaultwarden-backup:latest <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  rclone config
</span></span></code></pre></div><p>åˆ›å»ºæ–°è¿œç¨‹ (New remote)ï¼šè¾“å…¥ n å¹¶å›è½¦ï¼›å‘½åè¿œç¨‹ï¼šname> åé¢è¾“å…¥ BitwardenBackup-GoogleDrive å¹¶å›è½¦ï¼›é€‰æ‹©å­˜å‚¨ç±»å‹ï¼šæ‰¾åˆ° Google Drive å¯¹åº”çš„ç¼–å·ï¼Œé€šå¸¸æ˜¯ 20ï¼Œè¾“å…¥ 20 å¹¶å›è½¦ï¼›client_idï¼šç›´æ¥å›è½¦ï¼›client_secretï¼šç›´æ¥å›è½¦ï¼›é€‰æ‹©æƒé™èŒƒå›´ (scope)ï¼šè¾“å…¥ 1 (é€‰æ‹© Full access all files, excluding Application Data folder.) å¹¶å›è½¦ï¼›root_folder_idï¼šç›´æ¥å›è½¦ï¼›service_account_fileï¼šç›´æ¥å›è½¦ï¼›ç¼–è¾‘é«˜çº§é…ç½® (Edit advanced config)ï¼šè¾“å…¥ n å¹¶å›è½¦ï¼›è‡ªåŠ¨é…ç½® (Use auto config)ï¼šè¾“å…¥ y å¹¶å›è½¦ï¼›æµè§ˆå™¨éªŒè¯ï¼Œå¤åˆ¶æˆæƒç ï¼›ç²˜è´´æˆæƒç åˆ° Enter verification code> æç¤ºç¬¦åå›è½¦ï¼›æ˜¯å¦æ˜¯å›¢é˜Ÿç›˜ (team drive)ï¼šæ ¹æ®éœ€è¦è¾“å…¥ y æˆ–ç›´æ¥å›è½¦ï¼›ç¡®è®¤é…ç½®ï¼šè¾“å…¥ y å¹¶å›è½¦ã€‚</p><p>äºŒã€é…ç½® Infini-cloud (WebDAV) è¿œç¨‹</p><p>è¿è¡Œ Rclone é…ç½®å®¹å™¨ï¼›åˆ›å»ºæ–°è¿œç¨‹ (New remote)ï¼šè¾“å…¥ n å¹¶å›è½¦ï¼›å‘½åè¿œç¨‹ï¼šname> åé¢è¾“å…¥ BitwardenBackup-InfiniCloud å¹¶å›è½¦ï¼›é€‰æ‹©å­˜å‚¨ç±»å‹ï¼šæ‰¾åˆ° WebDAV å¯¹åº”çš„ç¼–å·ï¼Œé€šå¸¸æ˜¯ 56ï¼Œè¾“å…¥ 56 å¹¶å›è½¦ï¼›è¾“å…¥ urlï¼šurl> åé¢è¾“å…¥ Infini-cloud æä¾›çš„ WebDAV URLï¼›è¾“å…¥ vendorï¼švendor> åé¢è¾“å…¥ other å¹¶å›è½¦ï¼›è¾“å…¥ userï¼šuser> åé¢è¾“å…¥ä½ çš„ Infini-cloud ç”¨æˆ·åï¼›è¾“å…¥ passï¼špass> åé¢è¾“å…¥ y å¹¶å›è½¦ï¼Œç„¶åè¾“å…¥ä¸¤æ¬¡å¯†ç ï¼›è¾“å…¥ bearer_tokenï¼šç›´æ¥å›è½¦ï¼›ç¼–è¾‘é«˜çº§é…ç½® (Edit advanced config)ï¼šè¾“å…¥ n å¹¶å›è½¦ï¼›ç¡®è®¤é…ç½®ï¼šè¾“å…¥ y å¹¶å›è½¦ã€‚</p><p>ä¸‰ã€é…ç½® OneDrive è¿œç¨‹</p><p>è¿è¡Œ Rclone é…ç½®å®¹å™¨ï¼›åˆ›å»ºæ–°è¿œç¨‹ (New remote)ï¼šè¾“å…¥ n å¹¶å›è½¦ï¼›å‘½åè¿œç¨‹ï¼šname> åé¢è¾“å…¥ BitwardenBackup-OneDrive å¹¶å›è½¦ï¼›é€‰æ‹©å­˜å‚¨ç±»å‹ï¼šæ‰¾åˆ° Microsoft OneDrive å¯¹åº”çš„ç¼–å·ï¼Œé€šå¸¸æ˜¯ 36ï¼Œè¾“å…¥ 36 å¹¶å›è½¦ï¼›client_idï¼šç›´æ¥å›è½¦ï¼›client_secretï¼šç›´æ¥å›è½¦ï¼›é€‰æ‹©åœ°åŒº (region)ï¼šé€‰æ‹© global å¯¹åº”çš„ç¼–å·å¹¶å›è½¦ï¼›ç¼–è¾‘é«˜çº§é…ç½® (Edit advanced config)ï¼šè¾“å…¥ n å¹¶å›è½¦ï¼›è‡ªåŠ¨é…ç½® (Use auto config)ï¼šè¾“å…¥ y å¹¶å›è½¦ï¼›æµè§ˆå™¨éªŒè¯ï¼Œå¤åˆ¶æˆæƒç ï¼›ç²˜è´´æˆæƒç åˆ° Enter verification code> æç¤ºç¬¦åå›è½¦ï¼›é€‰æ‹©é©±åŠ¨å™¨ç±»å‹ (drive type)ï¼šæ ¹æ®ä½ çš„ OneDrive ç±»å‹é€‰æ‹© personalã€business æˆ– document libraryï¼Œè¾“å…¥å¯¹åº”çš„ç¼–å·å¹¶å›è½¦; é€‰æ‹©é©±åŠ¨å™¨ (drive id)ï¼šè¾“å…¥ 0 å¹¶å›è½¦; ç¡®è®¤é…ç½®ï¼šè¾“å…¥ y å¹¶å›è½¦ã€‚
å››ã€é…ç½® Union è¿œç¨‹</p><p>è¿è¡Œ Rclone é…ç½®å®¹å™¨ï¼›åˆ›å»ºæ–°è¿œç¨‹ (New remote)ï¼šè¾“å…¥ n å¹¶å›è½¦ï¼›å‘½åè¿œç¨‹ï¼šname> åé¢è¾“å…¥ BitwardenBackup å¹¶å›è½¦ï¼›é€‰æ‹©å­˜å‚¨ç±»å‹ï¼šæ‰¾åˆ° Union å¯¹åº”çš„ç¼–å·ï¼Œé€šå¸¸æ˜¯ 54ï¼Œè¾“å…¥ 54 å¹¶å›è½¦ï¼›è¾“å…¥ upstreamsï¼šupstreams> åé¢è¾“å…¥ä½ ä¹‹å‰é…ç½®çš„ä¸‰ä¸ªè¿œç¨‹çš„åç§°ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼š</p><p>BitwardenBackup-GoogleDrive: BitwardenBackup-InfiniCloud: BitwardenBackup-OneDrive:
è¾“å…¥ action_policyï¼šè¾“å…¥ all å¹¶å›è½¦ï¼›è¾“å…¥ create_policyï¼šè¾“å…¥ all å¹¶å›è½¦ï¼›è¾“å…¥ search_policyï¼šè¾“å…¥ all å¹¶å›è½¦ï¼›ç¡®è®¤é…ç½®ï¼šè¾“å…¥ y å¹¶å›è½¦ã€‚</p><p>å››ã€é…ç½®å®Œæˆåï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®ï¼š</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>    docker run --rm -it <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>      --mount <span style=color:#666;font-weight:700;font-style:italic>type</span>=volume,source=vaultwarden-rclone-data,target=/config/ <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>      ttionya/vaultwarden-backup:latest <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>      rclone config show
</span></span></code></pre></div><h4 class=heading id=äºŒä¿®æ”¹-docker-composeyml-æ–‡ä»¶>äºŒã€ä¿®æ”¹ <code>docker-compose.yml</code> æ–‡ä»¶
<a class=anchor href=#%e4%ba%8c%e4%bf%ae%e6%94%b9-docker-composeyml-%e6%96%87%e4%bb%b6>#</a></h4><p>æœ¬æ–¹æ¡ˆé‡‡ç”¨æ¯æ—¥å¤‡ä»½ï¼Œä¿ç•™ä¸‰åå¤©ï¼Œæ¯æœˆå¤‡ä»½ä¸€æ¬¡ï¼Œä¿ç•™åäºŒä¸ªæœˆçš„å¤‡ä»½æ–¹å¼ï¼šå¼€å¯ä¸¤ä¸ªbackupæœåŠ¡-daily_backupå’Œmonthly_backup</p><h5 class=heading id=41-ä¿®æ”¹-docker-composeyml-æ–‡ä»¶>4.1 ä¿®æ”¹ <code>docker-compose.yml</code> æ–‡ä»¶
<a class=anchor href=#41-%e4%bf%ae%e6%94%b9-docker-composeyml-%e6%96%87%e4%bb%b6>#</a></h5><p>å°† <code>vaultwarden-backup</code> æœåŠ¡çš„ <code>RCLONE_REMOTE_NAME</code> ç¯å¢ƒå˜é‡è®¾ç½®ä¸º <code>BitwardenBackup</code>ã€‚</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  vaultwarden:
</span></span><span style=display:flex><span>    image: vaultwarden/server:latest
</span></span><span style=display:flex><span>    container_name: vaultwarden  
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    ports:
</span></span><span style=display:flex><span>      - <span style=color:#666;font-style:italic>&#34;1256:80&#34;</span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - ./data:/data    
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - ADMIN_TOKEN=gwQnrvr6sWcCiw6pYhUYFQVTTEPYWx4UR6uhTB73dsrPXDWEHhxC5Fs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#888;font-style:italic>#ç§»åŠ¨è®¾å¤‡æ¨é€è®¾ç½®</span>
</span></span><span style=display:flex><span>      - PUSH_ENABLED=true       <span style=color:#888;font-style:italic># è¿™é‡Œçš„æ„æ€æ˜¯æ‰“å¼€æ¨é€åŠŸèƒ½ï¼ˆä¸å¼€å¯çš„è¯ç§»åŠ¨è®¾å¤‡æ— æ³•æ¥æ”¶é€šçŸ¥ï¼‰</span>
</span></span><span style=display:flex><span>      - PUSH_INSTALLATION_ID=eb1d824c-941d-4109-bb8d-b26a00cd0ba3
</span></span><span style=display:flex><span>      - PUSH_INSTALLATION_KEY=u1r438BxudgiOaURxOss     <span style=color:#888;font-style:italic># å¡«å…¥key</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      - SIGNUPS_ALLOWED=false   <span style=color:#888;font-style:italic># ç¦æ­¢æ–°ç”¨æˆ·æ³¨å†Œï¼Œå¯ä»¥åœ¨ç®¡ç†å‘˜é¡µé¢é‚€è¯·æ³¨ å†Œ</span>
</span></span><span style=display:flex><span>      - DOMAIN=https://vtolove.me/psJm18PFVg8EkBnTA5Fi/
</span></span><span style=display:flex><span>         <span style=color:#888;font-style:italic># SMTP è®¾ç½®</span>
</span></span><span style=display:flex><span>      - SMTP_HOST=smtp.qq.com  <span style=color:#888;font-style:italic># SMTP æœåŠ¡å™¨åœ°å€ï¼ŒQQ é‚®ç®±ä¸º smtp.qq.com</span>
</span></span><span style=display:flex><span>      - SMTP_FROM=849815996@qq.com  <span style=color:#888;font-style:italic># å‘ä»¶äººé‚®ç®±åœ°å€ï¼Œæ›¿æ¢ä¸ºä½ è‡ªå·±çš„ QQ é‚®ç®±</span>
</span></span><span style=display:flex><span>      - SMTP_FROM_NAME=VaultwardenAdmin  <span style=color:#888;font-style:italic># å‘ä»¶äººåç§°ï¼Œå¯ä»¥è‡ªå®šä¹‰</span>
</span></span><span style=display:flex><span>      - SMTP_PORT=465  <span style=color:#888;font-style:italic># SMTP ç«¯å£ï¼ŒQQ é‚®ç®±ä½¿ç”¨ SSL åŠ å¯†ï¼Œç«¯å£ä¸º 465</span>
</span></span><span style=display:flex><span>      - SMTP_SECURITY=force_tls  <span style=color:#888;font-style:italic># SMTP åŠ å¯†æ–¹å¼ï¼ŒQQ é‚®ç®±ä½¿ç”¨ SSL åŠ å¯†ï¼Œè®¾ç½®ä¸º force_tls</span>
</span></span><span style=display:flex><span>      - SMTP_USERNAME=849815996@qq.com  <span style=color:#888;font-style:italic># SMTP ç”¨æˆ·åï¼Œé€šå¸¸ä¸ºä½ çš„ QQ é‚®ç®±åœ°å€</span>
</span></span><span style=display:flex><span>      - SMTP_PASSWORD=lxpttclhjtcvbeja  <span style=color:#888;font-style:italic># SMTP å¯†ç ï¼Œæ­¤å¤„å¡«å†™ QQ é‚®ç®±çš„ SMTP æˆæƒç ï¼Œä¸æ˜¯é‚®ç®±ç™»å½•å¯†ç </span>
</span></span><span style=display:flex><span>      - SMTP_TIMEOUT=15 <span style=color:#888;font-style:italic># è®¾ç½® SMTP è¶…æ—¶æ—¶é—´ä¸º 15 ç§’</span>
</span></span><span style=display:flex><span>      - SMTP_EMBED_IMAGES=true <span style=color:#888;font-style:italic># å¯ç”¨å°†å›¾ç‰‡åµŒå…¥é‚®ä»¶ä¸­</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  daily_backup:
</span></span><span style=display:flex><span>    image: ttionya/vaultwarden-backup:latest
</span></span><span style=display:flex><span>    container_name: daily_vaultwarden_backup
</span></span><span style=display:flex><span>    restart: always
</span></span><span style=display:flex><span>    depends_on:
</span></span><span style=display:flex><span>      - vaultwarden
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - RCLONE_REMOTE_NAME=BitwardenBackup <span style=color:#888;font-style:italic># Rclone è¿œç¨‹åç§°ï¼Œå¿…é¡»ä¸ rclone é…ç½®ä¸­çš„åç§°ä¸€è‡´</span>
</span></span><span style=display:flex><span>      - RCLONE_REMOTE_DIR=/BitwardenBackup/daily/ <span style=color:#888;font-style:italic># è¿œç¨‹å­˜å‚¨ç³»ç»Ÿä¸­å­˜æ”¾å¤‡ä»½æ–‡ä»¶çš„ç›®å½•</span>
</span></span><span style=display:flex><span>      - BACKUP_KEEP_DAYS=30
</span></span><span style=display:flex><span>      - CRON= 3 4 * * *  <span style=color:#888;font-style:italic># æ¯æ—¥å¤‡ä»½çš„ cron è¡¨è¾¾å¼ï¼Œè®¾ç½®ä¸ºæ¯å¤© 04:00 æ‰§è¡Œ</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># é€šç”¨å¤‡ä»½è®¾ç½®</span>
</span></span><span style=display:flex><span>      - ZIP_PASSWORD=bDxhYG3ANhEqd1Ll0LCdUONmrs8hi4ERZfm   <span style=color:#888;font-style:italic>#å¤‡ä»½æ–‡ä»¶çš„å‹ç¼©å¯†ç ï¼Œè¯·æ›¿æ¢ä¸ºä½ è‡ªå·±çš„å¯†ç </span>
</span></span><span style=display:flex><span>      - BACKUP_FILE_SUFFIX=%Y%m%d <span style=color:#888;font-style:italic># æ¯æ—¥å¤‡ä»½æ–‡ä»¶åç¼€ï¼Œä¾‹å¦‚ï¼š20231027</span>
</span></span><span style=display:flex><span>      - TIMEZONE=Asia/Shanghai <span style=color:#888;font-style:italic># è®¾ç½®æ—¶åŒºä¸º Asia/Shanghai</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># å…¶ä»–å¯é€‰ç¯å¢ƒå˜é‡ï¼š</span>
</span></span><span style=display:flex><span>      - DATA_DIR=/data <span style=color:#888;font-style:italic># æŒ‡å®šå­˜æ”¾ vaultwarden æ•°æ®çš„ç›®å½•ï¼Œé»˜è®¤ä¸º /bitwarden/dataï¼Œå¦‚æœ vaultwarden æœåŠ¡ä¸­é…ç½®äº† volumesï¼Œè¿™é‡Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - BACKUP_FILE_DATE # å¤‡ä»½æ–‡ä»¶çš„æ—¶é—´å‰ç¼€ï¼Œé»˜è®¤ä¸º %Y%m%dï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - BACKUP_FILE_DATE_SUFFIX # å¤‡ä»½æ–‡ä»¶çš„æ—¥æœŸåç¼€ï¼Œé»˜è®¤ä¸º &#39;&#39;ï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - DATA_DB # æŒ‡å®š sqlite æ•°æ®åº“æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º ${DATA_DIR}/db.sqlite3ï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - DATA_RSAKEY # æŒ‡å®š rsa_key æ–‡ä»¶çš„è·¯å¾„ï¼Œé»˜è®¤ä¸º ${DATA_DIR}/rsa_keyï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - DATA_ATTACHMENTS # æŒ‡å®š attachments æ–‡ä»¶å¤¹è·¯å¾„ï¼Œé»˜è®¤ä¸º ${DATA_DIR}/attachmentsï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - DATA_SENDS # æŒ‡å®š sends æ–‡ä»¶å¤¹è·¯å¾„ï¼Œé»˜è®¤ä¸º ${DATA_DIR}/sendsï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># é€šçŸ¥è®¾ç½® (å¯é€‰ï¼Œæ ¹æ®éœ€è¦é…ç½®)</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - MAIL_SMTP_ENABLE=FALSE # æ˜¯å¦å¯ç”¨é‚®ä»¶é€šçŸ¥ï¼Œé»˜è®¤ä¸º FALSE</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - MAIL_SMTP_VARIABLES= # é‚®ä»¶å‘é€å‚æ•°ï¼Œå¯ç”¨é‚®ä»¶é€šçŸ¥æ—¶éœ€è¦é…ç½®</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - MAIL_TO= # æ¥æ”¶é‚®ä»¶çš„åœ°å€ï¼Œå¯ç”¨é‚®ä»¶é€šçŸ¥æ—¶éœ€è¦é…ç½®</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - MAIL_WHEN_SUCCESS=TRUE # å¤‡ä»½æˆåŠŸåå‘é€é‚®ä»¶ï¼Œé»˜è®¤ä¸º TRUE</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - MAIL_WHEN_FAILURE=TRUE # å¤‡ä»½å¤±è´¥åå‘é€é‚®ä»¶ï¼Œé»˜è®¤ä¸º TRUE</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL= # å¤‡ä»½å®Œæˆåå‘é€è¯·æ±‚çš„åœ°å€ (æ— è®ºæˆåŠŸæˆ–å¤±è´¥)</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_CURL_OPTIONS= # ä¸ PING_URL æ­é…ä½¿ç”¨çš„ curl é€‰é¡¹</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_START= # å¤‡ä»½å¼€å§‹æ—¶å‘é€è¯·æ±‚çš„åœ°å€</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_START_CURL_OPTIONS= # ä¸ PING_URL_WHEN_START æ­é…ä½¿ç”¨çš„ curl é€‰é¡¹</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_SUCCESS= # å¤‡ä»½æˆåŠŸåå‘é€è¯·æ±‚çš„åœ°å€</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_SUCCESS_CURL_OPTIONS= # ä¸ PING_URL_WHEN_SUCCESS æ­é…ä½¿ç”¨çš„ curl é€‰é¡¹</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_FAILURE= # å¤‡ä»½å¤±è´¥åå‘é€è¯·æ±‚çš„åœ°å€</span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># - PING_URL_WHEN_FAILURE_CURL_OPTIONS= # ä¸ PING_URL_WHEN_FAILURE æ­é…ä½¿ç”¨çš„ curl é€‰é¡¹</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#888;font-style:italic># RCLONE_GLOBAL_FLAG: &#39;&#39; # Rclone å…¨å±€å‚æ•°ï¼Œè¯¦è§ rclone æ–‡æ¡£ï¼Œé€šå¸¸ä¸éœ€è¦ä¿®æ”¹</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - ./data:/data <span style=color:#888;font-style:italic># æŒ‚è½½ vaultwarden çš„æ•°æ®ç›®å½•</span>
</span></span><span style=display:flex><span>      - vaultwarden-rclone-data:/config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  monthly_backup:
</span></span><span style=display:flex><span>    image: ttionya/vaultwarden-backup:latest
</span></span><span style=display:flex><span>    container_name: monthly_valutwarden_backup
</span></span><span style=display:flex><span>    restart: always
</span></span><span style=display:flex><span>    depends_on:
</span></span><span style=display:flex><span>      - vaultwarden
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - RCLONE_REMOTE_NAME=BitwardenBackup
</span></span><span style=display:flex><span>      - RCLONE_REMOTE_DIR=/BitwardenBackup/monthly/
</span></span><span style=display:flex><span>      - ZIP_PASSWORD=bDxhYG3ANhEqd1Ll0LCdUONmrs8hi4ERZfm
</span></span><span style=display:flex><span>      - BACKUP_KEEP_DAYS=365
</span></span><span style=display:flex><span>      - CRON= 0 4 1 * *  <span style=color:#888;font-style:italic># æ¯æœˆå¤‡ä»½çš„ cron è¡¨è¾¾å¼ï¼Œè®¾ç½®ä¸ºæ¯æœˆ 1 å· 00:00 æ‰§è¡Œ</span>
</span></span><span style=display:flex><span>      - TIMEZONE=Asia/Shanghai
</span></span><span style=display:flex><span>      - DATA_DIR=/data
</span></span><span style=display:flex><span>      - BACKUP_FILE_SUFFIX=%Y%m <span style=color:#888;font-style:italic># æ¯æœˆå¤‡ä»½æ–‡ä»¶åç¼€ï¼Œä¾‹å¦‚ï¼š202310</span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - ./data:/data
</span></span><span style=display:flex><span>      - vaultwarden-rclone-data:/config
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  watchtower:
</span></span><span style=display:flex><span>    image: containrrr/watchtower
</span></span><span style=display:flex><span>    container_name: watchtower
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - /var/run/docker.sock:/var/run/docker.sock
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      - TZ=Asia/Shanghai
</span></span><span style=display:flex><span>      - WATCHTOWER_CLEANUP=true
</span></span><span style=display:flex><span>      - WATCHTOWER_SCHEDULE=0 0 4 * * *
</span></span><span style=display:flex><span>    depends_on:
</span></span><span style=display:flex><span>      - vaultwarden
</span></span><span style=display:flex><span>      - daily_backup
</span></span><span style=display:flex><span>      - monthly_backup 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>volumes:
</span></span><span style=display:flex><span>  vaultwarden-rclone-data:
</span></span><span style=display:flex><span>    external: <span style=font-weight:700;text-decoration:underline>true</span>
</span></span><span style=display:flex><span>    name: vaultwarden-rclone-data
</span></span></code></pre></div><ul><li><strong><code>RCLONE_REMOTE_NAME=BitwardenBackup</code>ï¼š</strong> å°†å¤‡ä»½ç›®æ ‡è®¾ç½®ä¸º <code>union</code> è¿œç¨‹ã€‚</li><li><strong><code>RCLONE_REMOTE_DIR=/BitwardenBackup/daily</code>ï¼š</strong> è®¾ç½®å¤‡ä»½åˆ° <code>union</code> è¿œç¨‹çš„ <code>/BitwardenBackup/daily/</code> æ–‡ä»¶å¤¹ï¼Œæ¯å¤©4ç‚¹å·¦å³è¿›è¡Œå¤‡ä»½</li><li><code>RCLONE_REMOTE_DIR=/BitwardenBackup/monthly:</code>è®¾ç½®å¤‡ä»½åˆ° <code>union</code> è¿œç¨‹çš„ <code>/BitwardenBackup/monthly/</code> æ–‡ä»¶å¤¹ï¼Œæ¯ä¸ªæœˆä¸€å·è¿›è¡Œå¤‡ä»½</li></ul><p>é‡å¯æœåŠ¡</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker compose up -d
</span></span></code></pre></div><h5 class=heading id=42-æ‰‹åŠ¨å¤‡ä»½>4.2 æ‰‹åŠ¨å¤‡ä»½ï¼š
<a class=anchor href=#42-%e6%89%8b%e5%8a%a8%e5%a4%87%e4%bb%bd>#</a></h5><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker <span style=font-weight:700;font-style:italic>exec</span> daily_vaultwarden_backup bash /app/backup.sh
</span></span></code></pre></div><h4 class=heading id=ä¸‰è¿˜åŸå¤‡ä»½-æœªå°è¯•>ä¸‰ã€è¿˜åŸå¤‡ä»½-æœªå°è¯•
<a class=anchor href=#%e4%b8%89%e8%bf%98%e5%8e%9f%e5%a4%87%e4%bb%bd-%e6%9c%aa%e5%b0%9d%e8%af%95>#</a></h4><p><strong>é‡è¦æç¤ºï¼š</strong> è¿˜åŸå¤‡ä»½ä¼šè¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶ã€‚æ“ä½œå‰è¯·åŠ¡å¿…åœæ­¢ vaultwarden å®¹å™¨ã€‚</p><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li><p><strong>ä¸‹è½½å¤‡ä»½æ–‡ä»¶åˆ°æœ¬åœ°è®¡ç®—æœºã€‚</strong></p></li><li><p><strong>è¿›å…¥å¤‡ä»½æ–‡ä»¶æ‰€åœ¨ç›®å½•ã€‚</strong></p></li><li><p><strong>æ ¹æ®ä½ çš„éƒ¨ç½²æ–¹å¼é€‰æ‹©ä»¥ä¸‹å‘½ä»¤ä¹‹ä¸€è¿è¡Œè¿˜åŸå®¹å™¨ï¼š</strong></p><p><strong>a. ä½¿ç”¨ <code>docker-compose.yml</code> éƒ¨ç½²çš„ï¼š</strong></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --rm -it <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --mount <span style=color:#666;font-weight:700;font-style:italic>type</span>=volume,source=vaultwarden-data,target=/bitwarden/data/ <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  --mount <span style=color:#666;font-weight:700;font-style:italic>type</span>=bind,source=<span style=font-weight:700;text-decoration:underline>$(</span><span style=font-weight:700;font-style:italic>pwd</span><span style=font-weight:700;text-decoration:underline>)</span>,target=/bitwarden/restore/ <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  ttionya/vaultwarden-backup:latest restore <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  [OPTIONS]
</span></span></code></pre></div><ul><li><code>docker run --rm -it</code>ï¼šè¿è¡Œä¸€ä¸ªä¸´æ—¶çš„ã€äº¤äº’å¼çš„ Docker å®¹å™¨ã€‚</li><li><code>--mount type=volume,source=vaultwarden-data,target=/bitwarden/data/</code> æˆ– <code>--mount type=bind,source="æœ¬åœ°ç›®å½•çš„ç»å¯¹è·¯å¾„",target=/data/</code> æˆ– <code>--mount type=volume,source="Docker å·åç§°",target=/data/</code>ï¼šå°† vaultwarden çš„æ•°æ®ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ <code>/bitwarden/data</code> æˆ– <code>/data</code> ç›®å½•ã€‚</li><li><code>--mount type=bind,source=$(pwd),target=/bitwarden/restore/</code>ï¼šå°†å½“å‰ç›®å½•ï¼ˆå¤‡ä»½æ–‡ä»¶æ‰€åœ¨ç›®å½•ï¼‰æŒ‚è½½åˆ°å®¹å™¨çš„ <code>/bitwarden/restore</code> ç›®å½•ã€‚</li><li><code>-e DATA_DIR="/data"</code>ï¼šæŒ‡å®š vaultwarden çš„æ•°æ®ç›®å½•ï¼ˆå¦‚æœä½¿ç”¨â€œè‡ªåŠ¨å¤‡ä»½â€æ–¹å¼éƒ¨ç½²ï¼‰ã€‚</li><li><code>ttionya/vaultwarden-backup:latest restore</code>ï¼šæŒ‡å®šè¦è¿è¡Œçš„ Docker é•œåƒï¼Œå¹¶æ‰§è¡Œ <code>restore</code> å‘½ä»¤ã€‚</li><li><code>[OPTIONS]</code>ï¼šå¯é€‰å‚æ•°ï¼Œè§ä¸‹æ–‡â€œè¿˜åŸé€‰é¡¹â€ã€‚</li></ul></li></ol><h4 class=heading id=å››ç¯å¢ƒå˜é‡>å››ã€ç¯å¢ƒå˜é‡
<a class=anchor href=#%e5%9b%9b%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f>#</a></h4><p>æ‰€æœ‰ç¯å¢ƒå˜é‡éƒ½æœ‰é»˜è®¤å€¼ï¼Œå¯ä»¥åœ¨ä¸è®¾ç½®ä»»ä½•ç¯å¢ƒå˜é‡çš„æƒ…å†µä¸‹ä½¿ç”¨ Docker é•œåƒã€‚</p><h5 class=heading id=æ ¸å¿ƒé…ç½®>æ ¸å¿ƒé…ç½®
<a class=anchor href=#%e6%a0%b8%e5%bf%83%e9%85%8d%e7%bd%ae>#</a></h5><ul><li><strong><code>RCLONE_REMOTE_NAME</code></strong> (é»˜è®¤ï¼š<code>BitwardenBackup</code>)ï¼šRclone è¿œç¨‹åç§°ï¼Œå¿…é¡»ä¸ <code>rclone config</code> ä¸­è®¾ç½®çš„è¿œç¨‹åç§°ä¸€è‡´ã€‚</li><li><strong><code>RCLONE_REMOTE_DIR</code></strong> (é»˜è®¤ï¼š<code>/BitwardenBackup/</code>)ï¼šè¿œç¨‹å­˜å‚¨ç³»ç»Ÿä¸­å­˜æ”¾å¤‡ä»½æ–‡ä»¶çš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚</li><li><strong><code>RCLONE_GLOBAL_FLAG</code></strong> (é»˜è®¤ï¼š<code>''</code>)ï¼šRclone å…¨å±€å‚æ•°ï¼Œè¯¦è§ <a href=https://rclone.org/flags/>Rclone æ–‡æ¡£</a>ã€‚<strong>ä¸è¦æ·»åŠ ä¼šæ”¹å˜è¾“å‡ºçš„å…¨å±€å‚æ•°ï¼Œæ¯”å¦‚ <code>-P</code>ï¼Œå®ƒä¼šå½±å“åˆ é™¤è¿‡æœŸå¤‡ä»½æ–‡ä»¶çš„æ“ä½œã€‚</strong></li><li><strong><code>CRON</code></strong> (é»˜è®¤ï¼š<code>5 * * * *</code>)ï¼š<code>crond</code> çš„è§„åˆ™ï¼ŒåŸºäº <a href=https://github.com/aptible/supercronic><code>supercronic</code></a>ã€‚å¯ä»¥åœ¨ <a href=https://crontab.guru/#5_*_*_*_*>è¿™é‡Œ</a> è¿›è¡Œæµ‹è¯•ã€‚è§£é‡Šï¼šé»˜è®¤æ¯å°æ—¶çš„ 05 åˆ†è‡ªåŠ¨å¤‡ä»½ã€‚</li><li><strong><code>ZIP_ENABLE</code></strong> (é»˜è®¤ï¼š<code>TRUE</code>)ï¼šæ˜¯å¦å°†æ‰€æœ‰å¤‡ä»½æ–‡ä»¶æ‰“åŒ…ä¸ºå‹ç¼©æ–‡ä»¶ã€‚è®¾ç½®ä¸º <code>'FALSE'</code> æ—¶ï¼Œä¼šå•ç‹¬ä¸Šä¼ æ¯ä¸ªå¤‡ä»½æ–‡ä»¶ã€‚</li><li><strong><code>ZIP_PASSWORD</code></strong> (é»˜è®¤ï¼š<code>WHEREISMYPASSWORD?</code>)ï¼šå‹ç¼©æ–‡ä»¶çš„å¯†ç ã€‚</li><li><strong><code>ZIP_TYPE</code></strong> (é»˜è®¤ï¼š<code>zip</code>)ï¼šå‹ç¼©æ–‡ä»¶æ ¼å¼ï¼Œæ”¯æŒ <code>zip</code> å’Œ <code>7z</code>ã€‚</li><li><strong><code>BACKUP_KEEP_DAYS</code></strong> (é»˜è®¤ï¼š<code>0</code>)ï¼šåœ¨è¿œç¨‹å­˜å‚¨ç³»ç»Ÿä¸­ä¿ç•™æœ€è¿‘ X å¤©çš„å¤‡ä»½æ–‡ä»¶ã€‚è®¾ç½®ä¸º <code>0</code> ä¼šä¿ç•™æ‰€æœ‰å¤‡ä»½æ–‡ä»¶ã€‚</li><li><strong><code>BACKUP_FILE_SUFFIX</code></strong> (é»˜è®¤ï¼š<code>%Y%m%d</code>)ï¼šå¤‡ä»½æ–‡ä»¶åç¼€ï¼Œæ§åˆ¶å¤‡ä»½æ–‡ä»¶çš„å‘½åæ ¼å¼ã€‚å¯ä»¥åœ¨ <a href=https://man7.org/linux/man-pages/man1/date.1.html>è¿™é‡Œ</a> æŸ¥çœ‹æ—¶é—´æ ¼å¼åŒ–è¯´æ˜ã€‚</li><li><strong><code>TIMEZONE</code></strong> (é»˜è®¤ï¼š<code>UTC</code>)ï¼šè®¾ç½®æ—¶åŒºåç§°ï¼Œä¾‹å¦‚åŒ—äº¬æ—¶åŒºè®¾ç½®ä¸º <code>Asia/Shanghai</code>ã€‚å¯ä»¥åœ¨ <a href=https://en.wikipedia.org/wiki/List_of_tz_database_time_zones>ç»´åŸºç™¾ç§‘</a> æŸ¥çœ‹æ‰€æœ‰æ—¶åŒºåç§°ã€‚</li><li><strong><code>DATA_DIR</code></strong> (é»˜è®¤ï¼š<code>/bitwarden/data</code>)ï¼šæŒ‡å®šå­˜æ”¾ vaultwarden æ•°æ®çš„ç›®å½•ã€‚ä½¿ç”¨ <code>Docker Compose</code> æ—¶é€šå¸¸ä¸éœ€è¦ä¿®æ”¹ï¼Œä½¿ç”¨è‡ªåŠ¨å¤‡ä»½æ—¶é€šå¸¸éœ€è¦ä¿®æ”¹ä¸º <code>/data</code>ã€‚</li></ul><h5 class=heading id=é€šçŸ¥>é€šçŸ¥
<a class=anchor href=#%e9%80%9a%e7%9f%a5>#</a></h5><h6 class=heading id=1-mail>1. Mail
<a class=anchor href=#1-mail>#</a></h6><ul><li><strong><code>MAIL_SMTP_ENABLE</code></strong> (é»˜è®¤ï¼š<code>FALSE</code>)ï¼šå¯ç”¨é‚®ä»¶å‘é€åŠŸèƒ½ã€‚</li><li><strong><code>MAIL_SMTP_VARIABLES</code></strong> (é»˜è®¤ï¼šæ— )ï¼šé‚®ä»¶å‘é€å‚æ•°ï¼Œéœ€è¦è‡ªè¡Œé…ç½®ï¼Œè¯¦è§ä¸‹æ–¹ç¤ºä¾‹ã€‚</li><li><strong><code>MAIL_TO</code></strong> (é»˜è®¤ï¼šæ— )ï¼šæ¥æ”¶é‚®ä»¶çš„åœ°å€ã€‚</li><li><strong><code>MAIL_WHEN_SUCCESS</code></strong> (é»˜è®¤ï¼š<code>TRUE</code>)ï¼šå¤‡ä»½æˆåŠŸåå‘é€é‚®ä»¶ã€‚</li><li><strong><code>MAIL_WHEN_FAILURE</code></strong> (é»˜è®¤ï¼š<code>TRUE</code>)ï¼šå¤‡ä»½å¤±è´¥åå‘é€é‚®ä»¶ã€‚</li></ul><p><strong><code>MAIL_SMTP_VARIABLES</code> ç¤ºä¾‹ (ä»¥ Zoho ä¸ºä¾‹)ï¼š</strong></p><pre tabindex=0><code>-S smtp-use-starttls \
-S smtp=smtp://smtp.zoho.com:587 \
-S smtp-auth=login \
-S smtp-auth-user=&lt;your-email-address&gt; \
-S smtp-auth-password=&lt;your-email-password&gt; \
-S from=&lt;your-email-address&gt;
</code></pre><p><strong>é‚®ä»¶å‘é€æµ‹è¯•ï¼š</strong></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --rm -it -e <span style=color:#666;font-weight:700;font-style:italic>MAIL_SMTP_VARIABLES</span>=<span style=color:#666;font-style:italic>&#39;&lt;your smtp variables&gt;&#39;</span> ttionya/vaultwarden-backup:latest mail &lt;mail send to&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic># æˆ–</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>docker run --rm -it -e <span style=color:#666;font-weight:700;font-style:italic>MAIL_SMTP_VARIABLES</span>=<span style=color:#666;font-style:italic>&#39;&lt;your smtp variables&gt;&#39;</span> -e <span style=color:#666;font-weight:700;font-style:italic>MAIL_TO</span>=<span style=color:#666;font-style:italic>&#39;&lt;mail send to&gt;&#39;</span> ttionya/vaultwarden-backup:latest mail
</span></span></code></pre></div><h6 class=heading id=2-ping>2. Ping
<a class=anchor href=#2-ping>#</a></h6><ul><li><strong><code>PING_URL</code></strong>ï¼šå¤‡ä»½å®Œæˆåå‘é€è¯·æ±‚çš„åœ°å€ (æ— è®ºæˆåŠŸæˆ–å¤±è´¥)ã€‚</li><li><strong><code>PING_URL_CURL_OPTIONS</code></strong>ï¼šä¸ <code>PING_URL</code> æ­é…ä½¿ç”¨çš„ curl é€‰é¡¹ã€‚</li><li><strong><code>PING_URL_WHEN_START</code></strong>ï¼šå¤‡ä»½å¼€å§‹æ—¶å‘é€è¯·æ±‚çš„åœ°å€ã€‚</li><li><strong><code>PING_URL_WHEN_START_CURL_OPTIONS</code></strong>ï¼šä¸ <code>PING_URL_WHEN_START</code> æ­é…ä½¿ç”¨çš„ curl é€‰é¡¹ã€‚</li><li><strong><code>PING_URL_WHEN_SUCCESS</code></strong>ï¼šå¤‡ä»½æˆåŠŸåå‘é€è¯·æ±‚çš„åœ°å€ã€‚</li><li><strong><code>PING_URL_WHEN_SUCCESS_CURL_OPTIONS</code></strong>ï¼šä¸ <code>PING_URL_WHEN_SUCCESS</code> æ­é…ä½¿ç”¨çš„ curl é€‰é¡¹ã€‚</li><li><strong><code>PING_URL_WHEN_FAILURE</code></strong>ï¼šå¤‡ä»½å¤±è´¥åå‘é€è¯·æ±‚çš„åœ°å€ã€‚</li><li><strong><code>PING_URL_WHEN_FAILURE_CURL_OPTIONS</code></strong>ï¼šä¸ <code>PING_URL_WHEN_FAILURE</code> æ­é…ä½¿ç”¨çš„ curl é€‰é¡¹ã€‚</li></ul><p><strong>å ä½ç¬¦ï¼š</strong></p><ul><li><code>%{subject}</code>ï¼šæ›¿æ¢ä¸ºå®é™…çš„æ ‡é¢˜ã€‚</li><li><code>%{content}</code>ï¼šæ›¿æ¢ä¸ºå®é™…çš„å†…å®¹ã€‚</li></ul><p><strong>Ping å‘é€æµ‹è¯•ï¼š</strong></p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run --rm -it <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL</span>=<span style=color:#666;font-style:italic>&#39;&lt;your ping url&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_CURL_OPTIONS</span>=<span style=color:#666;font-style:italic>&#39;&lt;your curl options for PING_URL&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_START</span>=<span style=color:#666;font-style:italic>&#39;&lt;your ping url&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_START_CURL_OPTIONS</span>=<span style=color:#666;font-style:italic>&#39;&lt;your curl options for PING_URL_WHEN_START&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_SUCCESS</span>=<span style=color:#666;font-style:italic>&#39;&lt;your ping url&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_SUCCESS_CURL_OPTIONS</span>=<span style=color:#666;font-style:italic>&#39;&lt;your curl options for PING_URL_WHEN_SUCCESS&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_FAILURE</span>=<span style=color:#666;font-style:italic>&#39;&lt;your ping url&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  -e <span style=color:#666;font-weight:700;font-style:italic>PING_URL_WHEN_FAILURE_CURL_OPTIONS</span>=<span style=color:#666;font-style:italic>&#39;&lt;your curl options for PING_URL_WHEN_FAILURE&gt;&#39;</span> <span style=color:#666;font-style:italic>\
</span></span></span><span style=display:flex><span><span style=color:#666;font-style:italic></span>  ttionya/vaultwarden-backup:latest ping &lt;<span style=font-weight:700;font-style:italic>test</span> identifier&gt;
</span></span></code></pre></div><p><strong>è§£é‡Šï¼š</strong></p><ul><li><code>&lt;test identifier></code> å¯ä»¥æ˜¯ <code>completion</code>ã€<code>start</code>ã€<code>success</code> æˆ– <code>failure</code>ï¼Œå†³å®šä½¿ç”¨å“ªä¸€ç»„ç¯å¢ƒå˜é‡ã€‚</li></ul><h5 class=heading id=å…¶ä»–ç¯å¢ƒå˜é‡-é€šå¸¸æ— éœ€ä¿®æ”¹>å…¶ä»–ç¯å¢ƒå˜é‡ (é€šå¸¸æ— éœ€ä¿®æ”¹)
<a class=anchor href=#%e5%85%b6%e4%bb%96%e7%8e%af%e5%a2%83%e5%8f%98%e9%87%8f-%e9%80%9a%e5%b8%b8%e6%97%a0%e9%9c%80%e4%bf%ae%e6%94%b9>#</a></h5><ul><li><strong><code>BACKUP_FILE_DATE</code></strong> (é»˜è®¤ï¼š<code>%Y%m%d</code>)ï¼šå¤‡ä»½æ–‡ä»¶çš„æ—¶é—´å‰ç¼€ï¼Œå»ºè®®ä½¿ç”¨ <code>BACKUP_FILE_SUFFIX</code> æ›¿ä»£ã€‚</li><li><strong><code>BACKUP_FILE_DATE_SUFFIX</code></strong> (é»˜è®¤ï¼š<code>''</code>)ï¼šå¤‡ä»½æ–‡ä»¶çš„æ—¥æœŸåç¼€ï¼Œå»ºè®®ä½¿ç”¨ <code>BACKUP_FILE_SUFFIX</code> æ›¿ä»£ã€‚</li><li><strong><code>DATA_DB</code></strong> (é»˜è®¤ï¼š<code>${DATA_DIR}/db.sqlite3</code>)ï¼šæŒ‡å®š sqlite æ•°æ®åº“æ–‡ä»¶çš„è·¯å¾„ã€‚</li><li><strong><code>DATA_RSAKEY</code></strong> (é»˜è®¤ï¼š<code>${DATA_DIR}/rsa_key</code>)ï¼šæŒ‡å®š rsa_key æ–‡ä»¶çš„è·¯å¾„ã€‚</li><li><strong><code>DATA_ATTACHMENTS</code></strong> (é»˜è®¤ï¼š<code>${DATA_DIR}/attachments</code>)ï¼šæŒ‡å®š attachments æ–‡ä»¶å¤¹è·¯å¾„ã€‚</li><li><strong><code>DATA_SENDS</code></strong> (é»˜è®¤ï¼š<code>${DATA_DIR}/sends</code>)ï¼šæŒ‡å®š sends æ–‡ä»¶å¤¹è·¯å¾„ã€‚</li></ul><h1 class=heading id=äº”å®¢æˆ·ç«¯>äº”ã€å®¢æˆ·ç«¯
<a class=anchor href=#%e4%ba%94%e5%ae%a2%e6%88%b7%e7%ab%af>#</a></h1><p>Bitwarden æä¾›äº†å…¨å¹³å°çš„å®¢æˆ·ç«¯è½¯ä»¶ï¼Œä»¥ä¸‹æ˜¯å¸¸ç”¨çš„ä¸€äº›å¹³å°å®¢æˆ·ç«¯ï¼Œé™„ä¸Šäº†é“¾æ¥ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½</p><ul><li><a href=https://chrome.google.com/webstore/detail/bitwarden-free-password-m/nngceckbapebfimnlniiiahkandclblb title=Chrome>Chrome</a></li><li><a href=https://addons.mozilla.org/firefox/addon/bitwarden-password-manager/ title=FireFox>FireFox</a></li><li><a href=https://itunes.apple.com/app/bitwarden/id1352778147 title=Safari>Safari</a></li><li><a href="https://vault.bitwarden.com/download/?app=desktop&amp;platform=windows" title=Windows>Windows</a></li><li><a href=https://itunes.apple.com/app/bitwarden/id1352778147 title=MacOS>MacOS</a></li><li><a href="https://vault.bitwarden.com/download/?app=desktop&amp;platform=linux" title=Linux>Linux</a></li><li>iOSï¼šApp Store æœç´¢ BitWarden</li><li>Androidï¼š Google Play æœç´¢ BitWarden</li></ul><p>æœªåœ¨æ­¤åˆ—çš„å¹³å°ï¼Œå¯å‰å¾€å®˜ç½‘è¿›è¡Œä¸‹è½½ï¼š<a href=https://bitwarden.com/download>Download the Bitwarden Password Manager App for iPhone, Android, Chrome, Safari, and More | Bitwarden</a></p><h1 class=heading id=å…­ä½¿ç”¨æŠ€å·§>å…­ã€ä½¿ç”¨æŠ€å·§
<a class=anchor href=#%e5%85%ad%e4%bd%bf%e7%94%a8%e6%8a%80%e5%b7%a7>#</a></h1><h2 class=heading id=åŒ¹é…æ¨¡å¼>åŒ¹é…æ¨¡å¼
<a class=anchor href=#%e5%8c%b9%e9%85%8d%e6%a8%a1%e5%bc%8f>#</a></h2><p>bitwardenåŒ¹é…æ¨¡å¼ååˆ†é‡è¦ï¼Œå®ƒå†³å®šäº†ä½ çš„è´¦å·å¯†ç <strong>ä½•æ—¶è‡ªåŠ¨å¡«å……</strong>åˆ°ç½‘é¡µä¸­ï¼Œé»˜è®¤æ˜¯<code>åŸºç¡€åŸŸ</code>æ¨¡å¼ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚é€‚å½“è°ƒæ•´ã€‚å„ä¸ªåŒ¹é…æ¨¡å¼<a href=https://help.ppgg.in/auto-fill/using-uris#match-detection-options>æ‘˜å½•</a>å¦‚ä¸‹ï¼š</p><h4 class=heading id=åŸºç¡€åŸŸ>åŸºç¡€åŸŸ
<a class=anchor href=#%e5%9f%ba%e7%a1%80%e5%9f%9f>#</a></h4><p>é€‰æ‹©åŸºç¡€åŸŸï¼Œå½“ç™»å½•é¡¹ç›®çš„ URI å€¼çš„é¡¶çº§åŸŸåå’Œç¬¬äºŒçº§åä¸æ£€æµ‹åˆ°çš„èµ„æºç›¸åŒ¹é…æ—¶ï¼ŒBitwarden å°†å¼¹å‡ºæç¤ºä»¥æä¾›è‡ªåŠ¨å¡«å……ã€‚<br>ä¾‹å¦‚ï¼ŒURI çš„å€¼ä¸º<code>https://google.com</code>ï¼Œä½¿ç”¨åŸºç¡€åŸŸåŒ¹é…æ£€æµ‹ï¼š</p><div class=table-outer><table><thead><tr><th>URL</th><th>è‡ªåŠ¨å¡«å……ï¼Ÿ</th></tr></thead><tbody><tr><td><a href=http://google.com/>http://google.com</a></td><td>âœ”ï¸</td></tr><tr><td><a href=https://accounts.google.com/>https://accounts.google.com</a></td><td>âœ”ï¸</td></tr><tr><td><a href=https://google.net/>https://google.net</a></td><td>âœ˜</td></tr><tr><td><a href=http://yahoo.com/>http://yahoo.com</a></td><td>âœ˜</td></tr></tbody></table></div><h4 class=heading id=ä¸»æœº>ä¸»æœº
<a class=anchor href=#%e4%b8%bb%e6%9c%ba>#</a></h4><p>é€‰æ‹©ä¸»æœºï¼Œå½“ç™»å½•é¡¹ç›®çš„ URI å€¼çš„ä¸»æœºåå’Œç«¯å£ï¼ˆè‹¥æŒ‡å®šäº†ï¼‰ä¸æ£€æµ‹åˆ°çš„èµ„æºç›¸åŒ¹é…æ—¶ï¼ŒBitwarden å°†å¼¹å‡ºæç¤ºä»¥æä¾›è‡ªåŠ¨å¡«å……ã€‚<br>ä¾‹å¦‚ï¼ŒURI çš„å€¼ä¸º<code>https://sub.domain.com:4000</code>ï¼Œä½¿ç”¨ä¸»æœºåŒ¹é…æ£€æµ‹ï¼š</p><div class=table-outer><table><thead><tr><th>URL</th><th>è‡ªåŠ¨å¡«å……ï¼Ÿ</th></tr></thead><tbody><tr><td><a href=http://sub.domain.com:4000/>http://sub.domain.com:4000</a></td><td>âœ”ï¸</td></tr><tr><td><a href=https://sub.domain.com:4000/page.html>https://sub.domain.com:4000/page.html</a></td><td>âœ”ï¸</td></tr><tr><td><a href=https://domain.com/>https://domain.com</a></td><td>âœ˜</td></tr><tr><td><a href=https://sub.domain.com/>https://sub.domain.com</a></td><td>âœ˜</td></tr><tr><td><a href=https://sub2.sub.domain.com:4000/>https://sub2.sub.domain.com:4000</a></td><td>âœ˜</td></tr><tr><td><a href=https://sub.domain.com:5000/>https://sub.domain.com:5000</a></td><td>âœ˜</td></tr></tbody></table></div><h4 class=heading id=å¼€å§‹äº>å¼€å§‹äº
<a class=anchor href=#%e5%bc%80%e5%a7%8b%e4%ba%8e>#</a></h4><p>é€‰æ‹©å¼€å§‹äºï¼Œå½“æ£€æµ‹åˆ°çš„èµ„æºä»¥ç™»å½•é¡¹ç›®çš„ URI å€¼å¼€å¤´ï¼ˆæ— è®ºåé¢è·Ÿä»€ä¹ˆï¼‰æ—¶ï¼ŒBitwarden å°†å¼¹å‡ºæç¤ºä»¥æä¾›è‡ªåŠ¨å¡«å……ã€‚<br>ä¾‹å¦‚ï¼ŒURI çš„å€¼ä¸º<code>https://sub.domain.com/path/</code>ï¼Œä½¿ç”¨å¼€å§‹äºåŒ¹é…æ£€æµ‹ï¼š</p><div class=table-outer><table><thead><tr><th>URL</th><th>è‡ªåŠ¨å¡«å……ï¼Ÿ</th></tr></thead><tbody><tr><td><a href=https://sub.domain.com/path/>https://sub.domain.com/path/</a></td><td>âœ”ï¸</td></tr><tr><td><a href=https://sub.domain.com/path/page.html>https://sub.domain.com/path/page.html</a></td><td>âœ”ï¸</td></tr><tr><td><a href=https://sub.domain.com/>https://sub.domain.com</a></td><td>âœ˜</td></tr><tr><td><a href=https://sub.domain.com:4000/path/page.html%EF%BC%88%E8%A2%AB%E7%AB%AF%E5%8F%A3%E9%98%BB%E6%96%AD%E4%BA%86%EF%BC%89>https://sub.domain.com:4000/path/page.htmlï¼ˆè¢«ç«¯å£é˜»æ–­äº†ï¼‰</a></td><td>âœ˜</td></tr><tr><td><a href=https://sub.domain.com/path%EF%BC%88%E7%BC%BA%E5%B0%91%E6%96%9C%E6%9D%A0%EF%BC%89>https://sub.domain.com/pathï¼ˆç¼ºå°‘æ–œæ ï¼‰</a></td><td>âœ˜</td></tr></tbody></table></div><h4 class=heading id=æ­£åˆ™è¡¨è¾¾å¼>æ­£åˆ™è¡¨è¾¾å¼
<a class=anchor href=#%e6%ad%a3%e5%88%99%e8%a1%a8%e8%be%be%e5%bc%8f>#</a></h4><p>é€‰æ‹©æ­£åˆ™è¡¨è¾¾å¼ï¼Œå½“æ£€æµ‹åˆ°çš„èµ„æºä¸ä¸€ä¸ªæŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…æ—¶ï¼ŒBitwarden å°†å¼¹å‡ºæç¤ºä»¥æä¾›è‡ªåŠ¨å¡«å……ã€‚æ­£åˆ™è¡¨è¾¾å¼å§‹ç»ˆä¸åŒºåˆ†å¤§å°å†™ã€‚</p><h5 class=heading id=ä¸å®‰å…¨ç¤ºä¾‹>ä¸å®‰å…¨ç¤ºä¾‹
<a class=anchor href=#%e4%b8%8d%e5%ae%89%e5%85%a8%e7%a4%ba%e4%be%8b>#</a></h5><p>URI çš„å€¼ä¸º<code>^https://.*google\.com$</code>ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ£€æµ‹ï¼š</p><div class=table-outer><table><thead><tr><th>URL</th><th>è‡ªåŠ¨å¡«å……ï¼Ÿ</th></tr></thead><tbody><tr><td><a href=https://google.com/>https://google.com</a></td><td>âœ”ï¸</td></tr><tr><td><a href=https://sub.google.com/>https://sub.google.com</a></td><td>âœ”ï¸</td></tr><tr><td><a href="https://malicious-site.com/?q=google.com">https://malicious-site.com?q=google.com</a></td><td>âœ”ï¸</td></tr><tr><td><a href=http://google.com/>http://google.com</a></td><td>âœ˜</td></tr><tr><td><a href=https://yahoo.com/>https://yahoo.com</a></td><td>âœ˜</td></tr></tbody></table></div><p>è¿™å¯èƒ½æ¯”é¢„æœŸçš„è¦åŒ¹é…å¾—æ›´å¤šã€‚</p><h5 class=heading id=å®‰å…¨ç¤ºä¾‹>å®‰å…¨ç¤ºä¾‹
<a class=anchor href=#%e5%ae%89%e5%85%a8%e7%a4%ba%e4%be%8b>#</a></h5><p>URI çš„å€¼ä¸º<code>^https://[a-z]+\.wikipedia\.org/w/index\.php</code>ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ£€æµ‹ï¼š</p><div class=table-outer><table><thead><tr><th>URL</th><th>è‡ªåŠ¨å¡«å……ï¼Ÿ</th></tr></thead><tbody><tr><td><a href="https://en.wikipedia.org/w/index.php?title=Special:UserLogin&amp;returnto=Bitwarden">https://en.wikipedia.org/w/index.php?title=Special:UserLogin&amp;returnto=Bitwarden</a></td><td>âœ”ï¸</td></tr><tr><td><a href="https://pl.wikipedia.org/w/index.php?title=Specjalna:Zaloguj&amp;returnto=Bitwarden">https://pl.wikipedia.org/w/index.php?title=Specjalna:Zaloguj&amp;returnto=Bitwarden</a></td><td>âœ”ï¸</td></tr><tr><td><a href=https://en.wikipedia.org/w/index.php>https://en.wikipedia.org/w/index.php</a></td><td>âœ”ï¸</td></tr><tr><td><a href=https://malicious-site.com/>https://malicious-site.com</a></td><td>âœ˜</td></tr><tr><td><a href=https://en.wikipedia.org/wiki/Bitwarden>https://en.wikipedia.org/wiki/Bitwarden</a></td><td>âœ˜</td></tr></tbody></table></div><h4 class=heading id=ç²¾ç¡®>ç²¾ç¡®
<a class=anchor href=#%e7%b2%be%e7%a1%ae>#</a></h4><p>é€‰æ‹©ç²¾ç¡®ï¼Œå½“ç™»å½•é¡¹ç›®çš„ URI å€¼ä¸æ£€æµ‹åˆ°çš„èµ„æºç²¾ç¡®åŒ¹é…æ—¶ï¼ŒBitwarden å°†å¼¹å‡ºæç¤ºä»¥æä¾›è‡ªåŠ¨å¡«å……ã€‚<br>ä¾‹å¦‚ï¼ŒURI çš„å€¼ä¸º<code>https://www.google.com/page.html</code>ï¼Œä½¿ç”¨ç²¾ç¡®åŒ¹é…æ£€æµ‹ï¼š</p><div class=table-outer><table><thead><tr><th>URL</th><th>è‡ªåŠ¨å¡«å……ï¼Ÿ</th></tr></thead><tbody><tr><td><a href=https://www.google.com/page.html>https://www.google.com/page.html</a></td><td>âœ”ï¸</td></tr><tr><td><a href=http://www.google.com/page.html>http://www.google.com/page.html</a></td><td>âœ˜</td></tr><tr><td><a href="https://www.google.com/page.html?query=123">https://www.google.com/page.html?query=123</a></td><td>âœ˜</td></tr><tr><td><a href=https://www.google.com/>https://www.google.com</a></td><td>âœ˜</td></tr></tbody></table></div><h4 class=heading id=ä»ä¸>ä»ä¸
<a class=anchor href=#%e4%bb%8e%e4%b8%8d>#</a></h4><p>é€‰æ‹©ä»ä¸ï¼ŒBitwarden å°†<strong>ä»ä¸</strong>ä¸ºç™»å½•é¡¹ç›®å¼¹å‡ºä»¥æä¾›è‡ªåŠ¨å¡«å……ã€‚</p><hr><p>å¸®åŠ©æ–‡æ¡£:</p><ul><li><a href=https://rs.ppgg.in/>å…³äº | Vaultwarden Wiki ä¸­æ–‡ç‰ˆ</a></li><li><a href=https://help.ppgg.in/>å…³äº | Bitwarden å¸®åŠ©ä¸­å¿ƒä¸­æ–‡ç‰ˆ</a></li></ul></div></article><div class=single-comments><script src=https://giscus.app/client.js data-repo=eaiu/eaiu.github.io data-repo-id=R_kgDOPMv-Yw data-category data-category-id=DIC_kwDOPMv-Y84CtAeO data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=en data-loading=lazy crossorigin=anonymous async></script></div><div class=single-pagination><hr><div class=flexnowrap><div class=single-pagination-prev><div class=single-pagination-container-prev><div class=single-pagination-text>â†</div><div class=single-pagination-text><a href=/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/%E5%9F%9F%E5%90%8D%E7%9B%B8%E5%85%B3/>åŸŸåç®¡ç†ï¼šCloudflare DNSæ‰˜ç®¡ä¸SSLè¯ä¹¦é…ç½®</a></div></div></div><div class=single-pagination-next></div></div><hr></div><div class=back-to-top><a href=#top>back to top</a></div></div></main></div><footer><p>All content licensed under <a href=https://creativecommons.org/licenses/by-sa/4.0/>CC BY-SA 4.0</a> unless otherwise stated. Copyright Â© 2025 ghung<br>Powered by <a href=https://gohugo.io/>Hugo</a> and <a href=https://github.com/tomfran/typo>tomfran/typo</a></p></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></body><script src=/js/theme-switch.js></script><script defer src=/js/copy-code.js></script></html>