<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on G-Hung的博客</title><link>https://blog.yzyy.de/post/</link><description>Recent content in Posts on G-Hung的博客</description><generator>Hugo</generator><language>zh-cn</language><lastBuildDate>Thu, 17 Jul 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://blog.yzyy.de/post/index.xml" rel="self" type="application/rss+xml"/><item><title>新购一台8GB的VDS与搬家</title><link>https://blog.yzyy.de/post/%E6%96%B0%E8%B4%AD%E4%B8%80%E5%8F%B08gb%E7%9A%84vds/</link><pubDate>Thu, 17 Jul 2025 00:00:00 +0000</pubDate><guid>https://blog.yzyy.de/post/%E6%96%B0%E8%B4%AD%E4%B8%80%E5%8F%B08gb%E7%9A%84vds/</guid><description>&lt;p>在7月8日，人称“小阿里”的云服务器提供商「ClawCloud」宣布下线支持中国优化线路的香港服务器。这个公告中还提到了三个赔偿方案，其中两个为不同的退款方案，这里重点关注方案二：可以免费迁移到新加坡或日本节点，并且**原本机器的内存容量还会直接翻倍。&lt;/p>
&lt;p>这就导致了市场上出现了2核8GB的线路良好的新加坡\日本机器，并且价格为4$/m，有没有很心动，我反正是心动了。&lt;/p>
&lt;p>回想起那夜远程开发使用claude code内存爆炸，狼狈重启。那夜为了安装OpenWebUI，一口气开了2g的swap。畏畏缩缩不敢使用动态博客、不敢使用1panel等运维面板。怕了真怕了，😭狼狈的我含泪溢价一百块收下一台机器，只希望能用的长久吧。&lt;/p>
&lt;p>以下记录一下我拿到一台新机器会做什么以及迁移过程。&lt;/p>
&lt;hr>
&lt;h2 class="heading" id="安全">
 安全
 &lt;a class="anchor" href="#%e5%ae%89%e5%85%a8">#&lt;/a>
&lt;/h2>
&lt;p>最重要的当然是安全，之前已经给出了服务器的安全论，请看&lt;a href="https://blog.yzyy.de/explore/%E6%9C%8D%E5%8A%A1%E5%99%A8/vps%E5%9F%BA%E6%9C%AC%E5%AE%89%E5%85%A8%E6%8E%AA%E6%96%BD/">VPS基础安全配置实践指南&lt;/a>。&lt;/p>
&lt;h2 class="heading" id="安装docker">
 安装docker
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85docker">#&lt;/a>
&lt;/h2>
&lt;p>因为多数服务是运行在docker上的，安装docker &amp;amp; docker compose是必不可少的。&lt;/p>
&lt;h2 class="heading" id="ssl证书">
 SSL证书
 &lt;a class="anchor" href="#ssl%e8%af%81%e4%b9%a6">#&lt;/a>
&lt;/h2>
&lt;p>不是简单地迁移已有证书就行了，还要迁移配置好的自动续签服务，经过查看在一台机器上有四个域名的自动续签服务，但是我准备瘦身一下，有些域名快到期了。












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/certificates.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;h3 class="heading" id="自动续签改进后的方案">
 自动续签改进后的方案
 &lt;a class="anchor" href="#%e8%87%aa%e5%8a%a8%e7%bb%ad%e7%ad%be%e6%94%b9%e8%bf%9b%e5%90%8e%e7%9a%84%e6%96%b9%e6%a1%88">#&lt;/a>
&lt;/h3>
&lt;p>发现之前的多个域名的自动续签管理十分繁琐，与AI交流后获得了一个更为简洁的可行的方案，简化了操作与配置。&lt;/p>
&lt;h4 class="heading" id="cloudflare-api">
 Cloudflare API
 &lt;a class="anchor" href="#cloudflare-api">#&lt;/a>
&lt;/h4>
&lt;p>使用 Cloudflare DNS 模式需要准备:&lt;/p>
&lt;ul>
&lt;li>Account ID&lt;/li>
&lt;li>API Token&lt;/li>
&lt;/ul>
&lt;h5 class="heading" id="获取-account-id">
 获取 Account ID
 &lt;a class="anchor" href="#%e8%8e%b7%e5%8f%96-account-id">#&lt;/a>
&lt;/h5>
&lt;p>这两种 ID 直接在 Overview 页就能找到。&lt;/p>
&lt;p>











&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="cloudflare_account_id" src="https://webp.050612.xyz/2025/07/cloudflare_account_id.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;h5 class="heading" id="获取-api-token">
 获取 API Token
 &lt;a class="anchor" href="#%e8%8e%b7%e5%8f%96-api-token">#&lt;/a>
&lt;/h5>
&lt;p>Overview 页点击 &lt;code>获取您的 API 令牌&lt;/code> 进入 API Tokens 页。&lt;/p>
&lt;p>点击 API Tokens 项旁边 &lt;code>创建令牌&lt;/code> 按钮，接着选择 &lt;code>编辑区域 DNS&lt;/code> 的模板，点击 &lt;code>使用模板&lt;/code>。&lt;/p>
&lt;p>











&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="image" src="https://webp.050612.xyz/2025/02/e15d8a0a1de821faab5355e610b581016975b974_2_690x265.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;p>











&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="image" src="https://webp.050612.xyz/2025/02/42f87595d27a6fb3ed1fe329934517f5416920c6_2_690x210.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;p>&lt;code>区域资源&lt;/code> 里选择需要签发的域名，多个域名选择多个。不建议选择全部的域名，**最小权限原则。&lt;/p>
&lt;p>在 &lt;code>客户端 IP 地址筛选&lt;/code> 里建议写下 acme.sh 所在的主机做为白名单，需要注意，如果服务器有 ipv6 地址，则也需要添加，因为有可能会 ipv6 优先访问。&lt;/p>
&lt;p>击 &lt;code>继续以显示摘要&lt;/code> , 确认没问题后最后点击 &lt;code>创建令牌&lt;/code>。&lt;/p>
&lt;p>











&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="image" src="https://webp.050612.xyz/2025/02/e88966d6049c27c31c632f9471ec1b79be287b59_2_510x499.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;p>此时就会出现一个 Token,，即 CF_Token，拷贝备用。&lt;/p>
&lt;p>











&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="image" src="https://webp.050612.xyz/2025/02/ca6093ea6bf83325809ea6179d4239ae2c9818cc_2_690x404.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;h5 class="heading" id="注意">
 注意
 &lt;a class="anchor" href="#%e6%b3%a8%e6%84%8f">#&lt;/a>
&lt;/h5>
&lt;ul>
&lt;li>&lt;strong>注意新增域名时，需要更改API Token所包含的域名&lt;/strong>&lt;/li>
&lt;li>&lt;strong>注意有多台机器时，需要新增机器的IP到白名单&lt;/strong>。&lt;/li>
&lt;/ul>
&lt;p>











&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="update_cf_api_token" src="https://webp.050612.xyz/2025/02/update_cf_api_token.png" >
 &lt;/div>

 
&lt;/figure>













&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="cf-api-token-ip" src="https://webp.050612.xyz/2025/02/cf-api-token-ip.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;h4 class="heading" id="一个完整的演示">
 一个完整的演示
 &lt;a class="anchor" href="#%e4%b8%80%e4%b8%aa%e5%ae%8c%e6%95%b4%e7%9a%84%e6%bc%94%e7%a4%ba">#&lt;/a>
&lt;/h4>
&lt;p>获取到了以上两个token即可开始操作。&lt;/p>
&lt;p>为了使整个流程更加清晰（&lt;del>方便自己操作&lt;/del>），这里贴一个自己平时使用 acme.sh 申请证书的完整流程。&lt;/p>
&lt;ul>
&lt;li>申请方式：DNS 认证（使用 Cloudflare API）&lt;/li>
&lt;li>申请证书 CA：Let’s Encrypt&lt;/li>
&lt;li>申请证书类型：RSA + ECC 两个通配符证书&lt;/li>
&lt;/ul>
&lt;p>后续申请证书的命令，都是在 root 用户下执行的，请先使用 &lt;code>su&lt;/code> 切换到 root 用户。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-shell" data-lang="shell">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 进入root用户&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>su
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 安装 acme.sh&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>curl https://get.acme.sh | sh
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 刷新 shell 变量配置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="font-weight:bold;font-style:italic">source&lt;/span> ~/.bashrc
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 导入 Cloudflare API Token&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="font-weight:bold;font-style:italic">export&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">CF_Token&lt;/span>=&lt;span style="color:#666;font-style:italic">&amp;#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="font-weight:bold;font-style:italic">export&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">CF_Account_ID&lt;/span>=&lt;span style="color:#666;font-style:italic">&amp;#34;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 设置默认 CA 为 Let&amp;#39;s Encrypt&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --set-default-ca --server letsencrypt
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 签发 RSA 证书&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --issue --dns dns_cf -d xxx.xyz -d *.xxx.xyz --keylength 2048
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 安装 RSA 证书到指定路径&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --install-cert -d domain.tld &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--key-file /path/to/ssl/domain.tld_private.key &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--fullchain-file /path/to/ssl/domain.tld_chain.pem &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--reloadcmd &lt;span style="color:#666;font-style:italic">&amp;#34;service nginx reload&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 签发 ECC 证书，若不需要，跳过即可&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --issue --dns dns_cf -d domain.tld -d *.domain.tld --keylength ec-256
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 安装 ECC 证书到指定路径&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --install-cert -d domain.tld --ecc &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--key-file /path/to/ssl/ecc_domain.tld_private.key &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--fullchain-file /path/to/ssl/ecc_domain.tld_chain.pem &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--capath /path/to/ssl/ecc_domain.tld_ca.pem &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--reloadcmd &lt;span style="color:#666;font-style:italic">&amp;#34;service nginx reload&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 至此证书安装完毕&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 下面是同一台主机申请第二个域名证书&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">###############################第二个域名#####################################################################&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 签发 RSA 证书&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --issue --dns dns_cf -d xxx.xyz -d *.xxx.xyz --keylength 2048
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 安装 RSA 证书到指定路径&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --config-home /root/.acme2 &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--install-cert -d domain.tld &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--key-file /path/to/ssl/domain.tld_private.key &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--fullchain-file /path/to/ssl/domain.tld_chain.pem &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--reloadcmd &lt;span style="color:#666;font-style:italic">&amp;#34;service nginx reload&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 签发 ECC 证书，若不需要，跳过即可&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --config-home /root/.acme2 --issue --dns dns_cf -d domain.tld -d *.domain.tld --keylength ec-256
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 安装 ECC 证书到指定路径&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>acme.sh --config-home /root/.acme2 &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--install-cert -d domain.tld --ecc &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--key-file /path/to/ssl/ecc_domain.tld_private.key &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--fullchain-file /path/to/ssl/ecc_domain.tld_chain.pem &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--capath /path/to/ssl/ecc_domain.tld_ca.pem &lt;span style="color:#666;font-style:italic">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#666;font-style:italic">&lt;/span>--reloadcmd &lt;span style="color:#666;font-style:italic">&amp;#34;service nginx reload&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>检查cron定时任务是否已经成功创建&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>crontab -l
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果有两个以上的域名或者新增域名，
只需要：&lt;/p>
&lt;ol>
&lt;li>在Cloudflare的「API Token」管理中，新增API Token所包含的域名&lt;/li>
&lt;li>签发新域名的证书并安装到指定位置&lt;/li>
&lt;/ol>
&lt;p>acme.sh会检查所管理的所有域名的证书的到期时间，如果需要续签，则会执行续签操作并安装导致订位置，实现证书的自动续签。一劳永逸的操作。&lt;/p>
&lt;h2 class="heading" id="迁移服务">
 迁移服务
 &lt;a class="anchor" href="#%e8%bf%81%e7%a7%bb%e6%9c%8d%e5%8a%a1">#&lt;/a>
&lt;/h2>
&lt;p>到了最复杂的一个环节了，即使运行在docker的服务，每个也要迁移volumes、nginx配置，开干！💪正好凑这个机会统计一下我运行了哪些服务。&lt;/p>
&lt;h3 class="heading" id="openwebui--newapi">
 OpenWebUI + NewAPI
 &lt;a class="anchor" href="#openwebui--newapi">#&lt;/a>
&lt;/h3>
&lt;ol>
&lt;li>打包持久化数据，其中NewAPI的MySQL使用了Docker的命名卷&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">######## 打包OpenWebUI和NewAPI的持久化数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tar -czvf data.tar.gz ./openwebui ./newapi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">######## 打包newapi MySQL数据卷 ###########&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 查找卷的物理路径&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>docker volume inspect [项目名]_mysql_data
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 在输出中找到 &amp;#34;Mountpoint&amp;#34;: &amp;#34;/var/lib/docker/volumes/[项目名]_mysql_data/_data&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo tar -czvf ~/mysql_volume.tar.gz /var/lib/docker/volumes/[项目名]_mysql_data/_data
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>使用SFTP功能传输到新机器&lt;/li>
&lt;li>在新机器上解压&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-BASH" data-lang="BASH">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">######## 解压OpenWebUI和NewAPI的持久化数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo tar -xzvf data.tar.gz -C ./
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">######## 解压newapi MySQL数据卷 ###########&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 手动创建目录&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo mkdir -p /var/lib/docker/volumes/[项目名]_mysql_data/_data
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 解压文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo tar -xzvf ~/mysql_volume.tar.gz -C /var/lib/docker/volumes/[项目名]_mysql_data/_data
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 修复文件权限&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo chown -R 999:999 /var/lib/docker/volumes/[项目名]_mysql_data/_data
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>配置nginx&lt;/li>
&lt;/ol>
&lt;p>直接把旧机器上的nginx打包上传到新机上，操作只需要建立site-available与site-enable的软连接&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo ln -s /etc/nginx/sites-available/api.vtofun.me /etc/nginx/sites-enabled/api.vtofun.me
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>绷不住了，第一次搬家十分乃至万分不顺利，从七点搬到十一点半还没搬完。搬家太累了😭&lt;/p>&lt;/blockquote>
&lt;h3 class="heading" id="openlist">
 OpenList
 &lt;a class="anchor" href="#openlist">#&lt;/a>
&lt;/h3>
&lt;p>想到前段时间的alist的暴雷商业化，我还是把镜像换成OpenList吧。&lt;/p>
&lt;ol>
&lt;li>docker镜像变更&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span>version: &lt;span style="color:#666;font-style:italic">&amp;#39;3.3&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>services:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> alist:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> image: &lt;span style="color:#666;font-style:italic">&amp;#39;openlistteam/openlist:latest&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> container_name: alist
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> volumes:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#666;font-style:italic">&amp;#39;./data:/opt/alist/data&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ports:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#666;font-style:italic">&amp;#39;127.0.0.1:1259:5244&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> environment:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - PUID=0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - PGID=0
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - UMASK=022
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> restart: unless-stopped
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>配置nginx&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo ln -s /etc/nginx/sites-available/api.vtofun.me /etc/nginx/sites-enabled/api.vtofun.me
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>注意打开admin用户的webdav的读权限。&lt;/li>
&lt;/ol>
&lt;h3 class="heading" id="sub-store">
 sub-store
 &lt;a class="anchor" href="#sub-store">#&lt;/a>
&lt;/h3>
&lt;p>很好用的代理配置管理软件&lt;/p>
&lt;ol>
&lt;li>nginx&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo ln -s /etc/nginx/sites-available/substore /etc/nginx/sites-enabled/substore
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl restart nginx.service 
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 class="heading" id="gemini-balance">
 Gemini-balance
 &lt;a class="anchor" href="#gemini-balance">#&lt;/a>
&lt;/h3>
&lt;p>一个很好用的gemini代理服务，支持多KEY，失败重试等。&lt;/p>
&lt;p>由于之前服务器为香港，而AI服务一般都不支持中国大陆以及香港，所以之前gemini-balance服务部署在一个小机器上。正好趁着这次搬家搬到一起。&lt;/p>
&lt;ul>
&lt;li>docker-compose.yml文件，通过.env使用和New-API同一个MySQL，避免起两个MySQL服务，造成资源浪费。&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># Gemini代理池&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> gemini-balance:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> image: ghcr.io/snailyp/gemini-balance:latest
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> container_name: gemini-balance
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> restart: unless-stopped
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ports:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - &lt;span style="color:#666;font-style:italic">&amp;#34;127.0.0.1:1260:8000&amp;#34;&lt;/span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> env_file:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - .env &lt;span style="color:#888;font-style:italic"># 同样使用 .env 文件管理配置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> networks:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - app_network &lt;span style="color:#888;font-style:italic"># 加入统一网络&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> depends_on:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> mysql:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> condition: service_healthy &lt;span style="color:#888;font-style:italic"># 依赖于我们统一的 mysql 服务&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> healthcheck:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> test: [&lt;span style="color:#666;font-style:italic">&amp;#34;CMD-SHELL&amp;#34;&lt;/span>, &lt;span style="color:#666;font-style:italic">&amp;#34;python -c \&amp;#34;import requests; exit(0) if requests.get(&amp;#39;http://localhost:8000/health&amp;#39;).status_code == 200 else exit(1)\&amp;#34;&amp;#34;&lt;/span>]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> interval: 30s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> timeout: 5s
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> retries: 3
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> start_period: 10s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>nginx配置文件没有什么特殊的，反代一下即可。&lt;/p>
&lt;h3 class="heading" id="pdfmathtranslate">
 PDFMathTranslate
 &lt;a class="anchor" href="#pdfmathtranslate">#&lt;/a>
&lt;/h3>
&lt;p>一个基于 AI 完整保留排版的 PDF 文档全文双语翻译，支持 Google/DeepL/Ollama/OpenAI 等服务。&lt;/p>
&lt;h2 class="heading" id="安装新服务">
 安装新服务
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85%e6%96%b0%e6%9c%8d%e5%8a%a1">#&lt;/a>
&lt;/h2>
&lt;h3 class="heading" id="1panel">
 1Panel
 &lt;a class="anchor" href="#1panel">#&lt;/a>
&lt;/h3>
&lt;p>一键安装的命令：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>bash -c &lt;span style="color:#666;font-style:italic">&amp;#34;&lt;/span>&lt;span style="font-weight:bold;text-decoration:underline">$(&lt;/span>curl -sSL https://resource.fit2cloud.com/1panel/package/v2/quick_start.sh&lt;span style="font-weight:bold;text-decoration:underline">)&lt;/span>&lt;span style="color:#666;font-style:italic">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>











&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/20250718151202885.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;blockquote>
&lt;p>2025-07-18日更新
1panel 面板bug好多，使用nginx反代面板本身实现https访问，一直卡在loading。不知是不是我操作有问题。&lt;/p>&lt;/blockquote>
&lt;p>似乎遇见问题的情况有很多。












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/20250718161106071.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;h4 class="heading" id="问题定位">
 问题定位
 &lt;a class="anchor" href="#%e9%97%ae%e9%a2%98%e5%ae%9a%e4%bd%8d">#&lt;/a>
&lt;/h4>
&lt;p>目前使用ip:port方式可以正常访问，使用域名无法访问，可以初步判断为nginx反代的配置问题。&lt;/p>
&lt;h4 class="heading" id="问题解决">
 问题解决
 &lt;a class="anchor" href="#%e9%97%ae%e9%a2%98%e8%a7%a3%e5%86%b3">#&lt;/a>
&lt;/h4>
&lt;p>贴上一份可以正常工作的nginx配置：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="font-weight:bold;text-decoration:underline">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">listen&lt;/span> 80;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">server_name&lt;/span> &lt;span style="color:#666;font-style:italic">xxx&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">return&lt;/span> 301 &lt;span style="color:#666;font-style:italic">https://&lt;/span>&lt;span style="color:#666;font-weight:bold;font-style:italic">$server_name$request_uri&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="font-weight:bold;text-decoration:underline">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">listen&lt;/span> 443 &lt;span style="color:#666;font-style:italic">ssl&lt;/span> &lt;span style="color:#666;font-style:italic">http2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">server_name&lt;/span> &lt;span style="color:#666;font-style:italic">xxx&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_certificate&lt;/span> &lt;span style="color:#666;font-style:italic">/etc/ssl/certs/xxx&lt;/span>; 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_certificate_key&lt;/span> &lt;span style="color:#666;font-style:italic">/etc/ssl/private/xxx&lt;/span>; 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_session_timeout&lt;/span> &lt;span style="color:#666;font-style:italic">1d&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_session_cache&lt;/span> &lt;span style="color:#666;font-style:italic">shared:MozSSL:10m&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_ciphers&lt;/span> &lt;span style="color:#666;font-style:italic">ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_prefer_server_ciphers&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">off&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_protocols&lt;/span> &lt;span style="color:#666;font-style:italic">TLSv1.1&lt;/span> &lt;span style="color:#666;font-style:italic">TLSv1.2&lt;/span> &lt;span style="color:#666;font-style:italic">TLSv1.3&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">add_header&lt;/span> &lt;span style="color:#666;font-style:italic">Strict-Transport-Security&lt;/span> &lt;span style="color:#666;font-style:italic">&amp;#34;max-age=63072000&amp;#34;&lt;/span> &lt;span style="color:#666;font-style:italic">always&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">client_max_body_size&lt;/span> 500m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">location&lt;/span> &lt;span style="color:#666;font-style:italic">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_pass&lt;/span> &lt;span style="color:#666;font-style:italic">http://xxxx:1255&lt;/span>; &lt;span style="color:#888;font-style:italic"># xxx替换为内部访问地址
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_http_version&lt;/span> 1&lt;span style="color:#666;font-style:italic">.1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># WebSocket 代理所需的头，1Panel 可能用到
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">Upgrade&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$http_upgrade&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">Connection&lt;/span> &lt;span style="color:#666;font-style:italic">&amp;#34;upgrade&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># 重要的转发头
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">Host&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$host&lt;/span>; &lt;span style="color:#888;font-style:italic"># 传递原始请求的 Host 头
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">X-Real-IP&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$remote_addr&lt;/span>; &lt;span style="color:#888;font-style:italic"># 传递真实客户端IP
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">X-Forwarded-For&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$proxy_add_x_forwarded_for&lt;/span>; &lt;span style="color:#888;font-style:italic"># 传递完整的IP链
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># *** 传递原始请求协议，解决混合内容问题 ***
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">X-Forwarded-Proto&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$scheme&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># 推荐：如果遇到大文件上传或下载问题，可以尝试关闭 buffering
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="color:#888;font-style:italic"># proxy_buffering off;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="color:#888;font-style:italic"># proxy_request_buffering off;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 class="heading" id="后记">
 后记
 &lt;a class="anchor" href="#%e5%90%8e%e8%ae%b0">#&lt;/a>
&lt;/h4>
&lt;p>在安装1panel之前没有使用过其他运维面板，也不是专业的运维人员，不过有一个GUI总归是好事。可是装上了之后，发现能用上的功能寥寥无几。&lt;/p>
&lt;p>来看看1panel官网介绍：&lt;/p>
&lt;blockquote>
&lt;p>1Panel 作为一款现代化、开源的 Linux 服务器运维管理面板，其功能涵盖了服务器管理的方方面面，并特别强调了易用性和对新技术的支持。&lt;/p>&lt;/blockquote>
&lt;h5 class="heading" id="核心服务器管理-高效管理">
 核心服务器管理 (高效管理)
 &lt;a class="anchor" href="#%e6%a0%b8%e5%bf%83%e6%9c%8d%e5%8a%a1%e5%99%a8%e7%ae%a1%e7%90%86-%e9%ab%98%e6%95%88%e7%ae%a1%e7%90%86">#&lt;/a>
&lt;/h5>
&lt;blockquote>
&lt;p>这个还是很有用的，可以直观看到服务器的资源使用情况。&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>&lt;strong>主机监控&lt;/strong>: 实时监控服务器的 CPU、内存、磁盘 I/O、网络等各项性能指标。&lt;/li>
&lt;li>&lt;strong>文件管理&lt;/strong>: 提供在线文件管理器，方便用户上传、下载、编辑、删除服务器上的文件。&lt;/li>
&lt;li>&lt;strong>数据库管理&lt;/strong>: 可视化管理 MySQL、PostgreSQL、MongoDB 等多种数据库，包括创建、删除数据库、用户管理等。&lt;/li>
&lt;li>&lt;strong>容器管理&lt;/strong>: 统一管理 Docker 容器，包括容器的启动、停止、重启、删除、日志查看等。&lt;/li>
&lt;/ul>
&lt;h5 class="heading" id="网站与域名管理-快速建站">
 网站与域名管理 (快速建站)
 &lt;a class="anchor" href="#%e7%bd%91%e7%ab%99%e4%b8%8e%e5%9f%9f%e5%90%8d%e7%ae%a1%e7%90%86-%e5%bf%ab%e9%80%9f%e5%bb%ba%e7%ab%99">#&lt;/a>
&lt;/h5>
&lt;blockquote>
&lt;p>对我来说无用，目前docker的基本操作已经够简单了，Nginx配置写起来也不困难。&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>&lt;strong>一键建站部署&lt;/strong>: 深度集成 WordPress、Halo 等开源建站软件，支持一键快速部署。&lt;/li>
&lt;li>&lt;strong>域名管理与配置&lt;/strong>: 方便地进行域名绑定、解析设置。&lt;/li>
&lt;li>&lt;strong>SSL 证书管理&lt;/strong>: 支持自动申请和配置 Let&amp;rsquo;s Encrypt 等 SSL 证书，实现 HTTPS 安全访问。&lt;/li>
&lt;li>&lt;strong>多站点管理&lt;/strong>: 支持在同一服务器上管理多个网站。&lt;/li>
&lt;/ul>
&lt;h5 class="heading" id="应用生态与商店">
 应用生态与商店
 &lt;a class="anchor" href="#%e5%ba%94%e7%94%a8%e7%94%9f%e6%80%81%e4%b8%8e%e5%95%86%e5%ba%97">#&lt;/a>
&lt;/h5>
&lt;blockquote>
&lt;p>同上，安装应用也不困难。&lt;/p>&lt;/blockquote>
&lt;ul>
&lt;li>&lt;strong>精选开源应用&lt;/strong>: 提供一个丰富的应用商店，涵盖各类高质量的开源工具和应用软件。&lt;/li>
&lt;li>&lt;strong>一键安装部署&lt;/strong>: 用户可以轻松通过点击安装和部署这些应用。&lt;/li>
&lt;li>&lt;strong>自动更新管理&lt;/strong>: 支持已安装应用的自动更新。&lt;/li>
&lt;li>&lt;strong>数据备份与恢复&lt;/strong>: 提供应用数据的一键备份和恢复功能。
&lt;ul>
&lt;li>&lt;strong>应用商店中包含的常见应用类别示例&lt;/strong>:
&lt;ul>
&lt;li>&lt;strong>Web 服务器&lt;/strong>: OpenResty, Nginx Proxy Manager, OpenLiteSpeed&lt;/li>
&lt;li>&lt;strong>数据库&lt;/strong>: MySQL, Redis, PostgreSQL, MariaDB, MongoDB, Elasticsearch, Prometheus, Microsoft SQL Server&lt;/li>
&lt;li>&lt;strong>DevOps 工具&lt;/strong>: Gitea, Jenkins, 禅道, Docker Registry, ShowDoc, Nexus Repository&lt;/li>
&lt;li>&lt;strong>开发工具&lt;/strong>: phpMyAdmin, code-server (浏览器中的 VS Code), IT-Tools, Adminer&lt;/li>
&lt;li>&lt;strong>建站系统&lt;/strong>: Halo, WordPress, Typecho, Flarum, Wiki.js&lt;/li>
&lt;li>&lt;strong>AI / 大模型&lt;/strong>: MaxKB (智能体平台), Ollama (本地大模型运行), OpenWebUI, ChatGPT-Next-Web, LobeChat&lt;/li>
&lt;li>&lt;strong>运行环境&lt;/strong>: PHP (5/7/8), Node.js, &lt;strong>Java&lt;/strong>, Python, Go, .NET&lt;/li>
&lt;li>&lt;strong>中间件&lt;/strong>: MinIO (对象存储), RabbitMQ (消息队列), Nacos (服务发现), Kafka, Apache Tomcat, RocketMQ&lt;/li>
&lt;li>&lt;strong>安全工具&lt;/strong>: JumpServer (堡垒机), AdGuardHome (DNS 广告拦截), uuWAF (Web 应用防火墙), OpenVPN&lt;/li>
&lt;li>&lt;strong>云存储&lt;/strong>: AList (多存储文件列表), Nextcloud, Cloudreve&lt;/li>
&lt;li>&lt;strong>多媒体&lt;/strong>: Jellyfin (媒体服务器), YesPlayMusic (网易云播放器), Navidrome (音乐服务器)&lt;/li>
&lt;li>&lt;strong>休闲游戏&lt;/strong>: 中文 DOS 游戏, Minecraft 服务器管理 (MCSManager), 幻兽帕鲁服务端&lt;/li>
&lt;li>&lt;strong>邮件服务&lt;/strong>: Mailserver, Roundcube (Web 邮件客户端)&lt;/li>
&lt;li>&lt;strong>BI (商业智能)&lt;/strong>: DataEase, Metabase (数据可视化分析工具)&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>其余的一些功能中，能吸引我的还有自动备份功能，未来可能会用到。&lt;/p>
&lt;p>说实话，无法使用nginx反代实现https访问差点把我劝退，1panel的卸载命令都已经敲在了终端中。不过还是更新了一下nginx配置，找到了问题所在，留下来了这个看起来很舒服的面板。希望以后可以发挥更大的作用。&lt;/p>
&lt;h3 class="heading" id="哪吒监控v1">
 哪吒监控V1
 &lt;a class="anchor" href="#%e5%93%aa%e5%90%92%e7%9b%91%e6%8e%a7v1">#&lt;/a>
&lt;/h3>
&lt;h4 class="heading" id="安装前准备">
 安装前准备
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85%e5%89%8d%e5%87%86%e5%a4%87">#&lt;/a>
&lt;/h4>
&lt;h5 class="heading" id="域名">
 域名
 &lt;a class="anchor" href="#%e5%9f%9f%e5%90%8d">#&lt;/a>
&lt;/h5>
&lt;p>一个托管在「Cloudflare」的域名。&lt;/p>
&lt;ol>
&lt;li>
&lt;p>解析到一个至少1c512MB的服务器上作为面板端（后端、监控端）。&lt;/p>
&lt;/li>
&lt;li>
&lt;p>开启「websocket」和「gRPC」












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/20250720201537824.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 class="heading" id="安装哪吒面板端">
 安装哪吒面板端
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85%e5%93%aa%e5%90%92%e9%9d%a2%e6%9d%bf%e7%ab%af">#&lt;/a>
&lt;/h4>
&lt;p>官方手册：&lt;a href="https://nezha.wiki/guide/dashboard.html">安装 Dashboard | 哪吒服务器监控&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>curl -L https://raw.githubusercontent.com/nezhahq/scripts/refs/heads/main/install.sh -o nezha.sh &amp;amp;&amp;amp; chmod +x nezha.sh &amp;amp;&amp;amp; sudo ./nezha.sh
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>安装流程：仅需要特别注意nezha-agent地址填入&lt;code>解析域名:443&lt;/code>












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/20250720201932192.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;h4 class="heading" id="配置nginx反向代理">
 配置nginx反向代理
 &lt;a class="anchor" href="#%e9%85%8d%e7%bd%aenginx%e5%8f%8d%e5%90%91%e4%bb%a3%e7%90%86">#&lt;/a>
&lt;/h4>
&lt;p>一个推荐的nginx配置&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-nginx" data-lang="nginx">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># ===================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 哪吒监控 - 后端服务连接池配置
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 定义一个名为 &amp;#34;dashboard&amp;#34; 的后端服务池，用于连接复用，提高性能。
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># ===================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span>&lt;span style="font-weight:bold;text-decoration:underline">upstream&lt;/span> &lt;span style="color:#666;font-style:italic">dashboard&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">server&lt;/span> 127.0.0.1:8008;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">keepalive&lt;/span> 512;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># ===================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># HTTP (80) 到 HTTPS (443) 的永久重定向
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 这是最佳安全实践，确保所有用户都通过加密连接访问。
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># ===================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span>&lt;span style="font-weight:bold;text-decoration:underline">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">listen&lt;/span> 80;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">listen&lt;/span> &lt;span style="color:#666;font-style:italic">[::]:80&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># &amp;lt;--- 修改这里: 将 dashboard.example.com 替换为你的真实域名
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">server_name&lt;/span> &lt;span style="color:#666;font-style:italic">dashboard.example.com&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># 将所有到来的 HTTP 请求通过 301 永久重定向到对应的 HTTPS 地址
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">return&lt;/span> 301 &lt;span style="color:#666;font-style:italic">https://&lt;/span>&lt;span style="color:#666;font-weight:bold;font-style:italic">$host$request_uri&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># ===================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># HTTPS (443) 主服务配置
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 所有加密流量的入口，处理 Web、WebSocket 和 gRPC 请求。
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># ===================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span>&lt;span style="font-weight:bold;text-decoration:underline">server&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">listen&lt;/span> 443 &lt;span style="color:#666;font-style:italic">ssl&lt;/span> &lt;span style="color:#666;font-style:italic">http2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">listen&lt;/span> &lt;span style="color:#666;font-style:italic">[::]:443&lt;/span> &lt;span style="color:#666;font-style:italic">ssl&lt;/span> &lt;span style="color:#666;font-style:italic">http2&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># &amp;lt;--- 修改这里: 将 dashboard.example.com 替换为你的真实域名
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">server_name&lt;/span> &lt;span style="color:#666;font-style:italic">dashboard.example.com&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># --- SSL 证书配置 ---
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="color:#888;font-style:italic"># &amp;lt;--- 修改这里: 替换为你的 SSL 证书和私钥的实际路径
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_certificate&lt;/span> &lt;span style="color:#666;font-style:italic">/etc/letsencrypt/live/dashboard.example.com/fullchain.pem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_certificate_key&lt;/span> &lt;span style="color:#666;font-style:italic">/etc/letsencrypt/live/dashboard.example.com/key.pem&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># --- SSL 性能与安全优化 (通常无需修改) ---
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_stapling&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_session_timeout&lt;/span> &lt;span style="color:#666;font-style:italic">1d&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_session_cache&lt;/span> &lt;span style="color:#666;font-style:italic">shared:SSL:10m&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">ssl_protocols&lt;/span> &lt;span style="color:#666;font-style:italic">TLSv1.2&lt;/span> &lt;span style="color:#666;font-style:italic">TLSv1.3&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># 允许 Header 中包含下划线，兼容某些特殊情况
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">underscores_in_headers&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># --- 获取真实访客 IP (Cloudflare CDN 专用配置) ---
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="color:#888;font-style:italic"># 因为你使用了 Cloudflare，所以保留这两行配置。
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="color:#888;font-style:italic"># 它告诉 Nginx 要信任所有 IP 发来的请求头，并从 CF-Connecting-IP 头中获取真实 IP。
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="color:#888;font-style:italic"># 更安全的做法是仅信任来自 Cloudflare 官方 IP 段的请求，但当前配置对于绝大多数场景是足够且方便的。
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">set_real_ip_from&lt;/span> 0.0.0.0&lt;span style="color:#666;font-style:italic">/0&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">real_ip_header&lt;/span> &lt;span style="color:#666;font-style:italic">CF-Connecting-IP&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># --- gRPC 请求处理 (Agent 核心数据上报) ---
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">location&lt;/span> &lt;span style="color:#666;font-style:italic">^~&lt;/span> &lt;span style="color:#666;font-style:italic">/proto.NezhaService/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">grpc_pass&lt;/span> &lt;span style="color:#666;font-style:italic">grpc://dashboard&lt;/span>; &lt;span style="color:#888;font-style:italic"># 将 gRPC 请求转发给后端服务池
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># 将真实访客 IP 传递给后端 (使用 Cloudflare 提供的 Header)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">grpc_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">nz-realip&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$http_CF_Connecting_IP&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># 其他 gRPC 相关优化 (通常无需修改)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">grpc_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">Host&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$host&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">grpc_read_timeout&lt;/span> &lt;span style="color:#666;font-style:italic">600s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">grpc_send_timeout&lt;/span> &lt;span style="color:#666;font-style:italic">600s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">grpc_socket_keepalive&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">on&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">client_max_body_size&lt;/span> 10m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">grpc_buffer_size&lt;/span> 4m;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># --- WebSocket 请求处理 (网页终端、文件管理等实时功能) ---
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">location&lt;/span> ~&lt;span style="color:#666;font-style:italic">*&lt;/span> &lt;span style="color:#666;font-style:italic">^/api/v1/ws/(server|terminal|file)(.*)&lt;/span>$ {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_pass&lt;/span> &lt;span style="color:#666;font-style:italic">http://127.0.0.1:8008&lt;/span>; &lt;span style="color:#888;font-style:italic"># 直接转发给后端的 8008 端口
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># --- WebSocket 代理关键配置 ---
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_http_version&lt;/span> 1&lt;span style="color:#666;font-style:italic">.1&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">Upgrade&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$http_upgrade&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">Connection&lt;/span> &lt;span style="color:#666;font-style:italic">&amp;#34;upgrade&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># 将真实访客 IP 传递给后端 (使用 Cloudflare 提供的 Header)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">nz-realip&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$http_CF_Connecting_IP&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># 其他 Header 和超时配置 (通常无需修改)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">Host&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$host&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">Origin&lt;/span> &lt;span style="color:#666;font-style:italic">https://&lt;/span>&lt;span style="color:#666;font-weight:bold;font-style:italic">$host&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_read_timeout&lt;/span> &lt;span style="color:#666;font-style:italic">3600s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_send_timeout&lt;/span> &lt;span style="color:#666;font-style:italic">3600s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># --- Web 页面请求处理 (兜底规则) ---
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">location&lt;/span> &lt;span style="color:#666;font-style:italic">/&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_pass&lt;/span> &lt;span style="color:#666;font-style:italic">http://127.0.0.1:8008&lt;/span>; &lt;span style="color:#888;font-style:italic"># 转发给后端的 8008 端口
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># 将真实访客 IP 传递给后端 (使用 Cloudflare 提供的 Header)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">nz-realip&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$http_CF_Connecting_IP&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># 其他 Header 和超时配置 (通常无需修改)
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic">&lt;/span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_set_header&lt;/span> &lt;span style="color:#666;font-style:italic">Host&lt;/span> &lt;span style="color:#666;font-weight:bold;font-style:italic">$host&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_read_timeout&lt;/span> &lt;span style="color:#666;font-style:italic">3600s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_send_timeout&lt;/span> &lt;span style="color:#666;font-style:italic">3600s&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_buffer_size&lt;/span> 128k;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_buffers&lt;/span> 4 256k;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_busy_buffers_size&lt;/span> 256k;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="font-weight:bold;text-decoration:underline">proxy_max_temp_file_size&lt;/span> 0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h4 class="heading" id="哪吒面板设置">
 哪吒面板设置
 &lt;a class="anchor" href="#%e5%93%aa%e5%90%92%e9%9d%a2%e6%9d%bf%e8%ae%be%e7%bd%ae">#&lt;/a>
&lt;/h4>
&lt;p>到了这一步，此时就可以通过域名访问面板了，并且并没有暴露多余的端口。&lt;/p>
&lt;ul>
&lt;li>首次登录用户与密码均为&lt;code>admin&lt;/code>,第一步先改个默认密码再说。&lt;/li>
&lt;li>因为面板和 agent 都开启了 CF CDN，我们需要在面板系统设置里面的真实 IP 请求头填写&lt;code>CF-Connecting-IP&lt;/code>，后台的登录 IP 以及其它地方才能正常显示真实 IP。












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/20250720202751842.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/li>
&lt;/ul>
&lt;h5 class="heading" id="面板开启oauth2">
 面板开启OAuth2
 &lt;a class="anchor" href="#%e9%9d%a2%e6%9d%bf%e5%bc%80%e5%90%afoauth2">#&lt;/a>
&lt;/h5>
&lt;p>官方说明：&lt;a href="https://nezha.wiki/guide/q14.html#%E8%AE%BE%E7%BD%AE-oauth-2-0-%E7%BB%91%E5%AE%9A">设置 OAuth 2.0 绑定 | 哪吒服务器监控&lt;/a>&lt;/p>
&lt;p>我选择使用「github」&lt;/p>
&lt;ol>
&lt;li>打开 &lt;a href="https://github.com/settings/developers">GitHub开发者设置&lt;/a>，依次选择 “OAuth Apps” - “New OAuth App”。&lt;/li>
&lt;li>填写以下需要的字段：&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>&lt;code>Application name&lt;/code>：应用名&lt;/li>
&lt;li>&lt;code>Homepage URL&lt;/code>：面板访问地址，例如 &lt;code>https://nezha.example.com&lt;/code>&lt;/li>
&lt;li>&lt;code>Authorization callback URL&lt;/code> 面板的 Callback 地址，这里只检测前缀，所以可以填写 &lt;code>https://nezha.example.com/api/v1/oauth2/callback&lt;/code>。












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/20250720203459271.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/li>
&lt;/ul>
&lt;ol start="3">
&lt;li>在新页面中记录 Client ID 和 Client secrets，完成面板 OAuth 2.0 配置：&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yaml" data-lang="yaml">&lt;span style="display:flex;">&lt;span>oauth2:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> GitHub:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client_id: &lt;span style="color:#666;font-style:italic">&amp;#34;a-unique-id&amp;#34;&lt;/span> &lt;span style="color:#888;font-style:italic"># 替换你的 Client ID&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> client_secret: &lt;span style="color:#666;font-style:italic">&amp;#34;a-unique-secret&amp;#34;&lt;/span> &lt;span style="color:#888;font-style:italic"># 替换你的 Client secrets&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> endpoint:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> auth_url: &lt;span style="color:#666;font-style:italic">&amp;#34;https://github.com/login/oauth/authorize&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> token_url: &lt;span style="color:#666;font-style:italic">&amp;#34;https://github.com/login/oauth/access_token&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user_info_url: &lt;span style="color:#666;font-style:italic">&amp;#34;https://api.github.com/user&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> user_id_path: &lt;span style="color:#666;font-style:italic">&amp;#34;id&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="4">
&lt;li>将以上配置添加到&lt;code>/opt/nezha/dashboard/data/config.yaml&lt;/code>面板（Dashboard） 配置&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo vim /opt/nezha/dashboard/data/config.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="5">
&lt;li>重启面板使新配置生效&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>./nezha.sh 
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="6">
&lt;li>打开个人信息设置绑定github，并关闭密码登录












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/20250720204140554.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/li>
&lt;/ol>
&lt;h4 class="heading" id="安装探针agent端监控端">
 安装探针（agent端、监控端）
 &lt;a class="anchor" href="#%e5%ae%89%e8%a3%85%e6%8e%a2%e9%92%88agent%e7%ab%af%e7%9b%91%e6%8e%a7%e7%ab%af">#&lt;/a>
&lt;/h4>
&lt;p>官方教程：&lt;a href="https://nezha.wiki/guide/agent.html">安装 Agent | 哪吒服务器监控&lt;/a>&lt;/p>
&lt;ol>
&lt;li>在 &lt;code>服务器&lt;/code> 页面中，点击 &lt;code>安装命令&lt;/code> 并选择对应操作系统，安装命令将自动复制到你的剪贴板。&lt;/li>
&lt;li>在被控端服务器中运行安装命令，等待安装完成后返回到 &lt;code>服务器&lt;/code> 页面查看是否上线。&lt;/li>
&lt;/ol>
&lt;hr>
&lt;p>在面板显示&lt;code>暴力攻击代理秘密&lt;/code> 与 &lt;code>gRPC 认证失败&lt;/code>，但是又能正常监控，还以为发现了bug，但是最后发现是因为我多次安装agent导致出现了一些僵尸进程。&lt;/p>
&lt;p>使用&lt;code>ps -ef | grep nezha-agent&lt;/code> 查看，并使用 &lt;code>sudo kill&lt;/code> 杀掉僵尸进程就没有了。&lt;/p>
&lt;p>











&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/20250720212944889.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;h5 class="heading" id="安全设置-关闭探针远程控制功能">
 安全设置： 关闭探针远程控制功能
 &lt;a class="anchor" href="#%e5%ae%89%e5%85%a8%e8%ae%be%e7%bd%ae-%e5%85%b3%e9%97%ad%e6%8e%a2%e9%92%88%e8%bf%9c%e7%a8%8b%e6%8e%a7%e5%88%b6%e5%8a%9f%e8%83%bd">#&lt;/a>
&lt;/h5>
&lt;ul>
&lt;li>打开&lt;code>/opt/nezha/agent/config.yml&lt;/code>，把 &lt;code>disable_command_execute&lt;/code>改成true&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo vim /opt/nezha/agent/config.yml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>重启agent服务&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo systemctl restart nezha-agent
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h5 class="heading" id="添加备注">
 添加备注
 &lt;a class="anchor" href="#%e6%b7%bb%e5%8a%a0%e5%a4%87%e6%b3%a8">#&lt;/a>
&lt;/h5>
&lt;p>&lt;a href="https://nezhainfojson.pages.dev">公开备注生成器&lt;/a>&lt;/p>
&lt;h5 class="heading" id="卸载agent端">
 卸载agent端
 &lt;a class="anchor" href="#%e5%8d%b8%e8%bd%bdagent%e7%ab%af">#&lt;/a>
&lt;/h5>
&lt;ol>
&lt;li>停止 Agent 服务&lt;/li>
&lt;/ol>
&lt;p>&lt;code>sudo systemctl stop nezha-agent&lt;/code>&lt;/p>
&lt;ol start="2">
&lt;li>禁用开机自启&lt;/li>
&lt;/ol>
&lt;p>防止服务在系统启动时自动运行。&lt;/p>
&lt;p>&lt;code>sudo systemctl disable nezha-agent&lt;/code>&lt;/p>
&lt;ol start="3">
&lt;li>删除服务文件&lt;/li>
&lt;/ol>
&lt;p>移除 &lt;code>nezha-agent&lt;/code> 的服务配置文件。&lt;/p>
&lt;p>&lt;code>sudo rm /etc/systemd/system/nezha-agent.service&lt;/code>&lt;/p>
&lt;ol start="4">
&lt;li>删除 Agent 文件&lt;/li>
&lt;/ol>
&lt;p>删除安装目录中的 Agent 文件。&lt;/p>
&lt;p>&lt;code>sudo rm -rf /opt/nezha/agent&lt;/code>&lt;/p>
&lt;ol start="5">
&lt;li>重新加载 systemd 配置&lt;/li>
&lt;/ol>
&lt;p>确保系统服务管理器加载最新的配置。&lt;/p>
&lt;p>&lt;code>sudo systemctl daemon-reload&lt;/code>&lt;/p>
&lt;ol start="6">
&lt;li>检查残留进程
确认没有遗留的 &lt;code>nezha-agent&lt;/code> 进程在运行。如果发现仍有相关进程运行，请使用 &lt;code>sudo kill&lt;/code> 命令终止。&lt;/li>
&lt;/ol>
&lt;p>&lt;code>ps -ef | grep nezha-agent&lt;/code>&lt;/p>
&lt;ol start="7">
&lt;li>删除日志文件（可选）&lt;/li>
&lt;/ol>
&lt;p>如果需要，您可以删除与 &lt;code>nezha-agent&lt;/code> 相关的日志文件。&lt;/p>
&lt;p>&lt;code>sudo rm -rf /var/log/nezha&lt;/code>&lt;/p>
&lt;h2 class="heading" id="关闭-ipv6--开启bbr">
 关闭 ipv6 &amp;amp; 开启bbr
 &lt;a class="anchor" href="#%e5%85%b3%e9%97%ad-ipv6--%e5%bc%80%e5%90%afbbr">#&lt;/a>
&lt;/h2>
&lt;p>我的网络环境为校园网，对ipv6的支持并不好；&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="font-weight:bold;font-style:italic">echo&lt;/span> &lt;span style="color:#666;font-style:italic">&amp;#34;net.core.default_qdisc=fq&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="font-weight:bold;font-style:italic">echo&lt;/span> &lt;span style="color:#666;font-style:italic">&amp;#34;net.ipv4.tcp_congestion_control=bbr&amp;#34;&lt;/span> &amp;gt;&amp;gt; /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sysctl -p
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>lsmod | grep bbr &lt;span style="color:#888;font-style:italic"># 查看是否成功开启BBR&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 1. 将配置添加到 /etc/sysctl.conf (使用 tee -a 确保安全追加)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="font-weight:bold;font-style:italic">echo&lt;/span> &lt;span style="color:#666;font-style:italic">&amp;#34;net.ipv6.conf.all.disable_ipv6 = 1&amp;#34;&lt;/span> | sudo tee -a /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="font-weight:bold;font-style:italic">echo&lt;/span> &lt;span style="color:#666;font-style:italic">&amp;#34;net.ipv6.conf.default.disable_ipv6 = 1&amp;#34;&lt;/span> | sudo tee -a /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="font-weight:bold;font-style:italic">echo&lt;/span> &lt;span style="color:#666;font-style:italic">&amp;#34;net.ipv6.conf.lo.disable_ipv6 = 1&amp;#34;&lt;/span> | sudo tee -a /etc/sysctl.conf
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 2. 使配置立即生效 (并加载所有 /etc/sysctl.conf 中的配置)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo sysctl -p
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># 3. (可选) 重启系统以确保所有服务都以新配置启动&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#888;font-style:italic"># sudo reboot&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>论在网吧登录 Steam 的正确姿势</title><link>https://blog.yzyy.de/post/%E8%AE%BA%E5%9C%A8%E7%BD%91%E5%90%A7%E7%99%BB%E5%BD%95-steam-%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF/</link><pubDate>Wed, 06 Mar 2024 00:00:00 +0000</pubDate><guid>https://blog.yzyy.de/post/%E8%AE%BA%E5%9C%A8%E7%BD%91%E5%90%A7%E7%99%BB%E5%BD%95-steam-%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF/</guid><description>&lt;p>说到在网吧登录 Steam 的正确姿势，那就是不要在网吧尝试以任何方式登录 Steam。不是我杞人忧天，实在是血淋淋的教训太多了，请看：












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="IMG_7817" src="https://webp.050612.xyz/2025/07/IMG_7817.jpeg" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;p>这些案例中既有使用账号密码登录的，也有使用手机令牌扫码登录的。&lt;/p>
&lt;p>是的🤗，只要你有库存，第二天 Steam 都可能会给你一个 &amp;ldquo;惊喜&amp;rdquo; 发钱！但这可不是 Steam 大发慈悲，而是在通知你：兄弟，你的号被盗了…😮












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="IMG_7823" src="https://webp.050612.xyz/2025/07/IMG_7823.png" >
 &lt;/div>

 
&lt;/figure>













&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="IMG_7822" src="https://webp.050612.xyz/2025/07/IMG_7822.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;hr>
&lt;p>&lt;strong>什么样的账号最容易被盗？&lt;/strong>&lt;/p>
&lt;p>一般来说，盗号贼的目的是为了盗库存、网游开挂。&lt;br>
如果号中有以下因素会增加被盗风险：&lt;/p>
&lt;ul>
&lt;li>CSGO、趴不寄、永劫等一些网游&lt;/li>
&lt;li>高价值库存&lt;/li>
&lt;li>集换式卡牌、闪卡等&lt;/li>
&lt;/ul>
&lt;p>俗话说，光脚的不怕穿鞋的，像我的 Steam 号库存一贫如洗🤦‍♂️，反而可以在网吧为所欲为…&lt;/p>
&lt;hr>
&lt;p>&lt;strong>“但我就是想在网吧玩啊，咋整？”&lt;/strong>&lt;/p>
&lt;p>凡事没有绝对。&lt;/p>
&lt;p>假如你也像上位佬友一样，家里电脑配置不够，不能爽完一些 3A，或者和以前的老同学临时起意相约网吧开黑，在这里分享一个相对来说保险的方法。&lt;/p>
&lt;p>那就是 Steam 家庭共享大法。&lt;/p>
&lt;ol>
&lt;li>创建个空白小号（就当给自己养了个 Steam 二胎）&lt;/li>
&lt;li>把小号以儿童身份加入大号的家庭组（认个干儿子）&lt;/li>
&lt;li>平时把小号游玩权限全关（让熊孩子老实点）&lt;/li>
&lt;li>网吧只登录小号，打完了及时锁定小号（让熊孩子去冒险）&lt;/li>
&lt;/ol>
&lt;p>这样有两个好处，一是大部分 3A 都支持家庭共享，二是小号拿来玩一些免费网游也可以。&lt;/p>
&lt;p>唯一的风险就是，真有人不长眼地把你小号也给盗了，玩网游开挂会导致大号一起连坐封禁。🙄&lt;/p>
&lt;hr>
&lt;p>&lt;strong>“我就非要登录咋办？”&lt;/strong>&lt;/p>
&lt;p>如果假设你选择了一家口碑良好、连锁品牌的高端网咖，并且坚定地选择相信他，那么也需要注意，做到这些会更加保险。&lt;/p>
&lt;ol>
&lt;li>如果你的电脑是开着的，那么一定要重启电脑，触发网吧的恢复程序，防止上一位 下毒；&lt;/li>
&lt;li>重新官网下载 Steam 客户端，不要用网吧预装好的 Steam；&lt;/li>
&lt;li>绑定手机令牌且通过手机令牌扫码登陆，不要手动输入帐号密码；&lt;/li>
&lt;li>登陆后选择不把登陆凭证保存到本地计算机；&lt;/li>
&lt;li>下机前主动登出 Steam，并确认不能免凭证登陆；&lt;/li>
&lt;li>手机令牌在已授权凭证中清除在网吧的登陆凭证。&lt;/li>
&lt;/ol>
&lt;hr>
&lt;p>&lt;strong>万一真被盗了你又不愿意咋办？&lt;/strong>&lt;/p>
&lt;p>最后再说说在你及时发现了 steam 给你发钱的时候（被盗的时候），补救措施：&lt;/p>
&lt;blockquote>
&lt;p>转载小黑盒












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="IMG_7824" src="https://webp.050612.xyz/2025/07/IMG_7824.jpeg" >
 &lt;/div>

 
&lt;/figure>













&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="IMG_7825" src="https://webp.050612.xyz/2025/07/IMG_7825.jpeg" >
 &lt;/div>

 
&lt;/figure>













&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="IMG_7826" src="https://webp.050612.xyz/2025/07/IMG_7826.jpeg" >
 &lt;/div>

 
&lt;/figure>













&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="IMG_7827" src="https://webp.050612.xyz/2025/07/IMG_7827.jpeg" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>&lt;/blockquote></description></item><item><title>Hello, Typo!</title><link>https://blog.yzyy.de/post/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</link><pubDate>Wed, 04 Oct 2023 00:00:00 +0000</pubDate><guid>https://blog.yzyy.de/post/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</guid><description>&lt;p>一切都源于在论坛上看到了一个简洁的博客主题，一个以内容为上的博客主题。看到的那一刻就默默在笔记上记下了一个TODO: 搭建一个博客。&lt;/p>
&lt;p>在看到typo之前，没想过搭建一个个人博客，想着有一个本地化的笔记内容已经够了。加上在网上冲浪，看到的无数个已经被遗忘在互联网的角落里蒙灰的博客。我想，凭我的精力很难一直有内容产出。所以我的博客计划搁置了一段时间。&lt;/p>
&lt;p>但我后来想了想，正是这些蒙灰的博客，才真的帮到过我。可能内容简单，甚至有些简陋，但偏偏就是他们记录下了某个冷门问题的解决过程，或者某一步的细节，让我得以顺利过关。&lt;/p>
&lt;p>反过来看，这也是它们存在的意义吧。博客不一定要有多少更新、多少阅读量、有多么高大上，只要在某个时刻它帮到了某个人，那它就很有价值。所以，看似被遗忘的内容，其实都还藏着被再次发现和利用的可能——我自己就是这样真实受益的那个人。&lt;/p>
&lt;p>下面记录我搭建这个博客的过程吧。&lt;/p>
&lt;hr>
&lt;h1 class="heading" id="工作主流程">
 工作主流程
 &lt;a class="anchor" href="#%e5%b7%a5%e4%bd%9c%e4%b8%bb%e6%b5%81%e7%a8%8b">#&lt;/a>
&lt;/h1>
&lt;p>











&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="|525" src="https://webp.050612.xyz/2025/07/20250715234651888.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;ol>
&lt;li>笔记软件: &lt;a href="https://obsidian.md%22/">Obsidian&lt;/a>&lt;/li>
&lt;li>框架: &lt;a href="https://gohugo.io/">Hugo&lt;/a>&lt;/li>
&lt;li>主题: &lt;a href="https://github.com/tomfran/typo">typo:&lt;/a>&lt;/li>
&lt;li>远程同步: &lt;a href="https://git-scm.com/">Git&lt;/a>&lt;/li>
&lt;li>渲染 &amp;amp; 发布: Github Action &amp;amp; Github Page&lt;/li>
&lt;li>Dns 托管: &lt;a href="https://cloudflare.com/">Cloudflare&lt;/a>&lt;/li>
&lt;/ol>
&lt;h1 class="heading" id="搭建步骤">
 搭建步骤
 &lt;a class="anchor" href="#%e6%90%ad%e5%bb%ba%e6%ad%a5%e9%aa%a4">#&lt;/a>
&lt;/h1>
&lt;h2 class="heading" id="hugo">
 Hugo
 &lt;a class="anchor" href="#hugo">#&lt;/a>
&lt;/h2>
&lt;p>像我这样先选了主题，再了解博客框架的人应该不多吧。Hugo 是一个使用 Go 语言编写的&lt;strong>静态网站生成器&lt;/strong>，以其&lt;strong>高性能、易用性和灵活性&lt;/strong>而广受欢迎。可以把 Markdown 文件转化成 HTML 文件。但是静态博客也有缺点，维护难，可扩展性较弱，上手门槛高，希望我能坚持下去吧。&lt;/p>
&lt;h3 class="heading" id="hugo下载安装">
 Hugo下载安装
 &lt;a class="anchor" href="#hugo%e4%b8%8b%e8%bd%bd%e5%ae%89%e8%a3%85">#&lt;/a>
&lt;/h3>
&lt;ol>
&lt;li>首先在 &lt;a href="https://github.com/gohugoio/hugo/releases">Release&lt;/a> 根据操作系统以及指令集下载最新版本的 Hugo 压缩包
Windows 则选择例如: &lt;code>hugo_0.148.1_windows-amd64.zip&lt;/code>&lt;/li>
&lt;li>选择合适的路径进行解压&lt;/li>
&lt;li>添加环境变量，在搜索框搜索&lt;code>环境变量&lt;/code>，根据解压路径配置hugo.exe所在的路径到PATH&lt;/li>
&lt;li>打开一个终端，输入&lt;code>hugo version&lt;/code>验证&lt;/li>
&lt;/ol>
&lt;h3 class="heading" id="初始化hugo结构">
 初始化Hugo结构
 &lt;a class="anchor" href="#%e5%88%9d%e5%a7%8b%e5%8c%96hugo%e7%bb%93%e6%9e%84">#&lt;/a>
&lt;/h3>
&lt;p>使用 &lt;code>hugo new site xxxx&lt;/code>创建网站初始结构。
初始结构如下：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>archetypes&lt;/strong>：存放用 hugo 命令新建的 Markdown 文件应用的 front matter 模版&lt;/li>
&lt;li>&lt;strong>content&lt;/strong>：存放内容页面，比如「博客」、「读书笔记」等&lt;/li>
&lt;li>&lt;strong>layouts&lt;/strong>：存放定义网站的样式，写在&lt;code>layouts&lt;/code>文件下的样式会覆盖安装的主题中的 &lt;code>layouts&lt;/code>文件同名的样式&lt;/li>
&lt;li>&lt;strong>static&lt;/strong>：存放所有静态文件，如图片&lt;/li>
&lt;li>&lt;strong>data&lt;/strong>：存放创建站点时 Hugo 使用的其他数据&lt;/li>
&lt;li>&lt;strong>public&lt;/strong>：存放 Hugo 生成的静态网页&lt;/li>
&lt;li>&lt;strong>themes&lt;/strong>：存放主题文件&lt;/li>
&lt;li>&lt;strong>config.toml&lt;/strong>：网站配置文件&lt;/li>
&lt;/ul>
&lt;h2 class="heading" id="typo">
 Typo
 &lt;a class="anchor" href="#typo">#&lt;/a>
&lt;/h2>
&lt;p>正像github上介绍的，Typo 是一个以简洁为基础的主题。目标是创建一个以内容为中心，没有任何其他多余内容的网站。直观感受是具有纯粹的阅读体验。&lt;/p>
&lt;h3 class="heading" id="typo主题配置">
 Typo主题配置
 &lt;a class="anchor" href="#typo%e4%b8%bb%e9%a2%98%e9%85%8d%e7%bd%ae">#&lt;/a>
&lt;/h3>
&lt;p>不同主题一般都在相应的wiki中给出了配置指南。按照流程配置即可。需要格外注意的是，建议直接使用主题给出的&lt;code>hugo.toml&lt;/code> 配置文件作为基础，在这个基础之上进行配置可以避免一些奇怪的问题。&lt;/p>
&lt;h3 class="heading" id="本地测试">
 本地测试
 &lt;a class="anchor" href="#%e6%9c%ac%e5%9c%b0%e6%b5%8b%e8%af%95">#&lt;/a>
&lt;/h3>
&lt;p>到这一步即可进行本地测试，在博客主文件夹下运行命令:&lt;/p>
&lt;pre tabindex="0">&lt;code>hugo server -D
&lt;/code>&lt;/pre>&lt;p>再打开输出的网址即可&lt;/p>
&lt;h2 class="heading" id="工作流搭建">
 工作流搭建
 &lt;a class="anchor" href="#%e5%b7%a5%e4%bd%9c%e6%b5%81%e6%90%ad%e5%bb%ba">#&lt;/a>
&lt;/h2>
&lt;ol>
&lt;li>创建 2 个 GitHub 仓库
&lt;ul>
&lt;li>&lt;strong>博客源仓库&lt;/strong>：储存所有 Markdown 源文件（博客内容），和博客中用到的图片等。&lt;/li>
&lt;li>&lt;strong>GitHub Pages 仓库&lt;/strong>：储存由 Hugo 从Markdown 文件生成的 HTML 文件。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>将在&lt;strong>博客源仓库&lt;/strong>中 Hugo 生成的静态 HTML 文件部署到 &lt;strong>GitHub Pages 仓库&lt;/strong>中。&lt;/li>
&lt;/ol>
&lt;p>我学习替他博主的思路。我将博客源码存放到一个private repo里。但也可以将源码直接放到github pages repo中（只需要单独一个远程仓库即可），但这样其他人能获取文章的源文件。&lt;/p>
&lt;h3 class="heading" id="创建博客源仓库">
 创建博客源仓库
 &lt;a class="anchor" href="#%e5%88%9b%e5%bb%ba%e5%8d%9a%e5%ae%a2%e6%ba%90%e4%bb%93%e5%ba%93">#&lt;/a>
&lt;/h3>
&lt;ol>
&lt;li>命名&lt;strong>博客源仓库&lt;/strong>（whatever you want）&lt;/li>
&lt;li>勾选 &lt;strong>Private&lt;/strong>，设置为私有仓库。&lt;/li>
&lt;/ol>
&lt;h3 class="heading" id="创建-github-page-仓库">
 创建 GitHub Page 仓库
 &lt;a class="anchor" href="#%e5%88%9b%e5%bb%ba-github-page-%e4%bb%93%e5%ba%93">#&lt;/a>
&lt;/h3>
&lt;ol>
&lt;li>命名 &lt;strong>GitHub Pages&lt;/strong> 仓库，这个仓库必须使用特殊的命名格式 &lt;code>&amp;lt;username.github.io&amp;gt;&lt;/code>， &lt;code>&amp;lt;username&amp;gt;&lt;/code> 是自己的 GitHub 的用户名。&lt;/li>
&lt;li>勾选 &lt;strong>Public&lt;/strong>，设置为公开仓库。&lt;/li>
&lt;/ol>
&lt;h3 class="heading" id="添加cname文件到static文件夹使用自定义域名的额外步骤">
 添加CNAME文件到static/文件夹（使用自定义域名的额外步骤）
 &lt;a class="anchor" href="#%e6%b7%bb%e5%8a%a0cname%e6%96%87%e4%bb%b6%e5%88%b0static%e6%96%87%e4%bb%b6%e5%a4%b9%e4%bd%bf%e7%94%a8%e8%87%aa%e5%ae%9a%e4%b9%89%e5%9f%9f%e5%90%8d%e7%9a%84%e9%a2%9d%e5%a4%96%e6%ad%a5%e9%aa%a4">#&lt;/a>
&lt;/h3>
&lt;p>如果选择为Github Pages使用自定义域名，则这个步骤必须要做，否则自定义域名会隔三差五失效。&lt;/p>
&lt;p>原因在于，当在&lt;code>YOUR_NAME.github.io&lt;/code>这个仓库的设置里手动添加自定义域名的时候，其实是在github仓库新增了一个CNAME文件，里面内容为自定义域名。&lt;/p>
&lt;p>但是每次推送触发actions后，hugo命令都会生成一个全新的public文件夹并强制覆盖到page仓库。这个操作都会覆盖掉github上的CNAME，导致域名失效。&lt;/p>
&lt;p>在 &lt;code>hugo&lt;/code> 构建网站时，它会把 &lt;code>static&lt;/code> 文件夹里的&lt;strong>所有内容&lt;/strong>，原封不动地、完整地复制到最终生成的 &lt;code>public&lt;/code> 文件夹的根目录下。所以在static文件夹下添加一个CNAME文件即可。&lt;/p>
&lt;h3 class="heading" id="推送到博客源仓库">
 推送到博客源仓库
 &lt;a class="anchor" href="#%e6%8e%a8%e9%80%81%e5%88%b0%e5%8d%9a%e5%ae%a2%e6%ba%90%e4%bb%93%e5%ba%93">#&lt;/a>
&lt;/h3>
&lt;ol>
&lt;li>创建gitignore文件&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code class="language-.gitignore" data-lang=".gitignore"># Hugo
public/
.hugo_build.lock
&lt;/code>&lt;/pre>&lt;ol start="2">
&lt;li>推送到远程仓库&lt;/li>
&lt;/ol>
&lt;pre tabindex="0">&lt;code># === 项目初始化与首次提交 ===
echo &amp;#34;# my-blog-source&amp;#34; &amp;gt;&amp;gt; README.md
git init
git add .
git commit -m &amp;#34;first commit&amp;#34;
git branch -M main
git remote add origin https://github.com/xxx/xxx.git
git push -u origin main
&lt;/code>&lt;/pre>&lt;h2 class="heading" id="自动发布内容">
 自动发布内容
 &lt;a class="anchor" href="#%e8%87%aa%e5%8a%a8%e5%8f%91%e5%b8%83%e5%86%85%e5%ae%b9">#&lt;/a>
&lt;/h2>
&lt;p>使用Github Actions功能实现提交源码后自动发布。&lt;/p>
&lt;h3 class="heading" id="生成actions-secrets">
 生成Actions secrets
 &lt;a class="anchor" href="#%e7%94%9f%e6%88%90actions-secrets">#&lt;/a>
&lt;/h3>
&lt;ol>
&lt;li>
&lt;p>生成Personal access tokens 首先点击github头像在下拉栏里进入Setting-&amp;gt;Developer Settings-&amp;gt;Personal access tokens -&amp;gt; tokens (classic)












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/20250716010922097.png" >
 &lt;/div>

 
&lt;/figure>

选择Generate new token，点击Generate token生成token，并先复制保存该token。(这个token只有显示一次，所以一定要复制保存)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>生成Actions secrets 接下来在源码repo中添加上面的personal access token：&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>进入repo的Settings-&amp;gt;Secrets and variable一栏，选择New repository secret












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/20250716011218953.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;p>名称自取，Secret复制上面生成的Personal access tokens












&lt;figure class="">

 &lt;div class="img-container" >
 &lt;img loading="lazy" alt="" src="https://webp.050612.xyz/2025/07/20250716011226467.png" >
 &lt;/div>

 
&lt;/figure>
&lt;/p>
&lt;h3 class="heading" id="配置actions文件">
 配置actions文件
 &lt;a class="anchor" href="#%e9%85%8d%e7%bd%aeactions%e6%96%87%e4%bb%b6">#&lt;/a>
&lt;/h3>
&lt;p>在repo根目录新建嵌套的两个文件夹.github/workflows&lt;/p>
&lt;p>在workflows里新建一个后缀为.yml的配置文件，名字自取。&lt;/p>
&lt;p>写进去以下配置（从hugo官方文档修改而来）：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-yml" data-lang="yml">&lt;span style="display:flex;">&lt;span>name: github pages &lt;span style="color:#888;font-style:italic"># 名字自取&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>on:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> push:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> branches:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - main &lt;span style="color:#888;font-style:italic"># 这里的意思是当 main分支发生push的时候，运行下面的jobs，这里先改为github-actions&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>jobs:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> deploy: &lt;span style="color:#888;font-style:italic"># 任务名自取&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> runs-on: ubuntu-latest	# 在什么环境运行任务
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> steps:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - uses: actions/checkout@v2	# 引用actions/checkout这个action，与所在的github仓库同名
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> with:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> submodules: &lt;span style="font-weight:bold;text-decoration:underline">true&lt;/span> &lt;span style="color:#888;font-style:italic"># Fetch Hugo themes (true OR recursive) 获取submodule主题&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> fetch-depth: 0 &lt;span style="color:#888;font-style:italic"># Fetch all history for .GitInfo and .Lastmod&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - name: Setup Hugo	# 步骤名自取
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uses: peaceiris/actions-hugo@v2	# hugo官方提供的action，用于在任务环境中获取hugo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> with:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> hugo-version: &lt;span style="color:#666;font-style:italic">&amp;#39;latest&amp;#39;&lt;/span>	&lt;span style="color:#888;font-style:italic"># 获取最新版本的hugo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># extended: true&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - name: Build
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> run: hugo --minify	# 使用hugo构建静态网页
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> - name: Deploy
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> uses: peaceiris/actions-gh-pages@v3	# 一个自动发布github pages的action
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> with:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#888;font-style:italic"># github_token: ${{ secrets.GITHUB_TOKEN }} 该项适用于发布到源码相同repo的情况，不能用于发布到其他repo&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> external_repository: 用户名/page仓库名	# 发布到哪个repo
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> personal_token: ${{ secrets.token名 }}	# 发布到其他repo需要提供上面生成的personal access token
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> publish_dir: ./public	# 注意这里指的是要发布哪个文件夹的内容，而不是指发布到目的仓库的什么位置，因为hugo默认生成静态网页到public文件夹，所以这里发布public文件夹里的内容
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> publish_branch: main	# 发布到哪个branch
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>yml文件中只需要改&lt;code>external_repository&lt;/code>为自己的github page仓库，&lt;code>personal_token: ${{ secrets.XXX }}&lt;/code> 改成前面步骤生成Actions Secrets中取的名称。&lt;/p>
&lt;hr>
&lt;p>至此，折腾了半天的自动化流程，总算是搭建完成了。&lt;/p>
&lt;p>现在，我终于可以再关心部署的流程细节，把精力放回到最初的目的上——去记录，去成为那些曾经帮助过我的、‘蒙灰的博客’中的一员。&lt;/p>
&lt;p>也许我的文章也会很简单，甚至有些简陋，也可能会在未来的某个时刻被遗忘在角落里。但只要它能在某个时刻，帮到某个卡在同样问题上的人，让他得以顺利过关，那这一切的折腾就都值了。&lt;/p>
&lt;p>&lt;strong>Hello, Typo！&lt;/strong>&lt;/p></description></item></channel></rss>